var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode&&t.parentNode.removeChild(t)}function u(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function l(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function h(){return f(" ")}function E(){return f("")}function d(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function p(t){return function(e){return e.preventDefault(),t.call(this,e)}}function T(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function g(t){return""===t?null:+t}function _(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function m(t,e){t.value=null==e?"":e}function y(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function b(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function N(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}let w;function v(t){w=t}function M(){if(!w)throw new Error("Function called outside component initialization");return w}function I(){const t=M();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const i=function(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,r,e),o}(e,n,{cancelable:r});return o.slice().forEach((e=>{e.call(t,i)})),!i.defaultPrevented}return!0}}function k(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const A=[],S=[],C=[],x=[],V=Promise.resolve();let $=!1;function U(t){C.push(t)}function R(t){x.push(t)}const D=new Set;let P=0;function O(){if(0!==P)return;const t=w;do{try{for(;P<A.length;){const t=A[P];P++,v(t),H(t.$$)}}catch(t){throw A.length=0,P=0,t}for(v(null),A.length=0,P=0;S.length;)S.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];D.has(e)||(D.add(e),e())}C.length=0}while(A.length);for(;x.length;)x.pop()();$=!1,D.clear(),v(t)}function H(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(U)}}const L=new Set;let F;function B(){F={r:0,c:[],p:F}}function q(){F.r||r(F.c),F=F.p}function G(t,e){t&&t.i&&(L.delete(t),t.i(e))}function z(t,e,n,r){if(t&&t.o){if(L.has(t))return;L.add(t),F.c.push((()=>{L.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}else r&&r()}function K(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function Q(t){t&&t.c()}function Y(t,n,i,a){const{fragment:s,after_update:c}=t.$$;s&&s.m(n,i),a||U((()=>{const n=t.$$.on_mount.map(e).filter(o);t.$$.on_destroy?t.$$.on_destroy.push(...n):r(n),t.$$.on_mount=[]})),c.forEach(U)}function X(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function j(t,e){-1===t.$$.dirty[0]&&(A.push(t),$||($=!0,V.then(O)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function J(e,o,i,a,s,u,l,f=[-1]){const h=w;v(e);const E=e.$$={fragment:null,ctx:[],props:u,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(h?h.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||h.$$.root};l&&l(E.root);let d=!1;if(E.ctx=i?i(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return E.ctx&&s(E.ctx[t],E.ctx[t]=o)&&(!E.skip_bound&&E.bound[t]&&E.bound[t](o),d&&j(e,t)),n})):[],E.update(),d=!0,r(E.before_update),E.fragment=!!a&&a(E.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);E.fragment&&E.fragment.l(t),t.forEach(c)}else E.fragment&&E.fragment.c();o.intro&&G(e.$$.fragment),Y(e,o.target,o.anchor,o.customElement),O()}v(h)}class W{$destroy(){X(this,1),this.$destroy=t}$on(e,n){if(!o(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Z(t){let e;if(t){if(!(t instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(this.datas=new DataView(t,0,Z.HEADER_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"h"!==String.fromCharCode(this.datas.getUint8(2))||"d"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileHeader : MThd prefix not found");if(6!==this.datas.getUint32(4))throw new Error("Invalid MIDIFileHeader : Chunk length must be 6")}else e=new Uint8Array(Z.HEADER_LENGTH),e[0]=77,e[1]=84,e[2]=104,e[3]=100,e[4]=0,e[5]=0,e[6]=0,e[7]=6,e[8]=0,e[9]=1,e[10]=0,e[11]=1,e[12]=0,e[13]=192,this.datas=new DataView(e.buffer,0,Z.HEADER_LENGTH)}Z.HEADER_LENGTH=14,Z.FRAMES_PER_SECONDS=1,Z.TICKS_PER_BEAT=2,Z.prototype.getFormat=function(){const t=this.datas.getUint16(8);if(0!==t&&1!==t&&2!==t)throw new Error("Invalid MIDI file : MIDI format ("+t+"), format can be 0, 1 or 2 only.");return t},Z.prototype.setFormat=function(t){if(0!==t&&1!==t&&2!==t)throw new Error("Invalid MIDI format given ("+t+"), format can be 0, 1 or 2 only.");this.datas.setUint16(8,t)},Z.prototype.getTracksCount=function(){return this.datas.getUint16(10)},Z.prototype.setTracksCount=function(t){return this.datas.setUint16(10,t)},Z.prototype.getTickResolution=function(t){return 32768&this.datas.getUint16(12)?1e6/(this.getSMPTEFrames()*this.getTicksPerFrame()):(t=t||5e5)/this.getTicksPerBeat()},Z.prototype.getTimeDivision=function(){return 32768&this.datas.getUint16(12)?Z.FRAMES_PER_SECONDS:Z.TICKS_PER_BEAT},Z.prototype.getTicksPerBeat=function(){var t=this.datas.getUint16(12);if(32768&t)throw new Error("Time division is not expressed as ticks per beat.");return t},Z.prototype.setTicksPerBeat=function(t){this.datas.setUint16(12,32767&t)},Z.prototype.getSMPTEFrames=function(){const t=this.datas.getUint16(12);let e;if(!(32768&t))throw new Error("Time division is not expressed as frames per seconds.");if(e=32512&t,-1===[24,25,29,30].indexOf(e))throw new Error("Invalid SMPTE frames value ("+e+").");return 29===e?29.97:e},Z.prototype.getTicksPerFrame=function(){const t=this.datas.getUint16(12);if(!(32768&t))throw new Error("Time division is not expressed as frames per seconds.");return 255&t},Z.prototype.setSMTPEDivision=function(t,e){if(29.97===t&&(t=29),-1===[24,25,29,30].indexOf(t))throw new Error("Invalid SMPTE frames value given ("+t+").");if(0>e||255<e)throw new Error("Invalid ticks per frame value given ("+t+").");this.datas.setUint8(12,128|t),this.datas.setUint8(13,e)};var tt=Z;function et(t,e){let n,r;if(t){if(!(t instanceof ArrayBuffer))throw new Error("Invalid buffer received.");if(12>t.byteLength-e)throw new Error("Invalid MIDIFileTrack (0x"+e.toString(16)+") : Buffer length must size at least 12bytes");if(this.datas=new DataView(t,e,et.HDR_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"r"!==String.fromCharCode(this.datas.getUint8(2))||"k"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileTrack (0x"+e.toString(16)+") : MTrk prefix not found");if(r=this.getTrackLength(),t.byteLength-e<r)throw new Error("Invalid MIDIFileTrack (0x"+e.toString(16)+") : The track size exceed the buffer length.");if(this.datas=new DataView(t,e,et.HDR_LENGTH+r),255!==this.datas.getUint8(et.HDR_LENGTH+(r-3))||47!==this.datas.getUint8(et.HDR_LENGTH+(r-2))||0!==this.datas.getUint8(et.HDR_LENGTH+(r-1)))throw new Error("Invalid MIDIFileTrack (0x"+e.toString(16)+") : No track end event found at the expected index ("+(et.HDR_LENGTH+(r-1)).toString(16)+").")}else n=new Uint8Array(12),n[0]=77,n[1]=84,n[2]=114,n[3]=107,n[4]=0,n[5]=0,n[6]=0,n[7]=4,n[8]=0,n[9]=255,n[10]=47,n[11]=0,this.datas=new DataView(n.buffer,0,et.HDR_LENGTH+4)}et.HDR_LENGTH=8,et.prototype.getTrackLength=function(){return this.datas.getUint32(4)},et.prototype.setTrackLength=function(t){return this.datas.setUint32(4,t)},et.prototype.getTrackContent=function(){return new DataView(this.datas.buffer,this.datas.byteOffset+et.HDR_LENGTH,this.datas.byteLength-et.HDR_LENGTH)},et.prototype.setTrackContent=function(t){let e,n,r,o;const i=t.byteLength-t.byteOffset;if(4>i)throw new Error("Invalid track length, must size at least 4bytes");for(this.datas=new DataView(new Uint8Array(et.HDR_LENGTH+i).buffer),this.datas.setUint8(0,77),this.datas.setUint8(1,84),this.datas.setUint8(2,114),this.datas.setUint8(3,107),this.datas.setUint32(4,i),e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=new Uint8Array(this.datas.buffer,et.HDR_LENGTH,i),r=0,o=e.length;r<o;r++)n[r]=e[r]};var nt=et;function rt(){throw new Error("MIDIEvents function not intended to be run.")}rt.EVENT_META=255,rt.EVENT_SYSEX=240,rt.EVENT_DIVSYSEX=247,rt.EVENT_MIDI=8,rt.EVENT_META_SEQUENCE_NUMBER=0,rt.EVENT_META_TEXT=1,rt.EVENT_META_COPYRIGHT_NOTICE=2,rt.EVENT_META_TRACK_NAME=3,rt.EVENT_META_INSTRUMENT_NAME=4,rt.EVENT_META_LYRICS=5,rt.EVENT_META_MARKER=6,rt.EVENT_META_CUE_POINT=7,rt.EVENT_META_MIDI_CHANNEL_PREFIX=32,rt.EVENT_META_END_OF_TRACK=47,rt.EVENT_META_SET_TEMPO=81,rt.EVENT_META_SMTPE_OFFSET=84,rt.EVENT_META_TIME_SIGNATURE=88,rt.EVENT_META_KEY_SIGNATURE=89,rt.EVENT_META_SEQUENCER_SPECIFIC=127,rt.EVENT_MIDI_NOTE_OFF=8,rt.EVENT_MIDI_NOTE_ON=9,rt.EVENT_MIDI_NOTE_AFTERTOUCH=10,rt.EVENT_MIDI_CONTROLLER=11,rt.EVENT_MIDI_PROGRAM_CHANGE=12,rt.EVENT_MIDI_CHANNEL_AFTERTOUCH=13,rt.EVENT_MIDI_PITCH_BEND=14,rt.MIDI_1PARAM_EVENTS=[rt.EVENT_MIDI_PROGRAM_CHANGE,rt.EVENT_MIDI_CHANNEL_AFTERTOUCH],rt.MIDI_2PARAMS_EVENTS=[rt.EVENT_MIDI_NOTE_OFF,rt.EVENT_MIDI_NOTE_ON,rt.EVENT_MIDI_NOTE_AFTERTOUCH,rt.EVENT_MIDI_CONTROLLER,rt.EVENT_MIDI_PITCH_BEND],rt.createParser=function(t,e,n){var r,o,i,a,s;if(t instanceof DataView&&(t={position:e||0,buffer:t,readUint8:function(){return this.buffer.getUint8(this.position++)},readUint16:function(){var t=this.buffer.getUint16(this.position);return this.position=this.position+2,t},readUint32:function(){var t=this.buffer.getUint16(this.position);return this.position=this.position+2,t},readVarInt:function(){for(var t,e=0,n=0;4>n++;){if(!(128&(t=this.readUint8())))return e+t;e+=127&t,e<<=7}throw new Error("0x"+this.position.toString(16)+": Variable integer length cannot exceed 4 bytes")},readBytes:function(t){for(var e=[];0<t;t--)e.push(this.readUint8());return e},pos:function(){return"0x"+(this.buffer.byteOffset+this.position).toString(16)},end:function(){return this.position===this.buffer.byteLength}},e=0),0<e)for(;e--;)t.readUint8();return{next:function(){if(t.end())return null;if(o={index:t.pos(),delta:t.readVarInt()},240==(240&(r=t.readUint8()))){if(r!==rt.EVENT_META){if(r===rt.EVENT_SYSEX||r===rt.EVENT_DIVSYSEX)return o.type=r,o.length=t.readVarInt(),o.data=t.readBytes(o.length),o;if(n)throw new Error(t.pos()+" Unknown event type "+r.toString(16)+", Delta: "+o.delta+".");return o.type=r,o.badsubtype=t.readVarInt(),o.length=t.readUint8(),o.data=t.readBytes(o.length),o}switch(o.type=rt.EVENT_META,o.subtype=t.readUint8(),o.length=t.readVarInt(),o.subtype){case rt.EVENT_META_SEQUENCE_NUMBER:if(n&&2!==o.length)throw new Error(t.pos()+" Bad metaevent length.");return o.msb=t.readUint8(),o.lsb=t.readUint8(),o;case rt.EVENT_META_TEXT:case rt.EVENT_META_COPYRIGHT_NOTICE:case rt.EVENT_META_TRACK_NAME:case rt.EVENT_META_INSTRUMENT_NAME:case rt.EVENT_META_LYRICS:case rt.EVENT_META_MARKER:case rt.EVENT_META_CUE_POINT:return o.data=t.readBytes(o.length),o;case rt.EVENT_META_MIDI_CHANNEL_PREFIX:if(n&&1!==o.length)throw new Error(t.pos()+" Bad metaevent length.");return o.prefix=t.readUint8(),o;case rt.EVENT_META_END_OF_TRACK:if(n&&0!==o.length)throw new Error(t.pos()+" Bad metaevent length.");return o;case rt.EVENT_META_SET_TEMPO:if(n&&3!==o.length)throw new Error(t.pos()+" Tempo meta event length must be 3.");return o.tempo=(t.readUint8()<<16)+(t.readUint8()<<8)+t.readUint8(),o.tempoBPM=6e7/o.tempo,o;case rt.EVENT_META_SMTPE_OFFSET:if(n&&5!==o.length)throw new Error(t.pos()+" Bad metaevent length.");if(o.hour=t.readUint8(),n&&23<o.hour)throw new Error(t.pos()+" SMTPE offset hour value must be part of 0-23.");if(o.minutes=t.readUint8(),n&&59<o.minutes)throw new Error(t.pos()+" SMTPE offset minutes value must be part of 0-59.");if(o.seconds=t.readUint8(),n&&59<o.seconds)throw new Error(t.pos()+" SMTPE offset seconds value must be part of 0-59.");if(o.frames=t.readUint8(),n&&30<o.frames)throw new Error(t.pos()+" SMTPE offset frames value must be part of 0-30.");if(o.subframes=t.readUint8(),n&&99<o.subframes)throw new Error(t.pos()+" SMTPE offset subframes value must be part of 0-99.");return o;case rt.EVENT_META_KEY_SIGNATURE:if(n&&2!==o.length)throw new Error(t.pos()+" Bad metaevent length.");if(o.key=t.readUint8(),n&&(-7>o.key||7<o.key))throw new Error(t.pos()+" Bad metaevent length.");if(o.scale=t.readUint8(),n&&0!==o.scale&&1!==o.scale)throw new Error(t.pos()+" Key signature scale value must be 0 or 1.");return o;case rt.EVENT_META_TIME_SIGNATURE:if(n&&4!==o.length)throw new Error(t.pos()+" Bad metaevent length.");return o.data=t.readBytes(o.length),o.param1=o.data[0],o.param2=o.data[1],o.param3=o.data[2],o.param4=o.data[3],o;case rt.EVENT_META_SEQUENCER_SPECIFIC:return o.data=t.readBytes(o.length),o;default:if(n)throw new Error(t.pos()+" Unknown meta event type ("+o.subtype.toString(16)+").");return o.data=t.readBytes(o.length),o}}else{if(0==(128&r)){if(!i)throw new Error(t.pos()+" Running status without previous event");s=r}else i=r>>4,a=15&r,s=t.readUint8();switch(o.type=rt.EVENT_MIDI,o.subtype=i,o.channel=a,o.param1=s,i){case rt.EVENT_MIDI_NOTE_OFF:return o.param2=t.readUint8(),o;case rt.EVENT_MIDI_NOTE_ON:return o.param2=t.readUint8(),o.param2||(o.subtype=rt.EVENT_MIDI_NOTE_OFF,o.param2=127),o;case rt.EVENT_MIDI_NOTE_AFTERTOUCH:case rt.EVENT_MIDI_CONTROLLER:return o.param2=t.readUint8(),o;case rt.EVENT_MIDI_PROGRAM_CHANGE:case rt.EVENT_MIDI_CHANNEL_AFTERTOUCH:return o;case rt.EVENT_MIDI_PITCH_BEND:return o.param2=t.readUint8(),o;default:if(n)throw new Error(t.pos()+" Unknown MIDI event type ("+i.toString(16)+").");return o}}}}},rt.writeToTrack=function(t,e,n){var r,o,i,a,s=0;for(r=0,o=t.length;r<o;r++){if(t[r].delta>>>28)throw Error("Event #"+r+": Maximum delta time value reached ("+t[r].delta+"/134217728 max)");if(t[r].delta>>>21&&(e[s++]=t[r].delta>>>21&127|128),t[r].delta>>>14&&(e[s++]=t[r].delta>>>14&127|128),t[r].delta>>>7&&(e[s++]=t[r].delta>>>7&127|128),e[s++]=127&t[r].delta,t[r].type===rt.EVENT_MIDI)e[s++]=(t[r].subtype<<4)+t[r].channel,e[s++]=t[r].param1,-1!==rt.MIDI_2PARAMS_EVENTS.indexOf(t[r].subtype)&&(e[s++]=t[r].param2);else{if(e[s++]=t[r].type,t[r].type===rt.EVENT_META&&(e[s++]=t[r].subtype),t[r].length>>>28)throw Error("Event #"+r+": Maximum length reached ("+t[r].length+"/134217728 max)");if(t[r].length>>>21&&(e[s++]=t[r].length>>>21&127|128),t[r].length>>>14&&(e[s++]=t[r].length>>>14&127|128),t[r].length>>>7&&(e[s++]=t[r].length>>>7&127|128),e[s++]=127&t[r].length,t[r].type===rt.EVENT_META)switch(t[r].subtype){case rt.EVENT_META_SEQUENCE_NUMBER:e[s++]=t[r].msb,e[s++]=t[r].lsb;break;case rt.EVENT_META_TEXT:case rt.EVENT_META_COPYRIGHT_NOTICE:case rt.EVENT_META_TRACK_NAME:case rt.EVENT_META_INSTRUMENT_NAME:case rt.EVENT_META_LYRICS:case rt.EVENT_META_MARKER:case rt.EVENT_META_CUE_POINT:for(i=0,a=t[r].length;i<a;i++)e[s++]=t[r].data[i];break;case rt.EVENT_META_MIDI_CHANNEL_PREFIX:e[s++]=t[r].prefix;break;case rt.EVENT_META_END_OF_TRACK:break;case rt.EVENT_META_SET_TEMPO:e[s++]=t[r].tempo>>16,e[s++]=t[r].tempo>>8&255,e[s++]=255&t[r].tempo;break;case rt.EVENT_META_SMTPE_OFFSET:if(n&&23<t[r].hour)throw new Error("Event #"+r+": SMTPE offset hour value must be part of 0-23.");if(e[s++]=t[r].hour,n&&59<t[r].minutes)throw new Error("Event #"+r+": SMTPE offset minutes value must be part of 0-59.");if(e[s++]=t[r].minutes,n&&59<t[r].seconds)throw new Error("Event #"+r+": SMTPE offset seconds value must be part of 0-59.");if(e[s++]=t[r].seconds,n&&30<t[r].frames)throw new Error("Event #"+r+": SMTPE offset frames amount must be part of 0-30.");if(e[s++]=t[r].frames,n&&99<t[r].subframes)throw new Error("Event #"+r+": SMTPE offset subframes amount must be part of 0-99.");e[s++]=t[r].subframes;break;case rt.EVENT_META_KEY_SIGNATURE:if("number"!=typeof t[r].key||-7>t[r].key||7<t[r].scale)throw new Error("Event #"+r+":The key signature key must be between -7 and 7");if("number"!=typeof t[r].scale||0>t[r].scale||1<t[r].scale)throw new Error("Event #"+r+":The key signature scale must be 0 or 1");e[s++]=t[r].key,e[s++]=t[r].scale;break;case rt.EVENT_META_TIME_SIGNATURE:case rt.EVENT_META_SEQUENCER_SPECIFIC:default:for(i=0,a=t[r].length;i<a;i++)e[s++]=t[r].data[i]}else for(i=0,a=t[r].length;i<a;i++)e[s++]=t[r].data[i]}}},rt.getRequiredBufferLength=function(t){var e,n=0,r=0;for(r=0,e=t.length;r<e;r++)n+=t[r].delta>>>21?4:t[r].delta>>>14?3:t[r].delta>>>7?2:1,t[r].type===rt.EVENT_MIDI?(n++,n++,-1!==rt.MIDI_2PARAMS_EVENTS.indexOf(t[r].subtype)&&n++):(n++,t[r].type===rt.EVENT_META&&n++,n+=t[r].length>>>21?4:t[r].length>>>14?3:t[r].length>>>7?2:1,n+=t[r].length);return n};var ot=rt,it={isNotUTF8:function(t,e,n){try{ct(t,e,n,!0)}catch(t){return!0}return!1},getCharLength:at,getCharCode:st,getStringFromBytes:ct,getBytesForCharCode:ut,setBytesFromCharCode:lt,setBytesFromString:function(t,e,n,r,o){t=t||"",e=e||[],n|=0,r="number"==typeof r?r:e.byteLength||1/0;for(var i=0,a=t.length;i<a;i++){var s=ut(t[i].codePointAt(0));if(o&&n+s>r)throw new Error('Not enought bytes to encode the char "'+t[i]+'" at the offset "'+n+'".');lt(t[i].codePointAt(0),e,n,s),n+=s}return e}};function at(t){return 240==(240&t)?4:224==(224&t)?3:192==(192&t)?2:t==(127&t)?1:0}function st(t,e,n){var r=0,o="";if(e=e||0,t.length-e<=0)throw new Error("No more characters remaining in array.");if(0==(n=n||at(t[e])))throw new Error(t[e].toString(2)+" is not a significative byte (offset:"+e+").");if(1===n)return t[e];if(t.length-e<n)throw new Error("Expected at least "+n+" bytes remaining in array.");if(o="00000000".slice(0,n)+1+"00000000".slice(n+1),t[e]&parseInt(o,2))throw Error("Index "+e+": A "+n+" bytes encoded char cannot encode the "+(n+1)+"th rank bit to 1.");for(o="0000".slice(0,n+1)+"11111111".slice(n+1),r+=(t[e]&parseInt(o,2))<<6*--n;n;){if(128!=(128&t[e+1])||64==(64&t[e+1]))throw Error("Index "+(e+1)+': Next bytes of encoded char must begin with a "10" bit sequence.');r+=(63&t[++e])<<6*--n}return r}function ct(t,e,n,r){var o,i=[];for(e|=0,n="number"==typeof n?n:t.byteLength||t.length;e<n;e++){if(e+(o=at(t[e]))>n){if(r)throw Error("Index "+e+": Found a "+o+" bytes encoded char declaration but only "+(n-e)+" bytes are available.")}else i.push(String.fromCodePoint(st(t,e,o)));e+=o-1}return i.join("")}function ut(t){if(t<128)return 1;if(t<2048)return 2;if(t<65536)return 3;if(t<2097152)return 4;throw new Error("CharCode "+t+" cannot be encoded with UTF8.")}function lt(t,e,n,r){if(t|=0,e=e||[],n|=0,1==(r=r||ut(t)))e[n]=t;else for(e[n++]=(parseInt("1111".slice(0,r),2)<<8-r)+(t>>>6*--r);r>0;)e[n++]=t>>>6*--r&63|128;return e}function ft(t,e){var n,r,o,i;if(t){if(25>(t=function(t){if(t){if(t instanceof ArrayBuffer)return t;if(t instanceof Uint8Array)return new Uint8Array(t).buffer}throw new Error("Unsupported buffer type, need ArrayBuffer or Uint8Array")}(t)).byteLength)throw new Error("A buffer of a valid MIDI file must have, at least, a size of 25bytes.");for(this.header=new tt(t),this.tracks=[],r=tt.HEADER_LENGTH,o=0,i=this.header.getTracksCount();o<i;o++){if(e&&r>=t.byteLength-1)throw new Error("Couldn't find datas corresponding to the track #"+o+".");n=new nt(t,r),this.tracks.push(n),r+=n.getTrackLength()+8}if(e&&r!==t.byteLength)throw new Error("It seems that the buffer contains too much datas.")}else this.header=new tt,this.tracks=[new nt]}ft.prototype.getEvents=function(t,e){var n,r,o,i,a,s,c=0,u=[],l=this.header.getFormat(),f=this.header.getTickResolution();if(1!==l||1===this.tracks.length)for(o=0,i=this.tracks.length;o<i;o++)for(c=2===l&&c?c:0,r=(n=ot.createParser(this.tracks[o].getTrackContent(),0,!1)).next();r;)c+=r.delta?r.delta*f/1e3:0,r.type===ot.EVENT_META&&r.subtype===ot.EVENT_META_SET_TEMPO&&(f=this.header.getTickResolution(r.tempo)),t&&r.type!==t||e&&(!r.subtype||r.subtype!==e)||(r.playTime=c,u.push(r)),r=n.next();else{for(a=[],s=-1,o=0,i=this.tracks.length;o<i;o++)a[o]={},a[o].parser=ot.createParser(this.tracks[o].getTrackContent(),0,!1),a[o].curEvent=a[o].parser.next();do{for(s=-1,o=0,i=a.length;o<i;o++)a[o].curEvent&&(-1===s||a[o].curEvent.delta<a[s].curEvent.delta)&&(s=o);if(-1!==s){for(o=0,i=a.length;o<i;o++)o!==s&&a[o].curEvent&&(a[o].curEvent.delta-=a[s].curEvent.delta);c+=(r=a[s].curEvent).delta?r.delta*f/1e3:0,r.type===ot.EVENT_META&&r.subtype===ot.EVENT_META_SET_TEMPO&&(f=this.header.getTickResolution(r.tempo)),t&&r.type!==t||e&&(!r.subtype||r.subtype!==e)||(r.playTime=c,r.track=s,u.push(r)),a[s].curEvent=a[s].parser.next()}}while(-1!==s)}return u},ft.prototype.getMidiEvents=function(){return this.getEvents(ot.EVENT_MIDI)},ft.prototype.getLyrics=function(){var t,e,n,r=this.getEvents(ot.EVENT_META),o=[],i=[];for(e=0,n=r.length;e<n;e++)(t=r[e]).subtype===ot.EVENT_META_LYRICS?i.push(t):t.subtype===ot.EVENT_META_TEXT&&("@"===String.fromCharCode(t.data[0])?"T"===String.fromCharCode(t.data[1])||"I"===String.fromCharCode(t.data[1])||String.fromCharCode(t.data[1]):0===String.fromCharCode.apply(String,t.data).indexOf("words")?o.length=0:0!==t.playTime&&o.push(t));2<i.length?o=i:o.length||(o=[]);try{o.forEach((function(t){t.text=it.getStringFromBytes(t.data,0,t.length,!0)}))}catch(t){o.forEach((function(t){t.text=t.data.map((function(t){return String.fromCharCode(t)})).join("")}))}return o},ft.prototype.getTrackEvents=function(t){var e,n,r=[];if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");e=(n=ot.createParser(this.tracks[t].getTrackContent(),0,!1)).next();do{r.push(e),e=n.next()}while(e);return r},ft.prototype.setTrackEvents=function(t,e){var n,r;if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");if(!e||!e.length)throw Error("A track must contain at least one event, none given.");n=ot.getRequiredBufferLength(e),r=new Uint8Array(n),ot.writeToTrack(e,r),this.tracks[t].setTrackContent(r)},ft.prototype.deleteTrack=function(t){if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");this.tracks.splice(t,1),this.header.setTracksCount(this.tracks.length)},ft.prototype.addTrack=function(t){var e;if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");e=new nt,t===this.tracks.length?this.tracks.push(e):this.tracks.splice(t,0,e),this.header.setTracksCount(this.tracks.length)},ft.prototype.getContent=function(){var t,e,n,r,o,i,a,s,c;for(t=tt.HEADER_LENGTH,r=0,o=this.tracks.length;r<o;r++)t+=this.tracks[r].getTrackLength()+8;for(e=new Uint8Array(t),n=new Uint8Array(this.header.datas.buffer,this.header.datas.byteOffset,tt.HEADER_LENGTH),r=0,o=tt.HEADER_LENGTH;r<o;r++)e[r]=n[r];for(i=0,a=this.tracks.length;i<a;i++)for(n=new Uint8Array(this.tracks[i].datas.buffer,this.tracks[i].datas.byteOffset,this.tracks[i].datas.byteLength),s=0,c=this.tracks[i].datas.byteLength;s<c;s++)e[r++]=n[s];return e.buffer},ft.Header=tt,ft.Track=nt;var ht=ft;class Et{constructor(t,e,n,r,o,i="keep",a="keep"){this.value=t,this.playTime=e,this.delta=o,this.char=Tt[t-21],this.tempo=n,this.BPM=r,this.valid=t>=21&&t<=108,this.outOfRange=t<=35||t>=97,"!@#$%^&*()QWERTYUIOPASDFGHJKLZXCBVNM".includes(this.char)?"Start"===i?this.displayValue=t-108:"End"==i&&(this.displayValue=t+108):this.outOfRange?"Start"===a?this.displayValue=t-1024:"End"==a&&(this.displayValue=t+1024):this.displayValue=t}}class dt{constructor(t,e=!0){let n=!1,r=t[0];for(let e of t){if(e.playTime!=r.playTime){n=!0;break}r=e}if(this.is_quantized=n,n)this.notes=e?t:t.sort(((t,e)=>t.displayValue-e.displayValue));else{let e=[],n=[];t.forEach((t=>{e.includes(t.value)||(e.push(t.value),n.push(t))})),this.notes=n.sort(((t,e)=>t.displayValue-e.displayValue))}}}class pt{constructor(t){this.chords=t}transpose(t,e="Start",n="Start",r=!0){let o=[];return this.chords.forEach((i=>{let a=[];i.notes.forEach((r=>{a.push(new Et(r.value+t,r.playTime,r.tempo,r.BPM,r.delta,e,n))})),o.push(new dt(a,r))})),new pt(o)}}const Tt="1234567890qwert1!2@34$5%6^78*9(0qQwWeErtTyYuiIoOpPasSdDfgGhHjJklLzZxcCvVbBnmyuiopasdfghj",gt="1234567890qwertyuiopasdfghklzxcvbnm";function _t(t,e){function n(t){let e=[];for(let n of t.chords)for(let t of n.notes)e.push({char:t.char,oor:t.outOfRange,valid:t.valid});return e.filter((t=>gt.includes(t.char)&&!1===t.oor&&!0===t.valid)).length}let r=0,o=0;for(let i=-e;i<=e;i++){let a=n(t.transpose(i))+Math.abs(e)/10;a>r&&(r=a,o=i)}return o}function mt(t,e){return e<t/4?"-":e<t/2?" ":e<t?" - ":e<2*t?", ":e<2.5*t?". ":e<3*t?".. ":e<4*t?"... ":"\n"}function yt(t){let e,n,o,i,u,E,p,N,w,v,M,I,k,A,S,C,x,V,$,R,D,P,O,H,L,F,B,q,G,z,K,Q,Y,X,j,J,W,Z,tt,et,nt,rt,ot,it,at,st,ct,ut,lt,ft,ht,Et,dt,pt,Tt,gt=1==t[0].beats?"1 beat":`${t[0].beats} beats`,_t=t[0].quantize+"";return{c(){e=l("div"),n=l("label"),n.textContent="Transpose (sheet) by:",o=h(),i=l("input"),u=h(),E=l("button"),E.textContent="Auto-transpose",p=h(),N=l("div"),w=l("div"),v=l("label"),v.textContent="Place shifted notes at:",M=h(),I=l("select"),k=l("option"),k.textContent="Start",A=l("option"),A.textContent="End",S=h(),C=l("div"),x=l("label"),x.textContent="Place out of range notes at:",V=h(),$=l("select"),R=l("option"),R.textContent="Start",D=l("option"),D.textContent="End",P=h(),O=l("div"),H=l("label"),H.textContent="Break lines:",L=h(),F=l("input"),B=h(),q=l("span"),G=f("Every "),z=f(gt),K=h(),Q=l("div"),Y=l("label"),Y.textContent="Quantize:",X=h(),j=l("input"),J=h(),W=l("span"),Z=f(_t),tt=f(" miliseconds"),et=h(),nt=l("label"),rt=l("input"),ot=f("\n        Sequential quantizes"),it=h(),at=l("label"),st=l("input"),ct=f("\n        Include out of range (ctrl) notes"),ut=h(),lt=l("label"),ft=l("input"),ht=f("\n        Show tempo marks"),Et=h(),dt=l("style"),dt.textContent='label {\n        max-width: fit-content;\n        text-align: center;\n    }\n\n    .select-div {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        text-align: center;\n    }\n\n    select {\n        height: auto;\n        margin-left: 0.4em;\n        margin-top: 0.2em;\n        margin-bottom: 0;\n    }\n\n    input[type="checkbox"] {\n        display: inline-block;\n        vertical-align: middle;\n    }\n\n    input[type="range"] {\n        margin-left: 0.4em;\n        margin-right: 0.4em;\n        margin-bottom: 0;\n    }\n\n    input[type="file"] {\n        margin-bottom: 0;\n    }\n    \n    .beats, .quantize, .select-label {\n        display: flex;\n        flex-direction: row;\n    }',T(n,"for","number"),T(i,"type","number"),T(i,"min","-24"),T(i,"max","24"),y(e,"display","inline-block"),T(v,"for","shifts-position"),k.__value="Start",k.value=k.__value,A.__value="End",A.value=A.__value,T(I,"name","shifts-position"),T(I,"id","shifts-position"),void 0===t[0].pShifts&&U((()=>t[5].call(I))),T(w,"class","select-div"),T(x,"for","oors-position"),R.__value="Start",R.value=R.__value,D.__value="End",D.value=D.__value,T($,"name","oors-position"),T($,"id","oors-position"),void 0===t[0].pOors&&U((()=>t[6].call($))),T(C,"class","select-div"),T(H,"class","slider-label"),T(H,"for","beats-for-newline"),T(F,"type","range"),T(F,"id","beats-for-newline"),T(F,"min","1"),T(F,"max","32"),T(O,"class","beats"),T(Y,"class","slider-label"),T(Y,"for","quantize-prompt"),T(j,"type","range"),T(j,"id","quantize-prompt"),T(j,"min","1"),T(j,"max","100"),T(Q,"class","quantize"),T(rt,"type","checkbox"),T(rt,"id","order-quantizes"),T(nt,"for","order-quantizes"),T(st,"type","checkbox"),T(st,"id","out-of-range"),T(at,"for","out-of-range"),T(ft,"type","checkbox"),T(ft,"id","tempo-checkbox"),T(lt,"for","tempo-checkbox")},m(r,c){s(r,e,c),a(e,n),a(e,o),a(e,i),m(i,t[0].transposition),a(e,u),a(e,E),s(r,p,c),s(r,N,c),a(N,w),a(w,v),a(w,M),a(w,I),a(I,k),a(I,A),b(I,t[0].pShifts),a(N,S),a(N,C),a(C,x),a(C,V),a(C,$),a($,R),a($,D),b($,t[0].pOors),a(N,P),a(N,O),a(O,H),a(O,L),a(O,F),m(F,t[0].beats),a(O,B),a(O,q),a(q,G),a(q,z),a(N,K),a(N,Q),a(Q,Y),a(Q,X),a(Q,j),m(j,t[0].quantize),a(Q,J),a(Q,W),a(W,Z),a(W,tt),a(N,et),a(N,nt),a(nt,rt),rt.checked=t[0].sequentialQuantize,a(nt,ot),a(N,it),a(N,at),a(at,st),st.checked=t[0].oors,a(at,ct),a(N,ut),a(N,lt),a(lt,ft),ft.checked=t[0].tempoMarks,a(lt,ht),s(r,Et,c),s(r,dt,c),pt||(Tt=[d(i,"input",t[3]),d(E,"click",t[4]),d(I,"change",t[5]),d($,"change",t[6]),d(F,"change",t[7]),d(F,"input",t[7]),d(j,"change",t[8]),d(j,"input",t[8]),d(rt,"change",t[9]),d(st,"change",t[10]),d(ft,"change",t[11])],pt=!0)},p(t,e){1&e&&g(i.value)!==t[0].transposition&&m(i,t[0].transposition),1&e&&b(I,t[0].pShifts),1&e&&b($,t[0].pOors),1&e&&m(F,t[0].beats),1&e&&gt!==(gt=1==t[0].beats?"1 beat":`${t[0].beats} beats`)&&_(z,gt),1&e&&m(j,t[0].quantize),1&e&&_t!==(_t=t[0].quantize+"")&&_(Z,_t),1&e&&(rt.checked=t[0].sequentialQuantize),1&e&&(st.checked=t[0].oors),1&e&&(ft.checked=t[0].tempoMarks)},d(t){t&&c(e),t&&c(p),t&&c(N),t&&c(Et),t&&c(dt),pt=!1,r(Tt)}}}function bt(e){let n,r=e[1]&&yt(e);return{c(){r&&r.c(),n=E()},m(t,e){r&&r.m(t,e),s(t,n,e)},p(t,[e]){t[1]?r?r.p(t,e):(r=yt(t),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:t,o:t,d(t){r&&r.d(t),t&&c(n)}}}function Nt(t,e,n){let r=I(),{show:o}=e,{settings:i={beats:4,quantize:35,sequentialQuantize:!1,pShifts:"Start",pOors:"Start",oors:!0,tempoMarks:!1,transposition:0}}=e;return t.$$set=t=>{"show"in t&&n(1,o=t.show),"settings"in t&&n(0,i=t.settings)},[i,o,r,function(){i.transposition=g(this.value),n(0,i)},()=>{r("auto")},function(){i.pShifts=N(this),n(0,i)},function(){i.pOors=N(this),n(0,i)},function(){i.beats=g(this.value),n(0,i)},function(){i.quantize=g(this.value),n(0,i)},function(){i.sequentialQuantize=this.checked,n(0,i)},function(){i.oors=this.checked,n(0,i)},function(){i.tempoMarks=this.checked,n(0,i)}]}class wt extends W{constructor(t){super(),J(this,t,Nt,bt,i,{show:1,settings:0})}}function vt(e){let n,r,o,i,u,h,E,p,g,m=e[1].getTrackLength()+"";return{c(){n=l("div"),r=l("input"),o=f("\n    Track "),i=f(e[2]),u=f(" - "),h=f(m),E=f(" events"),T(r,"type","checkbox"),T(n,"id","track")},m(t,c){s(t,n,c),a(n,r),r.checked=e[0],a(n,o),a(n,i),a(n,u),a(n,h),a(n,E),p||(g=d(r,"change",e[3]),p=!0)},p(t,[e]){1&e&&(r.checked=t[0]),4&e&&_(i,t[2]),2&e&&m!==(m=t[1].getTrackLength()+"")&&_(h,m)},i:t,o:t,d(t){t&&c(n),p=!1,g()}}}function Mt(t,e,n){let{track:r,idx:o}=e,{selected:i=!1}=e;return t.$$set=t=>{"track"in t&&n(1,r=t.track),"idx"in t&&n(2,o=t.idx),"selected"in t&&n(0,i=t.selected)},[i,r,o,function(){i=this.checked,n(0,i)}]}class It extends W{constructor(t){super(),J(this,t,Mt,vt,i,{track:1,idx:2,selected:0})}}const kt={long:"white",quadruple:"#a3f0a3",whole:"#74da74",half:"#9ada5a",quarter:"#c0c05a",eighth:"#da7e5a",sixteenth:"#daa6a6",thirtysecond:"#ff1900",sixtyfourth:"#9c0f00"};function At(t,e){return`<span style="color:${e}">${t}</span>`}function St(e){let n,o,i,u,f=e[4](e[2])+"";return{c(){n=l("div"),o=l("button"),T(o,"class","line svelte-1kpp6te"),T(n,"class","viewer svelte-1kpp6te")},m(t,r){s(t,n,r),a(n,o),o.innerHTML=f,i||(u=[d(o,"mousedown",p(e[10])),d(o,"contextmenu",p(e[9]))],i=!0)},p(t,[e]){4&e&&f!==(f=t[4](t[2])+"")&&(o.innerHTML=f)},i:t,o:t,d(t){t&&c(n),i=!1,r(u)}}}function Ct(t,e,n){let r=I(),{index:o}=e,{line:i}=e,{passedNext:a}=e,s=new pt(i.chords),c=s,{sameTranspositionAsPrevious:u=!1}=e,{settings:l}=e;function f(t,e){let n=`<span style="color:${e}">`,r=t.notes.length>1&&t.notes.find((t=>!0===t.valid));!1===l.oors&&t.notes.filter((t=>!1===t.outOfRange)).length<=1&&(r=!1),r&&(n+="[");for(const r of t.notes)r.valid?!0===r.outOfRange?!0===l.oors&&(n+=`<span style="display:inline-block; border-bottom: 2px solid ${e}">${r.char}</span>`):n+=r.char:n+="_";return r&&(n+="]"),n+"</span>"}return t.$$set=t=>{"index"in t&&n(0,o=t.index),"line"in t&&n(5,i=t.line),"passedNext"in t&&n(6,a=t.passedNext),"sameTranspositionAsPrevious"in t&&n(7,u=t.sameTranspositionAsPrevious),"settings"in t&&n(8,l=t.settings)},t.$$.update=()=>{290&t.$$.dirty&&(n(1,s=new pt(i.chords)),n(2,c=s.transpose(i.transposition,l.pShifts,l.pOors,l.sequentialQuantize)))},[o,s,c,r,function(t){const e=-i.transposition;let n="";u||(n+=At(`Transpose by: ${e>0?"+":""}${e}`,"white"),i.difference&&(n+=At(` (${-i.difference>0?"+":""}${-i.difference})`,"white")),n+="\n");let r=t.chords;for(let t=0;t<r.length;t++){if(!r){n+="[bad-midi-file!]<br>";continue}const e={chord:r[t]};e.note=e.chord?.notes[0];const o={chord:r[t+1]};if(o.note=o.chord?.notes[0],!e.note)continue;if(!o.note){if(!a){n+=f(e.chord,"white");continue}o.note=a}let i=e.note.tempo/1e3,s=o.note.playTime-e.note.playTime;e.chord.is_quantized&&(s=o.note.playTime-e.chord.notes.slice(-1)[0].playTime),s-=.5;let c=kt.long;s<i/16?c=kt.sixtyfourth:s<i/8?c=kt.thirtysecond:s<i/4?c=kt.sixteenth:s<i/2?c=kt.eighth:s<i?c=kt.quarter:s<2*i?c=kt.half:s<2*i?c=kt.whole:s<4*i?c=kt.quadruple:s<8*i&&(c=kt.long),n+=f(e.chord,c),n+=l.tempoMarks?At(mt(i,s),c):" "}return n},i,a,u,l,function(e){k.call(this,t,e)},t=>{switch(t.button){case 0:r("transpose",{index:+o,by:1});break;case 1:r("auto",{index:+o,sheet:s});break;case 2:r("transpose",{index:+o,by:-1})}}]}class xt extends W{constructor(t){super(),J(this,t,Ct,St,i,{index:0,line:5,passedNext:6,sameTranspositionAsPrevious:7,settings:8})}}function Vt(t,e,n){const r=t.slice();r[22]=e[n][0],r[23]=e[n][1];const o=r[1][r[22]-1];r[24]=o;const i=r[23].continuation;r[25]=i;const a=r[24]?.transposition==r[23].transposition;return r[26]=a,r}function $t(t,e,n){const r=t.slice();return r[29]=e[n],r[30]=e,r[31]=n,r}function Ut(t){let e,n,r,o,i,f,E,p=t[5],g=[];for(let e=0;e<p.length;e+=1)g[e]=Rt($t(t,p,e));const _=t=>z(g[t],1,1,(()=>{g[t]=null}));return{c(){e=l("section"),n=l("div");for(let t=0;t<g.length;t+=1)g[t].c();r=h(),o=l("button"),o.textContent="Import selected tracks",T(n,"id","tracks"),T(e,"id","track-chooser")},m(c,u){s(c,e,u),a(e,n);for(let t=0;t<g.length;t+=1)g[t].m(n,null);a(e,r),a(e,o),i=!0,f||(E=d(o,"click",t[16]),f=!0)},p(t,e){if(96&e[0]){let r;for(p=t[5],r=0;r<p.length;r+=1){const o=$t(t,p,r);g[r]?(g[r].p(o,e),G(g[r],1)):(g[r]=Rt(o),g[r].c(),G(g[r],1),g[r].m(n,null))}for(B(),r=p.length;r<g.length;r+=1)_(r);q()}},i(t){if(!i){for(let t=0;t<p.length;t+=1)G(g[t]);i=!0}},o(t){g=g.filter(Boolean);for(let t=0;t<g.length;t+=1)z(g[t]);i=!1},d(t){t&&c(e),u(g,t),f=!1,E()}}}function Rt(t){let e,n,r;function o(e){t[15](e,t[31])}let i={track:t[29],idx:t[31]+1};return void 0!==t[6][t[31]]&&(i.selected=t[6][t[31]]),e=new It({props:i}),S.push((()=>K(e,"selected",o))),{c(){Q(e.$$.fragment)},m(t,n){Y(e,t,n),r=!0},p(r,o){t=r;const i={};32&o[0]&&(i.track=t[29]),!n&&64&o[0]&&(n=!0,i.selected=t[6][t[31]],R((()=>n=!1))),e.$set(i)},i(t){r||(G(e.$$.fragment,t),r=!0)},o(t){z(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function Dt(t){let e,n,r=Object.entries(t[1]),o=[];for(let e=0;e<r.length;e+=1)o[e]=Pt(Vt(t,r,e));const i=t=>z(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=E()},m(t,r){for(let e=0;e<o.length;e+=1)o[e].m(t,r);s(t,e,r),n=!0},p(t,n){if(3075&n[0]){let a;for(r=Object.entries(t[1]),a=0;a<r.length;a+=1){const i=Vt(t,r,a);o[a]?(o[a].p(i,n),G(o[a],1)):(o[a]=Pt(i),o[a].c(),G(o[a],1),o[a].m(e.parentNode,e))}for(B(),a=r.length;a<o.length;a+=1)i(a);q()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)G(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)z(o[t]);n=!1},d(t){u(o,t),t&&c(e)}}}function Pt(t){let e,n;return e=new xt({props:{line:t[23],sameTranspositionAsPrevious:t[26],index:t[22],settings:t[0],passedNext:t[25]}}),e.$on("transpose",t[10]),e.$on("auto",t[11]),{c(){Q(e.$$.fragment)},m(t,r){Y(e,t,r),n=!0},p(t,n){const r={};2&n[0]&&(r.line=t[23]),2&n[0]&&(r.sameTranspositionAsPrevious=t[26]),2&n[0]&&(r.index=t[22]),1&n[0]&&(r.settings=t[0]),2&n[0]&&(r.passedNext=t[25]),e.$set(r)},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){z(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Ot(t){let e,n,r,o,i,u,f,d,p,g,_,m;function b(e){t[14](e)}let N={show:t[4]};void 0!==t[0]&&(N.settings=t[0]),f=new wt({props:N}),S.push((()=>K(f,"settings",b))),f.$on("auto",t[9]);let w=t[3]&&Ut(t),v=t[4]&&Dt(t);return{c(){e=h(),n=l("div"),r=l("label"),r.textContent="Please import a MIDI file:",o=h(),i=l("input"),u=h(),Q(f.$$.fragment),p=h(),w&&w.c(),g=h(),v&&v.c(),_=E(),document.title="MIDI Converter",T(r,"for","file"),T(i,"type","file"),T(i,"accept",".mid,.midi"),y(n,"display","inline-block")},m(c,l){s(c,e,l),s(c,n,l),a(n,r),a(n,o),a(n,i),t[13](i),s(c,u,l),Y(f,c,l),s(c,p,l),w&&w.m(c,l),s(c,g,l),v&&v.m(c,l),s(c,_,l),m=!0},p(t,e){const n={};16&e[0]&&(n.show=t[4]),!d&&1&e[0]&&(d=!0,n.settings=t[0],R((()=>d=!1))),f.$set(n),t[3]?w?(w.p(t,e),8&e[0]&&G(w,1)):(w=Ut(t),w.c(),G(w,1),w.m(g.parentNode,g)):w&&(B(),z(w,1,1,(()=>{w=null})),q()),t[4]?v?(v.p(t,e),16&e[0]&&G(v,1)):(v=Dt(t),v.c(),G(v,1),v.m(_.parentNode,_)):v&&(B(),z(v,1,1,(()=>{v=null})),q())},i(t){m||(G(f.$$.fragment,t),G(w),G(v),m=!0)},o(t){z(f.$$.fragment,t),z(w),z(v),m=!1},d(r){r&&c(e),r&&c(n),t[13](null),r&&c(u),X(f,r),r&&c(p),w&&w.d(r),r&&c(g),v&&v.d(r),r&&c(_)}}}let Ht=.5;function Lt(t,e,n){let r,o,i,a,s,c=!1,u=!1,l=0;var f;function h(t){if(!t)return!1;let e=t.tempo/1e3*d.beats,n=t.playTime-l;return n+Ht>=e?(l+=n,!0):void 0}f=()=>{r.addEventListener("change",(async()=>{await r.files[0].arrayBuffer().then((t=>{o=new ht(t),function(t){return t.header.getTimeDivision()===ht.Header.TICKS_PER_BEAT?{ticksPerBeat:t.header.getTicksPerBeat()}:{SMPTEFrames:t.header.getSMPTEFrames(),ticksPerFrame:t.header.getTicksPerFrame()}}(o).ticksPerBeat||console.error("No ticksPerBeat in this midi file"),n(5,i=o.tracks),n(6,s=i.map((()=>!0))),n(3,c=!0),n(4,u=!1),l=0}))}),!1)},M().$$.on_mount.push(f);let E,d,p=()=>{a=function(t,e=100,n="Start",r="Start",o=!0){let i=[],a=[],s=t[0].playTime??0,c=0,u=0;return t.forEach((t=>{if(81==t.subtype)return u=t.tempo,void(c=t.tempoBPM);const l=t.param1,f=t.playTime,h=t.delta;Math.abs(f-s)<e?(a.push(new Et(l,f,u,c,h,n,r)),s=f):(i.push(new dt(a,o)),a=[],a.push(new Et(l,f,u,c,h,n,r)),s=f)})),i.push(new dt(a)),new pt(i)}(function(t,e){let n=[];return t.getEvents().forEach((t=>{t.subtype==ot.EVENT_META_SET_TEMPO&&n.push(t),t.subtype==ot.EVENT_MIDI_NOTE_ON&&(t.track||!0!==e[0]?!0===e[t.track]&&n.push(t):n.push(t))})),n}(o,s),d.quantize,d.pShifts,d.pOors,d.sequentialQuantize)},T=()=>{if(n(4,u=!1),!a)return;const t=a.chords;l=0,n(1,g=[]);let e=[];for(let n=0;n<=t.length;n++){const r={chord:t[n]};r.note=r.chord?.notes[0];const o={chord:t[n+1]};o.note=o.chord?.notes[0],r.note&&(h(r.note)&&(g.push({chords:e,transposition:d.transposition,continuation:r.note}),e=[]),e.push(r.chord))}g.push({chords:e,transposition:0,continuation:void 0}),n(4,u=!0),n(3,c=!1),n(1,g),n(12,E),n(0,d),n(8,T),n(7,p)},g=[];function _(t,e){let r=+t;n(1,g[r].transposition=e,g),n(1,g[r].difference=g[r].transposition-g[r-1].transposition,g),n(1,g[r+1].difference=g[r+1].transposition-g[r].transposition,g)}return t.$$.update=()=>{if(4099&t.$$.dirty[0])if(E){if(E.transposition!=d.transposition){for(let t of g)t.transposition=d.transposition;n(1,g),n(12,E),n(0,d),n(8,T),n(7,p)}else E.beats!=d.beats?T():E.quantize==d.quantize&&E.sequentialQuantize==d.sequentialQuantize||(p(),T(),n(1,g),n(12,E),n(0,d),n(8,T),n(7,p));n(12,E={...d})}else n(12,E={...d})},[d,g,r,c,u,i,s,p,T,()=>{n(0,d.transposition=_t(a,11),d)},t=>{const e=t.detail.index;let n=t.detail.by;_(e,g[e].transposition+n)},t=>{_(t.detail.index,_t(t.detail.sheet,11))},E,function(t){S[t?"unshift":"push"]((()=>{r=t,n(2,r)}))},function(t){d=t,n(0,d)},function(e,r){t.$$.not_equal(s[r],e)&&(s[r]=e,n(6,s))},()=>{p(),T()}]}return new class extends W{constructor(t){super(),J(this,t,Lt,Ot,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
