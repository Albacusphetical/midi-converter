var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t){e.appendChild(t)}function s(e,t,n){e.insertBefore(t,n||null)}function l(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function u(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function f(){return d(" ")}function h(){return d("")}function p(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function m(e){return function(t){return t.preventDefault(),e.call(this,t)}}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function E(e){return""===e?null:+e}function y(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function T(e,t){e.value=null==t?"":t}function w(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function b(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}e.selectedIndex=-1}function v(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}let _,N;function k(){if(void 0===_){_=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(e){_=!0}}return _}class x{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,n=null){var r;this.e||(this.is_svg?this.e=(r=t.nodeName,document.createElementNS("http://www.w3.org/2000/svg",r)):this.e=u(t.nodeName),this.t=t,this.c(e)),this.i(n)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)s(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(l)}}function S(e){N=e}function A(){if(!N)throw new Error("Function called outside component initialization");return N}function I(){const e=A();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=function(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}function C(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const M=[],$=[],D=[],P=[],U=Promise.resolve();let V=!1;function R(e){D.push(e)}function O(e){P.push(e)}const F=new Set;let L=0;function B(){if(0!==L)return;const e=N;do{try{for(;L<M.length;){const e=M[L];L++,S(e),H(e.$$)}}catch(e){throw M.length=0,L=0,e}for(S(null),M.length=0,L=0;$.length;)$.pop()();for(let e=0;e<D.length;e+=1){const t=D[e];F.has(t)||(F.add(t),t())}D.length=0}while(M.length);for(;P.length;)P.pop()();V=!1,F.clear(),S(e)}function H(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(R)}}const q=new Set;let z;function G(){z={r:0,c:[],p:z}}function j(){z.r||r(z.c),z=z.p}function W(e,t){e&&e.i&&(q.delete(e),e.i(t))}function K(e,t,n,r){if(e&&e.o){if(q.has(e))return;q.add(e),z.c.push((()=>{q.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const Y="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Q(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function X(e){e&&e.c()}function J(e,n,i,a){const{fragment:s,after_update:l}=e.$$;s&&s.m(n,i),a||R((()=>{const n=e.$$.on_mount.map(t).filter(o);e.$$.on_destroy?e.$$.on_destroy.push(...n):r(n),e.$$.on_mount=[]})),l.forEach(R)}function Z(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ee(e,t){-1===e.$$.dirty[0]&&(M.push(e),V||(V=!0,U.then(B)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function te(t,o,i,a,s,c,u,d=[-1]){const f=N;S(t);const h=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(f?f.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:o.target||f.$$.root};u&&u(h.root);let p=!1;if(h.ctx=i?i(t,o.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return h.ctx&&s(h.ctx[e],h.ctx[e]=o)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](o),p&&ee(t,e)),n})):[],h.update(),p=!0,r(h.before_update),h.fragment=!!a&&a(h.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);h.fragment&&h.fragment.l(e),e.forEach(l)}else h.fragment&&h.fragment.c();o.intro&&W(t.$$.fragment),J(t,o.target,o.anchor,o.customElement),B()}S(f)}class ne{$destroy(){Z(this,1),this.$destroy=e}$on(t,n){if(!o(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var re=Object.defineProperty,oe=Object.defineProperties,ie=Object.getOwnPropertyDescriptors,ae=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,ce=Math.pow,ue=(e,t,n)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,de=(e,t)=>{for(var n in t||(t={}))se.call(t,n)&&ue(e,n,t[n]);if(ae)for(var n of ae(t))le.call(t,n)&&ue(e,n,t[n]);return e},fe=(e,t)=>oe(e,ie(t)),he=(e,t)=>{var n={};for(var r in e)se.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&ae)for(var r of ae(e))t.indexOf(r)<0&&le.call(e,r)&&(n[r]=e[r]);return n},pe=(e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{s(n.next(e))}catch(e){o(e)}},a=e=>{try{s(n.throw(e))}catch(e){o(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);s((n=n.apply(e,t)).next())}));const me="p".charCodeAt(0),ge="H".charCodeAt(0),Ee="Y".charCodeAt(0),ye="s".charCodeAt(0);let Te;function we(e){let t=-1;Te||(Te=function(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}());for(let n=0;n<e.length;n++)t=Te[255&(t^e[n])]^t>>>8;return-1^t}function be(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=me,r[1]=ge,r[2]=Ee,r[3]=ye,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=255&t,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const o=we(r),i=new Uint8Array(4);if(i[0]=o>>>24,i[1]=o>>>16,i[2]=o>>>8,i[3]=255&o,n){const t=function(e){for(let t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===me&&e[t-2]===ge&&e[t-1]===Ee&&e[t]===ye)return t-3;return 0}(e);return e.set(r,t),e.set(i,t+13),e}{const t=new Uint8Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=9;const n=new Uint8Array(54);return n.set(e,0),n.set(t,33),n.set(r,37),n.set(i,50),n}}const ve="[modern-screenshot]",_e="undefined"!=typeof window,Ne=_e&&"Worker"in window,ke=_e&&"atob"in window;var xe;const Se=_e?null==(xe=window.navigator)?void 0:xe.userAgent:"",Ae=Se.includes("Chrome"),Ie=Se.includes("AppleWebKit")&&!Ae,Ce=Se.includes("Firefox"),Me=e=>e&&"__CONTEXT__"in e,$e=e=>"CSSFontFaceRule"===e.constructor.name,De=e=>"CSSImportRule"===e.constructor.name,Pe=e=>1===e.nodeType,Ue=e=>"object"==typeof e.className,Ve=e=>"image"===e.tagName,Re=e=>"use"===e.tagName,Oe=e=>Pe(e)&&void 0!==e.style&&!Ue(e),Fe=e=>8===e.nodeType,Le=e=>3===e.nodeType,Be=e=>"IMG"===e.tagName,He=e=>"VIDEO"===e.tagName,qe=e=>"CANVAS"===e.tagName,ze=e=>"TEXTAREA"===e.tagName,Ge=e=>"INPUT"===e.tagName,je=e=>"STYLE"===e.tagName,We=e=>"SCRIPT"===e.tagName,Ke=e=>"SELECT"===e.tagName,Ye=e=>"SLOT"===e.tagName,Qe=e=>"IFRAME"===e.tagName,Xe=(...e)=>console.warn(ve,...e),Je=e=>console.time(`${ve} ${e}`),Ze=e=>console.timeEnd(`${ve} ${e}`),et=e=>{var t;const n=null==(t=null==e?void 0:e.createElement)?void 0:t.call(e,"canvas");return n&&(n.height=n.width=1),n&&"toDataURL"in n&&Boolean(n.toDataURL("image/webp").includes("image/webp"))},tt=e=>e.startsWith("data:");function nt(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(_e&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!_e)return e;const n=rt().implementation.createHTMLDocument(),r=n.createElement("base"),o=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(o),t&&(r.href=t),o.href=e,o.href}function rt(e){var t;return null!=(t=e&&Pe(e)?null==e?void 0:e.ownerDocument:e)?t:window.document}const ot="http://www.w3.org/2000/svg";function it(e,t="image/png",n=1){return pe(this,null,(function*(){try{return yield new Promise(((r,o)=>{e.toBlob((e=>{e?r(e):o(new Error("Blob is null"))}),t,n)}))}catch(r){if(ke)return Xe("Failed canvas to blob",{type:t,quality:n},r),function(e){var t,n;const[r,o]=e.split(","),i=null!=(n=null==(t=r.match(/data:(.+);/))?void 0:t[1])?n:void 0,a=window.atob(o),s=a.length,l=new Uint8Array(s);for(let e=0;e<s;e+=1)l[e]=a.charCodeAt(e);return new Blob([l],{type:i})}(e.toDataURL(t,n));throw r}}))}function at(e,t){return new Promise(((n,r)=>{const o=new FileReader;o.onload=()=>n(o.result),o.onerror=()=>r(o.error),o.onabort=()=>r(new Error(`Failed read blob to ${t}`)),"dataUrl"===t?o.readAsDataURL(e):"arrayBuffer"===t&&o.readAsArrayBuffer(e)}))}const st=e=>at(e,"dataUrl"),lt=e=>at(e,"arrayBuffer");function ct(e,t){const n=rt(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function ut(e,t){return new Promise((n=>{const{timeout:r,ownerDocument:o,onError:i}=null!=t?t:{},a="string"==typeof e?ct(e,rt(o)):e;let s=null,l=null;function c(){n(a),s&&clearTimeout(s),null==l||l()}if(r&&(s=setTimeout(c,r)),He(a)){const e=a.currentSrc||a.src;if(!e)return a.poster?ut(a.poster,t).then(n):c();if(a.readyState>=2)return c();const r=c,o=t=>{Xe("Failed video load",e,t),null==i||i(t),c()};l=()=>{a.removeEventListener("loadeddata",r),a.removeEventListener("error",o)},a.addEventListener("loadeddata",r,{once:!0}),a.addEventListener("error",o,{once:!0})}else{const e=Ve(a)?a.href.baseVal:a.currentSrc||a.src;if(!e)return c();const t=()=>pe(this,null,(function*(){if(Be(a)&&"decode"in a)try{yield a.decode()}catch(t){Xe("Failed to decode image, trying to render anyway",a.dataset.originalSrc||e,t)}c()})),n=t=>{Xe("Failed image load",a.dataset.originalSrc||e,t),c()};if(Be(a)&&a.complete)return t();l=()=>{a.removeEventListener("load",t),a.removeEventListener("error",n)},a.addEventListener("load",t,{once:!0}),a.addEventListener("error",n,{once:!0})}}))}const dt=function(){let e=0;return()=>(e+=1,`u${`0000${(Math.random()*ce(36,4)<<0).toString(36)}`.slice(-4)}${e}`)}();function ft(e){return null==e?void 0:e.split(",").map((e=>e.trim().replace(/"|'/g,"").toLowerCase())).filter(Boolean)}function ht(e){return{time:t=>e&&Je(t),timeEnd:t=>e&&Ze(t),warn:(...t)=>e&&Xe(...t)}}function pt(e){return{cache:e?"no-cache":"force-cache"}}function mt(e,t){return pe(this,null,(function*(){return Me(e)?e:function(e,t){return pe(this,null,(function*(){var n,r,o,i,a;const{scale:s=1,workerUrl:l,workerNumber:c=1}=t||{},u=Boolean(null==t?void 0:t.debug),d=null==(n=null==t?void 0:t.features)||n,f=null!=(r=e.ownerDocument)?r:_e?window.document:void 0,h=null!=(i=null==(o=e.ownerDocument)?void 0:o.defaultView)?i:_e?window:void 0,p=new Map,m=fe(de({width:0,height:0,quality:1,type:"image/png",scale:s,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:u,fetch:de({requestInit:pt(null==(a=null==t?void 0:t.fetch)?void 0:a.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},null==t?void 0:t.fetch),fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:c,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:ht(u),node:e,ownerDocument:f,ownerWindow:h,dpi:1===s?null:96*s,svgStyleElement:gt(f),svgDefsElement:null==f?void 0:f.createElementNS(ot,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...new Array(Ne&&l&&c?c:0)].map((()=>{try{const e=new Worker(l);return e.onmessage=e=>pe(this,null,(function*(){var t,n,r,o;const{url:i,result:a}=e.data;a?null==(n=null==(t=p.get(i))?void 0:t.resolve)||n.call(t,a):null==(o=null==(r=p.get(i))?void 0:r.reject)||o.call(r,new Error(`Error receiving message from worker: ${i}`))})),e.onmessageerror=e=>{var t,n;const{url:r}=e.data;null==(n=null==(t=p.get(r))?void 0:t.reject)||n.call(t,new Error(`Error receiving message from worker: ${r}`))},e}catch(e){return Xe("Failed to new Worker",e),null}})).filter(Boolean),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[et(f)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:p,drawImageCount:0,tasks:[],features:d,isEnable:e=>{var t;return"boolean"==typeof d?d:null==(t=d[e])||t}});m.log.time("wait until load"),yield function(e,t){return pe(this,null,(function*(){Oe(e)&&(Be(e)||He(e)?yield ut(e,{timeout:t}):yield Promise.all(["img","video"].flatMap((n=>Array.from(e.querySelectorAll(n)).map((e=>ut(e,{timeout:t})))))))}))}(e,m.timeout),m.log.timeEnd("wait until load");const{width:g,height:E}=function(e,t){let{width:n,height:r}=t;if(Pe(e)&&(!n||!r)){const t=e.getBoundingClientRect();n=n||t.width||Number(e.getAttribute("width"))||0,r=r||t.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}(e,m);return m.width=g,m.height=E,m}))}(e,fe(de({},t),{autoDestruct:!0}))}))}function gt(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode("\n.______background-clip--text {\n  background-clip: text;\n  -webkit-background-clip: text;\n}\n");return t.appendChild(n),t}function Et(e,t){return pe(this,null,(function*(){const{log:n,timeout:r,drawImageCount:o,drawImageInterval:i}=t;n.time("image to canvas");const a=yield ut(e,{timeout:r}),{canvas:s,context2d:l}=function(e,t){const{width:n,height:r,scale:o,backgroundColor:i,maximumCanvasSize:a}=t,s=e.createElement("canvas");s.width=Math.floor(n*o),s.height=Math.floor(r*o),s.style.width=`${n}px`,s.style.height=`${r}px`,a&&(s.width>a||s.height>a)&&(s.width>a&&s.height>a?s.width>s.height?(s.height*=a/s.width,s.width=a):(s.width*=a/s.height,s.height=a):s.width>a?(s.height*=a/s.width,s.width=a):(s.width*=a/s.height,s.height=a));const l=s.getContext("2d");return l&&i&&(l.fillStyle=i,l.fillRect(0,0,s.width,s.height)),{canvas:s,context2d:l}}(e.ownerDocument,t),c=()=>{try{null==l||l.drawImage(a,0,0,s.width,s.height)}catch(e){Xe("Failed to drawImage",e)}};if(c(),t.isEnable("fixSvgXmlDecode"))for(let e=0;e<o;e++)yield new Promise((t=>{setTimeout((()=>{c(),t()}),e+i)}));return t.drawImageCount=0,n.timeEnd("image to canvas"),s}))}const yt=["width","height","-webkit-text-fill-color"],Tt=["stroke","fill"];function wt(e,t,n){var r;const{defaultComputedStyles:o,ownerDocument:i}=n,a=e.nodeName.toLowerCase(),s=Ue(e)&&"svg"!==a,l=s?Tt.map((t=>[t,e.getAttribute(t)])).filter((([,e])=>null!==e)):[],c=[s&&"svg",a,l.map(((e,t)=>`${e}=${t}`)).join(","),t].filter(Boolean).join(":");if(o.has(c))return o.get(c);let u=n.sandbox;if(!u)try{i&&(u=i.createElement("iframe"),u.id=`__SANDBOX__-${dt()}`,u.width="0",u.height="0",u.style.visibility="hidden",u.style.position="fixed",i.body.appendChild(u),null==(r=u.contentWindow)||r.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),n.sandbox=u)}catch(e){Xe("Failed to create iframe sandbox",e)}if(!u)return new Map;const d=u.contentWindow;if(!d)return new Map;const f=d.document;let h,p;s?(h=f.createElementNS(ot,"svg"),p=h.ownerDocument.createElementNS(h.namespaceURI,a),l.forEach((([e,t])=>{p.setAttributeNS(null,e,t)})),h.appendChild(p)):h=p=f.createElement(a),p.textContent=" ",f.body.appendChild(h);const m=d.getComputedStyle(p,t),g=new Map;for(let e=m.length,t=0;t<e;t++){const e=m.item(t);yt.includes(e)||g.set(e,m.getPropertyValue(e))}return f.body.removeChild(h),o.set(c,g),g}function bt(e,t,n){var r;const o=new Map,i=[],a=new Map;if(n)for(const e of n)s(e);else for(let t=e.length,n=0;n<t;n++){s(e.item(n))}for(let e=i.length,t=0;t<e;t++)null==(r=a.get(i[t]))||r.forEach(((e,t)=>o.set(t,e)));function s(n){const r=e.getPropertyValue(n),s=e.getPropertyPriority(n),l=n.lastIndexOf("-"),c=l>-1?n.substring(0,l):void 0;if(c){let e=a.get(c);e||(e=new Map,a.set(c,e)),e.set(n,[r,s])}t.get(n)===r&&!s||(c?i.push(c):o.set(n,[r,s]))}return o}const vt=[":before",":after"],_t=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function Nt(e){if(e.ownerDocument)try{const t=e.toDataURL();if("data:,"!==t)return ct(t,e.ownerDocument)}catch(e){}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(e){Xe("Failed to clone canvas",e)}return t}function kt(e,t){return qe(e)?Nt(e):Qe(e)?function(e,t){var n;try{if(null!=(n=null==e?void 0:e.contentDocument)&&n.body)return Ct(e.contentDocument.body,t)}catch(e){Xe("Failed to clone iframe",e)}return e.cloneNode(!1)}(e,t):Be(e)?function(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager"),t}(e):He(e)?function(e){return pe(this,null,(function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return ct(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield ut(t,{onError:()=>r=!1}),!r)return e.poster?ct(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise((e=>{t.addEventListener("seeked",e,{once:!0})}));const o=n.createElement("canvas");o.width=e.offsetWidth,o.height=e.offsetHeight;try{const e=o.getContext("2d");e&&e.drawImage(t,0,0,o.width,o.height)}catch(n){return Xe("Failed to clone video",n),e.poster?ct(e.poster,e.ownerDocument):t}return Nt(o)}return t}))}(e):e.cloneNode(!1)}const xt=new Set(["symbol"]);function St(e,t,n){return pe(this,null,(function*(){Pe(t)&&(je(t)||We(t))||n.filter&&!n.filter(t)||(xt.has(e.nodeName)||xt.has(t.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle,e.appendChild(yield Ct(t,n)))}))}function At(e,t,n){return pe(this,null,(function*(){var r,o;for(let i=null!=(o=Pe(e)?null==(r=e.shadowRoot)?void 0:r.firstChild:void 0)?o:e.firstChild;i;i=i.nextSibling)if(!Fe(i))if(Pe(i)&&Ye(i)&&"function"==typeof i.assignedNodes){const e=i.assignedNodes();for(let r=0;r<e.length;r++)yield St(t,e[r],n)}else yield St(t,i,n)}))}const It=/^[\w-:]+$/;function Ct(e,t,n=!1){return pe(this,null,(function*(){var r,o,i,a;const{ownerDocument:s,ownerWindow:l,fontFamilies:c}=t;if(s&&Le(e))return s.createTextNode(e.data);if(s&&l&&Pe(e)&&(Oe(e)||Ue(e))){const s=yield kt(e,t);if(t.isEnable("removeAbnormalAttributes")){const e=s.getAttributeNames();for(let t=e.length,n=0;n<t;n++){const t=e[n];It.test(t)||s.removeAttribute(t)}}const l=t.currentNodeStyle=function(e,t,n,r){var o,i,a,s;const{ownerWindow:l,includeStyleProperties:c,currentParentNodeStyle:u}=r,d=t.style,f=l.getComputedStyle(e),h=wt(e,null,r);null==u||u.forEach(((e,t)=>{h.delete(t)}));const p=bt(f,h,c);return p.delete("transition-property"),p.delete("all"),p.delete("d"),p.delete("content"),n&&(p.delete("margin-top"),p.delete("margin-right"),p.delete("margin-bottom"),p.delete("margin-left"),p.delete("margin-block-start"),p.delete("margin-block-end"),p.delete("margin-inline-start"),p.delete("margin-inline-end"),p.set("box-sizing",["border-box",""])),"text"===(null==(o=p.get("background-clip"))?void 0:o[0])&&t.classList.add("______background-clip--text"),Ae&&(p.has("font-kerning")||p.set("font-kerning",["normal",""]),("hidden"===(null==(i=p.get("overflow-x"))?void 0:i[0])||"hidden"===(null==(a=p.get("overflow-y"))?void 0:a[0]))&&"ellipsis"===(null==(s=p.get("text-overflow"))?void 0:s[0])&&e.scrollWidth===e.clientWidth&&p.set("text-overflow",["clip",""])),p.forEach((([e,t],n)=>{d.setProperty(n,e,t)})),p}(e,s,n,t);n&&function(e,t){const{backgroundColor:n,width:r,height:o,style:i}=t,a=e.style;if(n&&a.setProperty("background-color",n,"important"),r&&a.setProperty("width",`${r}px`,"important"),o&&a.setProperty("height",`${o}px`,"important"),i)for(const e in i)a[e]=i[e]}(s,t);let u=!1;if(t.isEnable("copyScrollbar")){const t=[null==(r=l.get("overflow-x"))?void 0:r[0],null==(o=l.get("overflow-y"))?void 0:o[1]];u=t.includes("scroll")||(t.includes("auto")||t.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}return function(e,t,n,r){const{ownerWindow:o,svgStyleElement:i,svgStyles:a,currentNodeStyle:s}=r;function l(n){var i;const l=o.getComputedStyle(e,n);let c=l.getPropertyValue("content");if(!c||"none"===c)return;c=c.replace(/(')|(")|(counter\(.+\))/g,"");const u=[dt()],d=wt(e,n,r);null==s||s.forEach(((e,t)=>{d.delete(t)}));const f=bt(l,d,r.includeStyleProperties);f.delete("content"),f.delete("-webkit-locale"),"text"===(null==(i=f.get("background-clip"))?void 0:i[0])&&t.classList.add("______background-clip--text");const h=[`content: '${c}';`];if(f.forEach((([e,t],n)=>{h.push(`${n}: ${e}${t?" !important":""};`)})),1===h.length)return;try{t.className=[t.className,...u].join(" ")}catch(e){return}const p=h.join("\n  ");let m=a.get(p);m||(m=[],a.set(p,m)),m.push(`.${u[0]}:${n}`)}i&&o&&(vt.forEach(l),n&&_t.forEach(l))}(e,s,u,t),function(e,t){ze(e)&&(t.innerHTML=e.value),(ze(e)||Ge(e)||Ke(e))&&t.setAttribute("value",e.value)}(e,s),null==(a=ft(null==(i=l.get("font-family"))?void 0:i[0]))||a.forEach((e=>c.add(e))),He(e)||(yield At(e,s,t)),s}const u=e.cloneNode(!1);return yield At(e,u,t),u}))}function Mt(e,t){const{url:n,requestType:r="text",responseType:o="text",imageDom:i}=t;let a=n;const{timeout:s,acceptOfImage:l,requests:c,fetchFn:u,fetch:{requestInit:d,bypassingCache:f,placeholderImage:h},workers:p}=e;"image"===r&&(Ie||Ce)&&e.drawImageCount++;let m=c.get(n);if(!m){f&&f instanceof RegExp&&f.test(a)&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());const e=de({url:a,timeout:s,responseType:o,headers:"image"===r?{accept:l}:void 0},d);m={type:r,resolve:void 0,reject:void 0,response:null},m.response=(()=>pe(this,null,(function*(){if(u&&"image"===r){const e=yield u(n);if(e)return e}return!Ie&&n.startsWith("http")&&p.length?new Promise(((t,r)=>{p[c.size&p.length-1].postMessage(de({rawUrl:n},e)),m.resolve=t,m.reject=r})):function(e){const t=e,{url:n,timeout:r,responseType:o}=t,i=he(t,["url","timeout","responseType"]),a=new AbortController,s=r?setTimeout((()=>a.abort()),r):void 0;return fetch(n,de({signal:a.signal},i)).then((e=>{if(!e.ok)throw new Error("Failed fetch, not 2xx response",{cause:e});return"dataUrl"===o?e.blob().then(st):e.text()})).finally((()=>clearTimeout(s)))}(e)})))().catch((e=>{if(c.delete(n),"image"===r&&h)return Xe("Failed to fetch image base64, trying to use placeholder image",a),"string"==typeof h?h:h(i);throw e})),c.set(n,m)}return m.response}function $t(e,t,n,r){return pe(this,null,(function*(){if(!Dt(e))return e;for(const[o,i]of function(e,t){const n=[];return e.replace(Pt,((e,r,o)=>(n.push([o,nt(o,t)]),e))),n.filter((([e])=>!tt(e)))}(e,t))try{const t=yield Mt(n,{url:i,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace(Ut(o),`$1${t}$3`)}catch(e){Xe("Failed to fetch css data url",o,e)}return e}))}function Dt(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Pt=/url\((['"]?)([^'"]+?)\1\)/g;function Ut(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Vt(e,t){return pe(this,null,(function*(){const{ownerDocument:e,svgStyleElement:n,fontFamilies:r,fontCssTexts:o,tasks:i,font:a}=t;if(e&&n&&r.size)if(a&&a.cssText){const r=Bt(a.cssText,t);n.appendChild(e.createTextNode(`${r}\n`))}else{const a=Array.from(e.styleSheets).filter((e=>{try{return"cssRules"in e&&Boolean(e.cssRules.length)}catch(t){return Xe(`Error while reading CSS rules from ${e.href}`,t),!1}}));yield Promise.all(a.flatMap((e=>Array.from(e.cssRules).map(((n,r)=>pe(this,null,(function*(){if(De(n)){let o=r+1;const i=n.href;let a="";try{a=yield Mt(t,{url:i,requestType:"text",responseType:"text"})}catch(e){Xe(`Error fetch remote css import from ${i}`,e)}const s=a.replace(Pt,((e,t,n)=>e.replace(n,nt(n,i))));for(const t of function(e){if(null==e)return[];const t=[];let n=e.replace(Rt,"");for(;;){const e=Ot.exec(n);if(!e)break;t.push(e[0])}n=n.replace(Ot,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=r.exec(n);if(e)o.lastIndex=r.lastIndex;else{if(e=o.exec(n),!e)break;r.lastIndex=o.lastIndex}t.push(e[0])}return t}(s))try{e.insertRule(t,t.startsWith("@import")?o+=1:e.cssRules.length)}catch(e){Xe("Error inserting rule from remote css import",{rule:t,error:e})}}}))))))),a.flatMap((e=>Array.from(e.cssRules))).filter((e=>{var t;return $e(e)&&Dt(e.style.getPropertyValue("src"))&&(null==(t=ft(e.style.getPropertyValue("font-family")))?void 0:t.some((e=>r.has(e))))})).forEach((r=>{const a=r,s=o.get(a.cssText);s?n.appendChild(e.createTextNode(`${s}\n`)):i.push($t(a.cssText,a.parentStyleSheet?a.parentStyleSheet.href:null,t).then((r=>{r=Bt(r,t),o.set(a.cssText,r),n.appendChild(e.createTextNode(`${r}\n`))})))}))}}))}const Rt=/(\/\*[\s\S]*?\*\/)/gi,Ot=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;const Ft=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Lt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Bt(e,t){const{font:n}=t,r=n?null==n?void 0:n.preferredFormat:void 0;return r?e.replace(Lt,(e=>{for(;;){const[t,,n]=Ft.exec(e)||[];if(!n)return"";if(n===r)return`src: ${t};`}})):e}const Ht=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function qt(e,t){const{tasks:n}=t;Pe(e)&&((Be(e)||Ve(e))&&n.push(...function(e,t){if(Be(e)){const n=e.currentSrc||e.src;if(!tt(n))return[Mt(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then((t=>{t&&(e.srcset="",e.dataset.originalSrc=n,e.src=t||"")}))];(Ie||Ce)&&t.drawImageCount++}else if(Ue(e)&&!tt(e.href.baseVal)){const n=e.href.baseVal;return[Mt(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then((t=>{t&&(e.dataset.originalSrc=n,e.href.baseVal=t||"")}))]}return[]}(e,t)),Re(e)&&n.push(...function(e,t){var n;const{ownerDocument:r,svgDefsElement:o}=t,i=null!=(n=e.getAttribute("href"))?n:e.getAttribute("xlink:href");if(!i)return[];const[a,s]=i.split("#");if(s){const n=`#${s}`,i=null==r?void 0:r.querySelector(`svg ${n}`);if(a&&e.setAttribute("href",n),null!=o&&o.querySelector(n))return[];if(i)return[Ct(i,t).then((e=>{null!=o&&o.querySelector(n)||null==o||o.appendChild(e)}))];if(a)return[Mt(t,{url:a,responseType:"text"}).then((e=>{null==o||o.insertAdjacentHTML("beforeend",e)}))]}return[]}(e,t))),Oe(e)&&n.push(...function(e,t){return Ht.map((n=>{const r=e.getPropertyValue(n);return r&&"none"!==r?((Ie||Ce)&&t.drawImageCount++,$t(r,null,t,!0).then((t=>{!t||r===t||e.setProperty(n,t,e.getPropertyPriority(n))}))):null})).filter(Boolean)}(e.style,t)),e.childNodes.forEach((e=>{qt(e,t)}))}function zt(e,t){return pe(this,null,(function*(){const n=yield mt(e,t);if(Pe(n.node)&&Ue(n.node))return n.node;const{ownerDocument:r,log:o,tasks:i,svgStyleElement:a,svgDefsElement:s,svgStyles:l,font:c,progress:u,autoDestruct:d,onCloneNode:f,onEmbedNode:h,onCreateForeignObjectSvg:p}=n;o.time("clone node");const m=yield Ct(n.node,n,!0);if(a&&r){let e="";l.forEach(((t,n)=>{e+=`${t.join(",\n")} {\n  ${n}\n}\n`})),a.appendChild(r.createTextNode(e))}o.timeEnd("clone node"),null==f||f(m),!1!==c&&Pe(m)&&(o.time("embed web font"),yield Vt(0,n),o.timeEnd("embed web font")),o.time("embed node"),qt(m,n);const g=i.length;let E=0;null==u||u(E,g),yield Promise.all([...Array(4)].map((()=>pe(this,null,(function*(){for(;;){const e=i.pop();if(!e)break;try{yield e}catch(e){Xe("Failed to run task",e)}null==u||u(++E,g)}}))))),o.timeEnd("embed node"),null==h||h(m);const y=function(e,t){const{width:n,height:r}=t,o=function(e,t,n){const r=rt(n).createElementNS(ot,"svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}(n,r,e.ownerDocument),i=o.ownerDocument.createElementNS(o.namespaceURI,"foreignObject");return i.setAttributeNS(null,"x","0%"),i.setAttributeNS(null,"y","0%"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),i.append(e),o.appendChild(i),o}(m,n);return s&&y.insertBefore(s,y.children[0]),a&&y.insertBefore(a,y.children[0]),d&&function(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(e){}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}(n),null==p||p(y),y}))}function Gt(e,t){return pe(this,null,(function*(){var n;const r=yield mt(e,t),o=yield zt(r),i=function(e,t){let n=(new XMLSerializer).serializeToString(e);return t&&(n=n.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`}(o,r.isEnable("removeControlCharacter"));r.autoDestruct||(r.svgStyleElement=gt(r.ownerDocument),r.svgDefsElement=null==(n=r.ownerDocument)?void 0:n.createElementNS(ot,"defs"),r.svgStyles.clear());const a=ct(i,o.ownerDocument);return yield Et(a,r)}))}function jt(e){let t;if(e){if(!(e instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(this.datas=new DataView(e,0,jt.HEADER_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"h"!==String.fromCharCode(this.datas.getUint8(2))||"d"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileHeader : MThd prefix not found");if(6!==this.datas.getUint32(4))throw new Error("Invalid MIDIFileHeader : Chunk length must be 6")}else t=new Uint8Array(jt.HEADER_LENGTH),t[0]=77,t[1]=84,t[2]=104,t[3]=100,t[4]=0,t[5]=0,t[6]=0,t[7]=6,t[8]=0,t[9]=1,t[10]=0,t[11]=1,t[12]=0,t[13]=192,this.datas=new DataView(t.buffer,0,jt.HEADER_LENGTH)}jt.HEADER_LENGTH=14,jt.FRAMES_PER_SECONDS=1,jt.TICKS_PER_BEAT=2,jt.prototype.getFormat=function(){const e=this.datas.getUint16(8);if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI file : MIDI format ("+e+"), format can be 0, 1 or 2 only.");return e},jt.prototype.setFormat=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI format given ("+e+"), format can be 0, 1 or 2 only.");this.datas.setUint16(8,e)},jt.prototype.getTracksCount=function(){return this.datas.getUint16(10)},jt.prototype.setTracksCount=function(e){return this.datas.setUint16(10,e)},jt.prototype.getTickResolution=function(e){return 32768&this.datas.getUint16(12)?1e6/(this.getSMPTEFrames()*this.getTicksPerFrame()):(e=e||5e5)/this.getTicksPerBeat()},jt.prototype.getTimeDivision=function(){return 32768&this.datas.getUint16(12)?jt.FRAMES_PER_SECONDS:jt.TICKS_PER_BEAT},jt.prototype.getTicksPerBeat=function(){var e=this.datas.getUint16(12);if(32768&e)throw new Error("Time division is not expressed as ticks per beat.");return e},jt.prototype.setTicksPerBeat=function(e){this.datas.setUint16(12,32767&e)},jt.prototype.getSMPTEFrames=function(){const e=this.datas.getUint16(12);let t;if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");if(t=32512&e,-1===[24,25,29,30].indexOf(t))throw new Error("Invalid SMPTE frames value ("+t+").");return 29===t?29.97:t},jt.prototype.getTicksPerFrame=function(){const e=this.datas.getUint16(12);if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");return 255&e},jt.prototype.setSMTPEDivision=function(e,t){if(29.97===e&&(e=29),-1===[24,25,29,30].indexOf(e))throw new Error("Invalid SMPTE frames value given ("+e+").");if(0>t||255<t)throw new Error("Invalid ticks per frame value given ("+e+").");this.datas.setUint8(12,128|e),this.datas.setUint8(13,t)};var Wt=jt;function Kt(e,t){let n,r;if(e){if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer received.");if(12>e.byteLength-t)throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : Buffer length must size at least 12bytes");if(this.datas=new DataView(e,t,Kt.HDR_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"r"!==String.fromCharCode(this.datas.getUint8(2))||"k"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : MTrk prefix not found");if(r=this.getTrackLength(),e.byteLength-t<r)throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : The track size exceed the buffer length.");if(this.datas=new DataView(e,t,Kt.HDR_LENGTH+r),255!==this.datas.getUint8(Kt.HDR_LENGTH+(r-3))||47!==this.datas.getUint8(Kt.HDR_LENGTH+(r-2))||0!==this.datas.getUint8(Kt.HDR_LENGTH+(r-1)))throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : No track end event found at the expected index ("+(Kt.HDR_LENGTH+(r-1)).toString(16)+").")}else n=new Uint8Array(12),n[0]=77,n[1]=84,n[2]=114,n[3]=107,n[4]=0,n[5]=0,n[6]=0,n[7]=4,n[8]=0,n[9]=255,n[10]=47,n[11]=0,this.datas=new DataView(n.buffer,0,Kt.HDR_LENGTH+4)}Kt.HDR_LENGTH=8,Kt.prototype.getTrackLength=function(){return this.datas.getUint32(4)},Kt.prototype.setTrackLength=function(e){return this.datas.setUint32(4,e)},Kt.prototype.getTrackContent=function(){return new DataView(this.datas.buffer,this.datas.byteOffset+Kt.HDR_LENGTH,this.datas.byteLength-Kt.HDR_LENGTH)},Kt.prototype.setTrackContent=function(e){let t,n,r,o;const i=e.byteLength-e.byteOffset;if(4>i)throw new Error("Invalid track length, must size at least 4bytes");for(this.datas=new DataView(new Uint8Array(Kt.HDR_LENGTH+i).buffer),this.datas.setUint8(0,77),this.datas.setUint8(1,84),this.datas.setUint8(2,114),this.datas.setUint8(3,107),this.datas.setUint32(4,i),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=new Uint8Array(this.datas.buffer,Kt.HDR_LENGTH,i),r=0,o=t.length;r<o;r++)n[r]=t[r]};var Yt=Kt;function Qt(){throw new Error("MIDIEvents function not intended to be run.")}Qt.EVENT_META=255,Qt.EVENT_SYSEX=240,Qt.EVENT_DIVSYSEX=247,Qt.EVENT_MIDI=8,Qt.EVENT_META_SEQUENCE_NUMBER=0,Qt.EVENT_META_TEXT=1,Qt.EVENT_META_COPYRIGHT_NOTICE=2,Qt.EVENT_META_TRACK_NAME=3,Qt.EVENT_META_INSTRUMENT_NAME=4,Qt.EVENT_META_LYRICS=5,Qt.EVENT_META_MARKER=6,Qt.EVENT_META_CUE_POINT=7,Qt.EVENT_META_MIDI_CHANNEL_PREFIX=32,Qt.EVENT_META_END_OF_TRACK=47,Qt.EVENT_META_SET_TEMPO=81,Qt.EVENT_META_SMTPE_OFFSET=84,Qt.EVENT_META_TIME_SIGNATURE=88,Qt.EVENT_META_KEY_SIGNATURE=89,Qt.EVENT_META_SEQUENCER_SPECIFIC=127,Qt.EVENT_MIDI_NOTE_OFF=8,Qt.EVENT_MIDI_NOTE_ON=9,Qt.EVENT_MIDI_NOTE_AFTERTOUCH=10,Qt.EVENT_MIDI_CONTROLLER=11,Qt.EVENT_MIDI_PROGRAM_CHANGE=12,Qt.EVENT_MIDI_CHANNEL_AFTERTOUCH=13,Qt.EVENT_MIDI_PITCH_BEND=14,Qt.MIDI_1PARAM_EVENTS=[Qt.EVENT_MIDI_PROGRAM_CHANGE,Qt.EVENT_MIDI_CHANNEL_AFTERTOUCH],Qt.MIDI_2PARAMS_EVENTS=[Qt.EVENT_MIDI_NOTE_OFF,Qt.EVENT_MIDI_NOTE_ON,Qt.EVENT_MIDI_NOTE_AFTERTOUCH,Qt.EVENT_MIDI_CONTROLLER,Qt.EVENT_MIDI_PITCH_BEND],Qt.createParser=function(e,t,n){var r,o,i,a,s;if(e instanceof DataView&&(e={position:t||0,buffer:e,readUint8:function(){return this.buffer.getUint8(this.position++)},readUint16:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readUint32:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readVarInt:function(){for(var e,t=0,n=0;4>n++;){if(!(128&(e=this.readUint8())))return t+e;t+=127&e,t<<=7}throw new Error("0x"+this.position.toString(16)+": Variable integer length cannot exceed 4 bytes")},readBytes:function(e){for(var t=[];0<e;e--)t.push(this.readUint8());return t},pos:function(){return"0x"+(this.buffer.byteOffset+this.position).toString(16)},end:function(){return this.position===this.buffer.byteLength}},t=0),0<t)for(;t--;)e.readUint8();return{next:function(){if(e.end())return null;if(o={index:e.pos(),delta:e.readVarInt()},240==(240&(r=e.readUint8()))){if(r!==Qt.EVENT_META){if(r===Qt.EVENT_SYSEX||r===Qt.EVENT_DIVSYSEX)return o.type=r,o.length=e.readVarInt(),o.data=e.readBytes(o.length),o;if(n)throw new Error(e.pos()+" Unknown event type "+r.toString(16)+", Delta: "+o.delta+".");return o.type=r,o.badsubtype=e.readVarInt(),o.length=e.readUint8(),o.data=e.readBytes(o.length),o}switch(o.type=Qt.EVENT_META,o.subtype=e.readUint8(),o.length=e.readVarInt(),o.subtype){case Qt.EVENT_META_SEQUENCE_NUMBER:if(n&&2!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.msb=e.readUint8(),o.lsb=e.readUint8(),o;case Qt.EVENT_META_TEXT:case Qt.EVENT_META_COPYRIGHT_NOTICE:case Qt.EVENT_META_TRACK_NAME:case Qt.EVENT_META_INSTRUMENT_NAME:case Qt.EVENT_META_LYRICS:case Qt.EVENT_META_MARKER:case Qt.EVENT_META_CUE_POINT:return o.data=e.readBytes(o.length),o;case Qt.EVENT_META_MIDI_CHANNEL_PREFIX:if(n&&1!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.prefix=e.readUint8(),o;case Qt.EVENT_META_END_OF_TRACK:if(n&&0!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o;case Qt.EVENT_META_SET_TEMPO:if(n&&3!==o.length)throw new Error(e.pos()+" Tempo meta event length must be 3.");return o.tempo=(e.readUint8()<<16)+(e.readUint8()<<8)+e.readUint8(),o.tempoBPM=6e7/o.tempo,o;case Qt.EVENT_META_SMTPE_OFFSET:if(n&&5!==o.length)throw new Error(e.pos()+" Bad metaevent length.");if(o.hour=e.readUint8(),n&&23<o.hour)throw new Error(e.pos()+" SMTPE offset hour value must be part of 0-23.");if(o.minutes=e.readUint8(),n&&59<o.minutes)throw new Error(e.pos()+" SMTPE offset minutes value must be part of 0-59.");if(o.seconds=e.readUint8(),n&&59<o.seconds)throw new Error(e.pos()+" SMTPE offset seconds value must be part of 0-59.");if(o.frames=e.readUint8(),n&&30<o.frames)throw new Error(e.pos()+" SMTPE offset frames value must be part of 0-30.");if(o.subframes=e.readUint8(),n&&99<o.subframes)throw new Error(e.pos()+" SMTPE offset subframes value must be part of 0-99.");return o;case Qt.EVENT_META_KEY_SIGNATURE:if(n&&2!==o.length)throw new Error(e.pos()+" Bad metaevent length.");if(o.key=e.readUint8(),n&&(-7>o.key||7<o.key))throw new Error(e.pos()+" Bad metaevent length.");if(o.scale=e.readUint8(),n&&0!==o.scale&&1!==o.scale)throw new Error(e.pos()+" Key signature scale value must be 0 or 1.");return o;case Qt.EVENT_META_TIME_SIGNATURE:if(n&&4!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.data=e.readBytes(o.length),o.param1=o.data[0],o.param2=o.data[1],o.param3=o.data[2],o.param4=o.data[3],o;case Qt.EVENT_META_SEQUENCER_SPECIFIC:return o.data=e.readBytes(o.length),o;default:if(n)throw new Error(e.pos()+" Unknown meta event type ("+o.subtype.toString(16)+").");return o.data=e.readBytes(o.length),o}}else{if(0==(128&r)){if(!i)throw new Error(e.pos()+" Running status without previous event");s=r}else i=r>>4,a=15&r,s=e.readUint8();switch(o.type=Qt.EVENT_MIDI,o.subtype=i,o.channel=a,o.param1=s,i){case Qt.EVENT_MIDI_NOTE_OFF:return o.param2=e.readUint8(),o;case Qt.EVENT_MIDI_NOTE_ON:return o.param2=e.readUint8(),o.param2||(o.subtype=Qt.EVENT_MIDI_NOTE_OFF,o.param2=127),o;case Qt.EVENT_MIDI_NOTE_AFTERTOUCH:case Qt.EVENT_MIDI_CONTROLLER:return o.param2=e.readUint8(),o;case Qt.EVENT_MIDI_PROGRAM_CHANGE:case Qt.EVENT_MIDI_CHANNEL_AFTERTOUCH:return o;case Qt.EVENT_MIDI_PITCH_BEND:return o.param2=e.readUint8(),o;default:if(n)throw new Error(e.pos()+" Unknown MIDI event type ("+i.toString(16)+").");return o}}}}},Qt.writeToTrack=function(e,t,n){var r,o,i,a,s=0;for(r=0,o=e.length;r<o;r++){if(e[r].delta>>>28)throw Error("Event #"+r+": Maximum delta time value reached ("+e[r].delta+"/134217728 max)");if(e[r].delta>>>21&&(t[s++]=e[r].delta>>>21&127|128),e[r].delta>>>14&&(t[s++]=e[r].delta>>>14&127|128),e[r].delta>>>7&&(t[s++]=e[r].delta>>>7&127|128),t[s++]=127&e[r].delta,e[r].type===Qt.EVENT_MIDI)t[s++]=(e[r].subtype<<4)+e[r].channel,t[s++]=e[r].param1,-1!==Qt.MIDI_2PARAMS_EVENTS.indexOf(e[r].subtype)&&(t[s++]=e[r].param2);else{if(t[s++]=e[r].type,e[r].type===Qt.EVENT_META&&(t[s++]=e[r].subtype),e[r].length>>>28)throw Error("Event #"+r+": Maximum length reached ("+e[r].length+"/134217728 max)");if(e[r].length>>>21&&(t[s++]=e[r].length>>>21&127|128),e[r].length>>>14&&(t[s++]=e[r].length>>>14&127|128),e[r].length>>>7&&(t[s++]=e[r].length>>>7&127|128),t[s++]=127&e[r].length,e[r].type===Qt.EVENT_META)switch(e[r].subtype){case Qt.EVENT_META_SEQUENCE_NUMBER:t[s++]=e[r].msb,t[s++]=e[r].lsb;break;case Qt.EVENT_META_TEXT:case Qt.EVENT_META_COPYRIGHT_NOTICE:case Qt.EVENT_META_TRACK_NAME:case Qt.EVENT_META_INSTRUMENT_NAME:case Qt.EVENT_META_LYRICS:case Qt.EVENT_META_MARKER:case Qt.EVENT_META_CUE_POINT:for(i=0,a=e[r].length;i<a;i++)t[s++]=e[r].data[i];break;case Qt.EVENT_META_MIDI_CHANNEL_PREFIX:t[s++]=e[r].prefix;break;case Qt.EVENT_META_END_OF_TRACK:break;case Qt.EVENT_META_SET_TEMPO:t[s++]=e[r].tempo>>16,t[s++]=e[r].tempo>>8&255,t[s++]=255&e[r].tempo;break;case Qt.EVENT_META_SMTPE_OFFSET:if(n&&23<e[r].hour)throw new Error("Event #"+r+": SMTPE offset hour value must be part of 0-23.");if(t[s++]=e[r].hour,n&&59<e[r].minutes)throw new Error("Event #"+r+": SMTPE offset minutes value must be part of 0-59.");if(t[s++]=e[r].minutes,n&&59<e[r].seconds)throw new Error("Event #"+r+": SMTPE offset seconds value must be part of 0-59.");if(t[s++]=e[r].seconds,n&&30<e[r].frames)throw new Error("Event #"+r+": SMTPE offset frames amount must be part of 0-30.");if(t[s++]=e[r].frames,n&&99<e[r].subframes)throw new Error("Event #"+r+": SMTPE offset subframes amount must be part of 0-99.");t[s++]=e[r].subframes;break;case Qt.EVENT_META_KEY_SIGNATURE:if("number"!=typeof e[r].key||-7>e[r].key||7<e[r].scale)throw new Error("Event #"+r+":The key signature key must be between -7 and 7");if("number"!=typeof e[r].scale||0>e[r].scale||1<e[r].scale)throw new Error("Event #"+r+":The key signature scale must be 0 or 1");t[s++]=e[r].key,t[s++]=e[r].scale;break;case Qt.EVENT_META_TIME_SIGNATURE:case Qt.EVENT_META_SEQUENCER_SPECIFIC:default:for(i=0,a=e[r].length;i<a;i++)t[s++]=e[r].data[i]}else for(i=0,a=e[r].length;i<a;i++)t[s++]=e[r].data[i]}}},Qt.getRequiredBufferLength=function(e){var t,n=0,r=0;for(r=0,t=e.length;r<t;r++)n+=e[r].delta>>>21?4:e[r].delta>>>14?3:e[r].delta>>>7?2:1,e[r].type===Qt.EVENT_MIDI?(n++,n++,-1!==Qt.MIDI_2PARAMS_EVENTS.indexOf(e[r].subtype)&&n++):(n++,e[r].type===Qt.EVENT_META&&n++,n+=e[r].length>>>21?4:e[r].length>>>14?3:e[r].length>>>7?2:1,n+=e[r].length);return n};var Xt=Qt,Jt={isNotUTF8:function(e,t,n){try{tn(e,t,n,!0)}catch(e){return!0}return!1},getCharLength:Zt,getCharCode:en,getStringFromBytes:tn,getBytesForCharCode:nn,setBytesFromCharCode:rn,setBytesFromString:function(e,t,n,r,o){e=e||"",t=t||[],n|=0,r="number"==typeof r?r:t.byteLength||1/0;for(var i=0,a=e.length;i<a;i++){var s=nn(e[i].codePointAt(0));if(o&&n+s>r)throw new Error('Not enought bytes to encode the char "'+e[i]+'" at the offset "'+n+'".');rn(e[i].codePointAt(0),t,n,s),n+=s}return t}};function Zt(e){return 240==(240&e)?4:224==(224&e)?3:192==(192&e)?2:e==(127&e)?1:0}function en(e,t,n){var r=0,o="";if(t=t||0,e.length-t<=0)throw new Error("No more characters remaining in array.");if(0==(n=n||Zt(e[t])))throw new Error(e[t].toString(2)+" is not a significative byte (offset:"+t+").");if(1===n)return e[t];if(e.length-t<n)throw new Error("Expected at least "+n+" bytes remaining in array.");if(o="00000000".slice(0,n)+1+"00000000".slice(n+1),e[t]&parseInt(o,2))throw Error("Index "+t+": A "+n+" bytes encoded char cannot encode the "+(n+1)+"th rank bit to 1.");for(o="0000".slice(0,n+1)+"11111111".slice(n+1),r+=(e[t]&parseInt(o,2))<<6*--n;n;){if(128!=(128&e[t+1])||64==(64&e[t+1]))throw Error("Index "+(t+1)+': Next bytes of encoded char must begin with a "10" bit sequence.');r+=(63&e[++t])<<6*--n}return r}function tn(e,t,n,r){var o,i=[];for(t|=0,n="number"==typeof n?n:e.byteLength||e.length;t<n;t++){if(t+(o=Zt(e[t]))>n){if(r)throw Error("Index "+t+": Found a "+o+" bytes encoded char declaration but only "+(n-t)+" bytes are available.")}else i.push(String.fromCodePoint(en(e,t,o)));t+=o-1}return i.join("")}function nn(e){if(e<128)return 1;if(e<2048)return 2;if(e<65536)return 3;if(e<2097152)return 4;throw new Error("CharCode "+e+" cannot be encoded with UTF8.")}function rn(e,t,n,r){if(e|=0,t=t||[],n|=0,1==(r=r||nn(e)))t[n]=e;else for(t[n++]=(parseInt("1111".slice(0,r),2)<<8-r)+(e>>>6*--r);r>0;)t[n++]=e>>>6*--r&63|128;return t}function on(e,t){var n,r,o,i;if(e){if(25>(e=function(e){if(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array)return new Uint8Array(e).buffer}throw new Error("Unsupported buffer type, need ArrayBuffer or Uint8Array")}(e)).byteLength)throw new Error("A buffer of a valid MIDI file must have, at least, a size of 25bytes.");for(this.header=new Wt(e),this.tracks=[],r=Wt.HEADER_LENGTH,o=0,i=this.header.getTracksCount();o<i;o++){if(t&&r>=e.byteLength-1)throw new Error("Couldn't find datas corresponding to the track #"+o+".");n=new Yt(e,r),this.tracks.push(n),r+=n.getTrackLength()+8}if(t&&r!==e.byteLength)throw new Error("It seems that the buffer contains too much datas.")}else this.header=new Wt,this.tracks=[new Yt]}on.prototype.getEvents=function(e,t){var n,r,o,i,a,s,l=0,c=[],u=this.header.getFormat(),d=this.header.getTickResolution();if(1!==u||1===this.tracks.length)for(o=0,i=this.tracks.length;o<i;o++)for(l=2===u&&l?l:0,r=(n=Xt.createParser(this.tracks[o].getTrackContent(),0,!1)).next();r;)l+=r.delta?r.delta*d/1e3:0,r.type===Xt.EVENT_META&&r.subtype===Xt.EVENT_META_SET_TEMPO&&(d=this.header.getTickResolution(r.tempo)),e&&r.type!==e||t&&(!r.subtype||r.subtype!==t)||(r.playTime=l,c.push(r)),r=n.next();else{for(a=[],s=-1,o=0,i=this.tracks.length;o<i;o++)a[o]={},a[o].parser=Xt.createParser(this.tracks[o].getTrackContent(),0,!1),a[o].curEvent=a[o].parser.next();do{for(s=-1,o=0,i=a.length;o<i;o++)a[o].curEvent&&(-1===s||a[o].curEvent.delta<a[s].curEvent.delta)&&(s=o);if(-1!==s){for(o=0,i=a.length;o<i;o++)o!==s&&a[o].curEvent&&(a[o].curEvent.delta-=a[s].curEvent.delta);l+=(r=a[s].curEvent).delta?r.delta*d/1e3:0,r.type===Xt.EVENT_META&&r.subtype===Xt.EVENT_META_SET_TEMPO&&(d=this.header.getTickResolution(r.tempo)),e&&r.type!==e||t&&(!r.subtype||r.subtype!==t)||(r.playTime=l,r.track=s,c.push(r)),a[s].curEvent=a[s].parser.next()}}while(-1!==s)}return c},on.prototype.getMidiEvents=function(){return this.getEvents(Xt.EVENT_MIDI)},on.prototype.getLyrics=function(){var e,t,n,r=this.getEvents(Xt.EVENT_META),o=[],i=[];for(t=0,n=r.length;t<n;t++)(e=r[t]).subtype===Xt.EVENT_META_LYRICS?i.push(e):e.subtype===Xt.EVENT_META_TEXT&&("@"===String.fromCharCode(e.data[0])?"T"===String.fromCharCode(e.data[1])||"I"===String.fromCharCode(e.data[1])||String.fromCharCode(e.data[1]):0===String.fromCharCode.apply(String,e.data).indexOf("words")?o.length=0:0!==e.playTime&&o.push(e));2<i.length?o=i:o.length||(o=[]);try{o.forEach((function(e){e.text=Jt.getStringFromBytes(e.data,0,e.length,!0)}))}catch(e){o.forEach((function(e){e.text=e.data.map((function(e){return String.fromCharCode(e)})).join("")}))}return o},on.prototype.getTrackEvents=function(e){var t,n,r=[];if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");t=(n=Xt.createParser(this.tracks[e].getTrackContent(),0,!1)).next();do{r.push(t),t=n.next()}while(t);return r},on.prototype.setTrackEvents=function(e,t){var n,r;if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");if(!t||!t.length)throw Error("A track must contain at least one event, none given.");n=Xt.getRequiredBufferLength(t),r=new Uint8Array(n),Xt.writeToTrack(t,r),this.tracks[e].setTrackContent(r)},on.prototype.deleteTrack=function(e){if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");this.tracks.splice(e,1),this.header.setTracksCount(this.tracks.length)},on.prototype.addTrack=function(e){var t;if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");t=new Yt,e===this.tracks.length?this.tracks.push(t):this.tracks.splice(e,0,t),this.header.setTracksCount(this.tracks.length)},on.prototype.getContent=function(){var e,t,n,r,o,i,a,s,l;for(e=Wt.HEADER_LENGTH,r=0,o=this.tracks.length;r<o;r++)e+=this.tracks[r].getTrackLength()+8;for(t=new Uint8Array(e),n=new Uint8Array(this.header.datas.buffer,this.header.datas.byteOffset,Wt.HEADER_LENGTH),r=0,o=Wt.HEADER_LENGTH;r<o;r++)t[r]=n[r];for(i=0,a=this.tracks.length;i<a;i++)for(n=new Uint8Array(this.tracks[i].datas.buffer,this.tracks[i].datas.byteOffset,this.tracks[i].datas.byteLength),s=0,l=this.tracks[i].datas.byteLength;s<l;s++)t[r++]=n[s];return t.buffer},on.Header=Wt,on.Track=Yt;var an=on;const sn="!@#$%^&*()QWERTYUIOPASDFGHJKLZXCBVNM";class ln{constructor(e,t,n,r,o,i="keep",a="keep"){this.value=e,this.playTime=t,this.delta=o,this.char=dn[e-21],this.tempo=n,this.BPM=r,this.valid=e>=21&&e<=108,this.outOfRange=e<=35||e>=97,sn.includes(this.char)?"Start"===i?this.displayValue=e-108:"End"==i&&(this.displayValue=e+108):this.outOfRange?"Start"===a?this.displayValue=e-1024:"End"==a&&(this.displayValue=e+1024):this.displayValue=e}}class cn{constructor(e,t=!0,n=!0){let r=!1,o=e[0];for(let t of e){if(t.playTime!=o.playTime){r=!0;break}o=t}if(this.is_quantized=r,r)r&&(this.notes=n?e:this.#e(e,t));else{let n=[],r=[];e.forEach((e=>{n.includes(e.value)||(n.push(e.value),r.push(e))})),this.notes=this.#e(r,t)}}#e(e,t){return t?this.#t(e):e.sort(((e,t)=>e.displayValue-t.displayValue))}#t(e){let t,n=[],r=[],o=[],i=[],a=[],s=[];e=e.sort(((e,t)=>e.value-t.value));for(const n of e)n.outOfRange?n.value-1024===n.displayValue?a.push(n):n.value+1024===n.displayValue&&s.push(n):(isNaN(n.char)?sn.includes(n.char)?o.push(n):i.push(n):r.push(n),t=n);return t&&(n=sn.includes(t.char)?[...r,...i,...o]:[...o,...r,...i]),[...a,...n,...s]}}class un{constructor(e){this.chords=e,this.missingTempo=!1}transpose(e,t="Start",n="Start",r=!0,o=!0){if(!this.chords)return;let i=[];return this.chords.forEach((a=>{let s=[];a.notes.forEach((r=>{s.push(new ln(r.value+e,r.playTime,r.tempo,r.BPM,r.delta,t,n))})),i.push(new cn(s,r,o))})),new un(i)}countNotes(){let e=0;for(let t of this.chords)for(let n of t.notes)e++;return e}text(){let e="",t=this.chords;for(let n=0;n<t.length;n++){if(!t){e+="[no-chords] ";continue}const r=t[n];let o=r.notes.length>1&&r.notes.find((e=>!0===e.valid));r.notes.filter((e=>!1===e.outOfRange)).length<=1&&(o=!1),o&&(e+="[");for(const t of r.notes)e+=t.char;o&&(e+="]"),e+=" "}return e}}const dn="1234567890qwert1!2@34$5%6^78*9(0qQwWeErtTyYuiIoOpPasSdDfgGhHjJklLzZxcCvVbBnmyuiopasdfghj",fn="1234567890qwertyuiopasdfghjklzxcvbnm";function hn(e,t,n=0,r=!1,o=4,i=0){if(!e?.chords)return n;function a(e){let t=[];for(let n of e.chords)for(let e of n.notes)t.push({char:e.char,oor:e.outOfRange,valid:e.valid});let n=t.filter((e=>!1===e.oor&&!0===e.valid)),r=n.filter((e=>fn.includes(e.char))),o=n.filter((e=>!fn.includes(e.char)));return Math.abs(o.length-r.length)}let s=a(e.transpose(n)),l=n;function c(t){let n=a(e.transpose(t));if(n>s){if(!r){if(n-s<=o)return}s=n,l=t}}for(let e=0;e<=t;e++)c(n-e),c(n+e);return l}function pn(e,t){return t<e/4?"-":t<e/2?" ":t<e?" - ":t<2*e?", ":t<3*e?"... ":t<4*e?".... ":"...... "}function mn(e,t,n){const r=e.slice();return r[22]=t[n],r}function gn(e){let t,n,o,i,h,m,v,_,N,k,x,S,A,I,C,M,$,D,P,U,V,O,F,L,B,H,q,z,G,j,W,K,Y,Q,X,J,Z,ee,te,ne,re,oe,ie,ae,se,le,ce,ue,de,fe,he,pe,me,ge,Ee,ye,Te,we,be,ve,_e,Ne,ke,xe,Se,Ae,Ie,Ce,Me,$e,De,Pe,Ue,Ve,Re,Oe,Fe,Le,Be,He,qe,ze,Ge,je=e[0].lbauto_atleast+"",We=1==e[0].beats?"1 beat":`${e[0].beats} beats`,Ke=e[0].quantize+"",Ye=e[3],Qe=[];for(let t=0;t<Ye.length;t+=1)Qe[t]=En(mn(e,Ye,t));let Xe=1==e[0].missingTempo&&yn(e),Je=e[0].oors&&e[0].tempoMarks&&Tn(e);function Ze(e,t){return e[0].capturingImage?bn:wn}let et=Ze(e),tt=et(e),nt="undefined"!=typeof ClipboardItem&&function(e){let t,n,r,o;function i(e,t){return e[0].capturingImage?_n:vn}let a=i(e),c=a(e);return{c(){t=u("button"),c.c(),t.disabled=n=e[0].capturingImage},m(n,i){s(n,t,i),c.m(t,null),r||(o=p(t,"click",e[21]),r=!0)},p(e,r){a!==(a=i(e))&&(c.d(1),c=a(e),c&&(c.c(),c.m(t,null))),1&r&&n!==(n=e[0].capturingImage)&&(t.disabled=n)},d(e){e&&l(t),c.d(),r=!1,o()}}}(e);return{c(){t=u("div"),n=u("label"),n.textContent="Transpose (sheet) by:",o=f(),i=u("input"),h=f(),m=u("button"),m.textContent="Auto-transpose",v=f(),_=u("div"),N=u("button"),N.textContent="Line-based auto-transpose",k=f(),x=u("label"),x.textContent="Resilience (?):",S=f(),A=u("input"),I=f(),C=u("span"),M=d(je),$=f(),D=u("div"),P=u("div"),U=u("label"),U.textContent="Place shifted notes at:",V=f(),O=u("select"),F=u("option"),F.textContent="Start",L=u("option"),L.textContent="End",H=f(),q=u("div"),z=u("label"),z.textContent="Place out of range notes at:",G=f(),j=u("select"),W=u("option"),W.textContent="Start",K=u("option"),K.textContent="End",Y=f(),Q=u("div"),X=u("label"),X.textContent="Font:",J=f(),Z=u("select");for(let e=0;e<Qe.length;e+=1)Qe[e].c();ee=f(),te=u("div"),ne=u("label"),ne.textContent="Break lines:",re=f(),oe=u("input"),ie=f(),ae=u("span"),se=d("Every "),le=d(We),ce=f(),Xe&&Xe.c(),ue=f(),de=u("div"),fe=u("label"),fe.textContent="Quantize:",he=f(),pe=u("input"),me=f(),ge=u("span"),Ee=d(Ke),ye=d(" miliseconds"),Te=f(),we=u("label"),be=u("input"),ve=d("\n        Classic chord order"),_e=f(),Ne=u("label"),ke=u("input"),xe=d("\n        Sequential quantizes"),Se=f(),Ae=u("label"),Ie=u("input"),Ce=d("\n        Include out of range (ctrl) notes"),Me=f(),$e=u("label"),De=u("input"),Pe=d("\n        Show tempo marks"),Ue=f(),Je&&Je.c(),Ve=f(),Re=u("button"),Re.textContent="Copy Text",Oe=f(),Fe=u("button"),tt.c(),Be=f(),nt&&nt.c(),He=f(),qe=u("style"),qe.textContent='label {\n        max-width: fit-content;\n        text-align: center;\n    }\n\n    .select-div {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        text-align: center;\n    }\n\n    select {\n        height: auto;\n        margin-left: 0.4em;\n        margin-top: 0.2em;\n        margin-bottom: 0;\n    }\n\n    input[type="checkbox"] {\n        display: inline-block;\n        vertical-align: middle;\n    }\n\n    input[type="range"] {\n        margin-left: 0.4em;\n        margin-right: 0.4em;\n        margin-bottom: 0;\n    }\n\n    input[type="file"] {\n        margin-bottom: 0;\n    }\n\n    input[type="text"] {\n        margin-bottom: 0;\n    }\n    \n    .beats, .quantize, .select-label, .tempo {\n        display: flex;\n        flex-direction: row;\n    }',g(n,"for","transpose"),g(i,"id","transpose"),g(i,"type","number"),g(i,"min","-24"),g(i,"max","24"),w(t,"display","inline-block"),w(N,"margin-bottom","0"),w(x,"margin-left","0.5em"),w(x,"display","flex"),w(x,"align-items","center"),g(x,"title","Controls how much better a transposition should be than the previous transposition for line-based auto-transpose to act (higher = less transposing)"),g(x,"for","atleast"),g(x,"class","slider-label"),g(A,"id","atleast"),g(A,"type","range"),g(A,"min","1"),g(A,"max","24"),w(C,"display","flex"),w(C,"align-items","center"),g(_,"class","quantize"),g(U,"for","shifts-position"),F.__value="Start",F.value=F.__value,L.__value="End",L.value=L.__value,O.disabled=B=e[0].classicChordOrder,g(O,"name","shifts-position"),g(O,"id","shifts-position"),void 0===e[0].pShifts&&R((()=>e[8].call(O))),g(P,"class","select-div"),g(z,"for","oors-position"),W.__value="Start",W.value=W.__value,K.__value="End",K.value=K.__value,g(j,"name","oors-position"),g(j,"id","oors-position"),void 0===e[0].pOors&&R((()=>e[9].call(j))),g(q,"class","select-div"),g(X,"for","font"),g(Z,"name","font"),g(Z,"id","font"),void 0===e[0].font&&R((()=>e[10].call(Z))),g(Q,"class","select-div"),g(ne,"class","slider-label"),g(ne,"for","beats-for-newline"),g(oe,"type","range"),g(oe,"id","beats-for-newline"),g(oe,"min","1"),g(oe,"max","32"),g(te,"class","beats"),g(fe,"class","slider-label"),g(fe,"for","quantize-prompt"),g(pe,"type","range"),g(pe,"id","quantize-prompt"),g(pe,"min","1"),g(pe,"max","100"),g(de,"class","quantize"),g(be,"type","checkbox"),g(be,"id","classic-chord-order"),g(we,"for","classic-chord-order"),g(ke,"type","checkbox"),g(ke,"id","order-quantizes"),g(Ne,"for","order-quantizes"),g(Ie,"type","checkbox"),g(Ie,"id","out-of-range"),g(Ae,"for","out-of-range"),g(De,"type","checkbox"),g(De,"id","tempo-checkbox"),g($e,"for","tempo-checkbox"),Fe.disabled=Le=e[0].capturingImage},m(r,l){s(r,t,l),a(t,n),a(t,o),a(t,i),T(i,e[0].transposition),a(t,h),a(t,m),s(r,v,l),s(r,_,l),a(_,N),a(_,k),a(_,x),a(_,S),a(_,A),T(A,e[0].lbauto_atleast),a(_,I),a(_,C),a(C,M),s(r,$,l),s(r,D,l),a(D,P),a(P,U),a(P,V),a(P,O),a(O,F),a(O,L),b(O,e[0].pShifts),a(D,H),a(D,q),a(q,z),a(q,G),a(q,j),a(j,W),a(j,K),b(j,e[0].pOors),a(D,Y),a(D,Q),a(Q,X),a(Q,J),a(Q,Z);for(let e=0;e<Qe.length;e+=1)Qe[e].m(Z,null);b(Z,e[0].font),a(D,ee),a(D,te),a(te,ne),a(te,re),a(te,oe),T(oe,e[0].beats),a(te,ie),a(te,ae),a(ae,se),a(ae,le),a(D,ce),Xe&&Xe.m(D,null),a(D,ue),a(D,de),a(de,fe),a(de,he),a(de,pe),T(pe,e[0].quantize),a(de,me),a(de,ge),a(ge,Ee),a(ge,ye),a(D,Te),a(D,we),a(we,be),be.checked=e[0].classicChordOrder,a(we,ve),a(D,_e),a(D,Ne),a(Ne,ke),ke.checked=e[0].sequentialQuantize,a(Ne,xe),a(D,Se),a(D,Ae),a(Ae,Ie),Ie.checked=e[0].oors,a(Ae,Ce),a(D,Me),a(D,$e),a($e,De),De.checked=e[0].tempoMarks,a($e,Pe),a(D,Ue),Je&&Je.m(D,null),a(D,Ve),a(D,Re),a(D,Oe),a(D,Fe),tt.m(Fe,null),a(D,Be),nt&&nt.m(D,null),s(r,He,l),s(r,qe,l),ze||(Ge=[p(i,"input",e[4]),p(m,"click",e[5]),p(N,"click",e[6]),p(A,"change",e[7]),p(A,"input",e[7]),p(O,"change",e[8]),p(j,"change",e[9]),p(Z,"change",e[10]),p(oe,"change",e[11]),p(oe,"input",e[11]),p(pe,"change",e[13]),p(pe,"input",e[13]),p(be,"change",e[14]),p(ke,"change",e[15]),p(Ie,"change",e[16]),p(De,"change",e[17]),p(Re,"click",e[19]),p(Fe,"click",e[20])],ze=!0)},p(e,t){if(1&t&&E(i.value)!==e[0].transposition&&T(i,e[0].transposition),1&t&&T(A,e[0].lbauto_atleast),1&t&&je!==(je=e[0].lbauto_atleast+"")&&y(M,je),1&t&&B!==(B=e[0].classicChordOrder)&&(O.disabled=B),1&t&&b(O,e[0].pShifts),1&t&&b(j,e[0].pOors),8&t){let n;for(Ye=e[3],n=0;n<Ye.length;n+=1){const r=mn(e,Ye,n);Qe[n]?Qe[n].p(r,t):(Qe[n]=En(r),Qe[n].c(),Qe[n].m(Z,null))}for(;n<Qe.length;n+=1)Qe[n].d(1);Qe.length=Ye.length}1&t&&b(Z,e[0].font),1&t&&T(oe,e[0].beats),1&t&&We!==(We=1==e[0].beats?"1 beat":`${e[0].beats} beats`)&&y(le,We),1==e[0].missingTempo?Xe?Xe.p(e,t):(Xe=yn(e),Xe.c(),Xe.m(D,ue)):Xe&&(Xe.d(1),Xe=null),1&t&&T(pe,e[0].quantize),1&t&&Ke!==(Ke=e[0].quantize+"")&&y(Ee,Ke),1&t&&(be.checked=e[0].classicChordOrder),1&t&&(ke.checked=e[0].sequentialQuantize),1&t&&(Ie.checked=e[0].oors),1&t&&(De.checked=e[0].tempoMarks),e[0].oors&&e[0].tempoMarks?Je?Je.p(e,t):(Je=Tn(e),Je.c(),Je.m(D,Ve)):Je&&(Je.d(1),Je=null),et!==(et=Ze(e))&&(tt.d(1),tt=et(e),tt&&(tt.c(),tt.m(Fe,null))),1&t&&Le!==(Le=e[0].capturingImage)&&(Fe.disabled=Le),"undefined"!=typeof ClipboardItem&&nt.p(e,t)},d(e){e&&l(t),e&&l(v),e&&l(_),e&&l($),e&&l(D),c(Qe,e),Xe&&Xe.d(),Je&&Je.d(),tt.d(),nt&&nt.d(),e&&l(He),e&&l(qe),ze=!1,r(Ge)}}}function En(t){let n,r,o=t[22]+"";return{c(){n=u("option"),r=d(o),n.__value=t[22],n.value=n.__value},m(e,t){s(e,n,t),a(n,r)},p:e,d(e){e&&l(n)}}}function yn(e){let t,n,o,i,c,h,m,E,w,b=e[0].bpm+"";return{c(){t=u("div"),n=u("label"),n.textContent="BPM (?):",o=f(),i=u("input"),c=f(),h=u("span"),m=d(b),g(n,"class","slider-label"),g(n,"for","tempo"),g(n,"title","You're able to change this because your MIDI file doesn't have tempo/BPM."),g(i,"type","range"),g(i,"id","tempo"),g(i,"min","1"),g(i,"max","300"),g(t,"class","tempo")},m(r,l){s(r,t,l),a(t,n),a(t,o),a(t,i),T(i,e[0].bpm),a(t,c),a(t,h),a(h,m),E||(w=[p(i,"change",e[12]),p(i,"input",e[12])],E=!0)},p(e,t){1&t&&T(i,e[0].bpm),1&t&&b!==(b=e[0].bpm+"")&&y(m,b)},d(e){e&&l(t),E=!1,r(w)}}}function Tn(e){let t,n,r,o,i,c;return{c(){t=u("div"),n=u("label"),n.textContent="Out-of-range prefix:",r=f(),o=u("input"),g(n,"for","oor-prefix"),g(o,"type","text"),g(o,"id","oor-prefix")},m(l,u){s(l,t,u),a(t,n),a(t,r),a(t,o),T(o,e[0].oorPrefix),i||(c=p(o,"input",e[18]),i=!0)},p(e,t){1&t&&o.value!==e[0].oorPrefix&&T(o,e[0].oorPrefix)},d(e){e&&l(t),i=!1,c()}}}function wn(e){let t;return{c(){t=d("Download Image")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function bn(e){let t;return{c(){t=d("Please Wait...")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function vn(e){let t;return{c(){t=d("Copy Image")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function _n(e){let t;return{c(){t=d("Please Wait...")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function Nn(t){let n,r=t[1]&&gn(t);return{c(){r&&r.c(),n=h()},m(e,t){r&&r.m(e,t),s(e,n,t)},p(e,[t]){e[1]?r?r.p(e,t):(r=gn(e),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:e,o:e,d(e){r&&r.d(e),e&&l(n)}}}function kn(e,t,n){let r=I(),{show:o}=t,i=["Verdana","Tahoma","Dejavu Sans","Segoe UI","Gill Sans","Helvetica","Lucida Sans","Century Gothic"],{settings:a={beats:4,quantize:35,classicChordOrder:!0,sequentialQuantize:!1,pShifts:"Start",pOors:"Start",oors:!0,tempoMarks:!1,oorPrefix:"\\",transposition:0,lbauto_atleast:4,font:i[0],capturingImage:!1,missingTempo:!1,bpm:120}}=t;return e.$$set=e=>{"show"in e&&n(1,o=e.show),"settings"in e&&n(0,a=e.settings)},[a,o,r,i,function(){a.transposition=E(this.value),n(0,a)},()=>{r("auto")},()=>{r("lineBasedAuto")},function(){a.lbauto_atleast=E(this.value),n(0,a)},function(){a.pShifts=v(this),n(0,a)},function(){a.pOors=v(this),n(0,a)},function(){a.font=v(this),n(0,a)},function(){a.beats=E(this.value),n(0,a)},function(){a.bpm=E(this.value),n(0,a)},function(){a.quantize=E(this.value),n(0,a)},function(){a.classicChordOrder=this.checked,n(0,a)},function(){a.sequentialQuantize=this.checked,n(0,a)},function(){a.oors=this.checked,n(0,a)},function(){a.tempoMarks=this.checked,n(0,a)},function(){a.oorPrefix=this.value,n(0,a)},()=>r("copyText"),()=>r("captureSheetAsImage",{mode:"download"}),()=>r("captureSheetAsImage",{mode:"copy"})]}class xn extends ne{constructor(e){super(),te(this,e,kn,Nn,i,{show:1,settings:0})}}function Sn(t){let n,r,o,i,c,f,h,m,E,T=t[1].getTrackLength()+"";return{c(){n=u("div"),r=u("input"),o=d("\n    Track "),i=d(t[2]),c=d(" - "),f=d(T),h=d(" events"),g(r,"type","checkbox"),g(n,"id","track")},m(e,l){s(e,n,l),a(n,r),r.checked=t[0],a(n,o),a(n,i),a(n,c),a(n,f),a(n,h),m||(E=p(r,"change",t[3]),m=!0)},p(e,[t]){1&t&&(r.checked=e[0]),4&t&&y(i,e[2]),2&t&&T!==(T=e[1].getTrackLength()+"")&&y(f,T)},i:e,o:e,d(e){e&&l(n),m=!1,E()}}}function An(e,t,n){let{track:r,idx:o}=t,{selected:i=!1}=t;return e.$$set=e=>{"track"in e&&n(1,r=e.track),"idx"in e&&n(2,o=e.idx),"selected"in e&&n(0,i=e.selected)},[i,r,o,function(){i=this.checked,n(0,i)}]}class In extends ne{constructor(e){super(),te(this,e,An,Sn,i,{track:1,idx:2,selected:0})}}const Cn={long:"white",quadruple:"#a3f0a3",whole:"#74da74",half:"#9ada5a",quarter:"#c0c05a",eighth:"#da7e5a",sixteenth:"#daa6a6",thirtysecond:"#ff1900",sixtyfourth:"#9c0f00"};function Mn(e,t){return`<span style="color:${t}">${e}</span>`}function $n(e){let t,n,r=e[6](e[4])+"";return{c(){t=new x(!1),n=h(),t.a=n},m(e,o){t.m(r,e,o),s(e,n,o)},p(e,n){16&n&&r!==(r=e[6](e[4])+"")&&t.p(r)},d(e){e&&l(n),e&&t.d()}}}function Dn(e){let t,n,o,i;return{c(){t=u("span"),n=d(e[0]),g(t,"autofocus",""),g(t,"contenteditable","true"),g(t,"class","comment svelte-jszitz"),void 0===e[0]&&R((()=>e[13].call(t)))},m(r,l){s(r,t,l),a(t,n),void 0!==e[0]&&(t.textContent=e[0]),t.focus(),o||(i=[p(t,"focusout",e[7]),p(t,"input",e[13])],o=!0)},p(e,r){1&r&&y(n,e[0]),1&r&&e[0]!==t.textContent&&(t.textContent=e[0])},d(e){e&&l(t),o=!1,r(i)}}}function Pn(t){let n,o,i,c;function d(e,t){return e[0]||""==e[0]?Dn:$n}let f=d(t),h=f(t);return{c(){n=u("div"),o=u("div"),h.c(),g(o,"class","line svelte-jszitz"),g(n,"class","viewer svelte-jszitz"),w(n,"font-family",t[2].font)},m(e,r){s(e,n,r),a(n,o),h.m(o,null),i||(c=[p(o,"mousedown",t[14]),p(o,"contextmenu",m(t[12])),p(n,"contextmenu",m(t[11]))],i=!0)},p(e,[t]){f===(f=d(e))&&h?h.p(e,t):(h.d(1),h=f(e),h&&(h.c(),h.m(o,null))),4&t&&w(n,"font-family",e[2].font)},i:e,o:e,d(e){e&&l(n),h.d(),i=!1,r(c)}}}function Un(e,t,n){let r=I(),{index:o}=t,{comment:i}=t,{line:a}=t,{passedNext:s}=t,l=new un(a.chords),c=l,{sameTranspositionAsPrevious:u=!1}=t,{settings:d}=t;function f(e,t){let n=`<span style="color:${t}">`,r=e.notes.length>1&&e.notes.find((e=>!0===e.valid));!1===d.oors&&e.notes.filter((e=>!1===e.outOfRange)).length<=1&&(r=!1),r&&(n+="[");for(const r of e.notes)r.valid?!0===r.outOfRange?!0===d.oors&&(d.tempoMarks?n+=Mn(`${d.oorPrefix}${r.char}`,t):n+=`<span style="display:inline-block; border-bottom: 2px solid ${t}">${r.char}</span>`):n+=r.char:n+="_";return r&&(n+="]"),n+"</span>"}return e.$$set=e=>{"index"in e&&n(1,o=e.index),"comment"in e&&n(0,i=e.comment),"line"in e&&n(8,a=e.line),"passedNext"in e&&n(9,s=e.passedNext),"sameTranspositionAsPrevious"in e&&n(10,u=e.sameTranspositionAsPrevious),"settings"in e&&n(2,d=e.settings)},e.$$.update=()=>{268&e.$$.dirty&&(n(8,a.originalSheet=n(3,l=new un(a.chords)),a),n(4,c=l.transpose(a.transposition,d.pShifts,d.pOors,d.classicChordOrder,d.sequentialQuantize)))},[i,o,d,l,c,r,function(e){const t=-a.transposition;let n="";if(!u){let e=`Transpose by: ${t>0?"+":""}${t}`;a.difference&&(e+=` (${-a.difference>0?"+":""}${-a.difference})`),n+=Mn(e+"\n","white")}let r=e.chords;for(let e=0;e<r.length;e++){if(!r){n+="[bad-midi-file!]<br>";continue}const t={chord:r[e]};t.note=t.chord?.notes[0];const o={chord:r[e+1]};if(o.note=o.chord?.notes[0],!t.note)continue;if(!o.note){if(!s){n+=f(t.chord,"white");continue}o.note=s}let i=t.note.tempo/1e3,a=o.note.playTime-t.note.playTime;t.chord.is_quantized&&(a=o.note.playTime-t.chord.notes.slice(-1)[0].playTime),a-=.5;let l=Cn.long;a<i/16?l=Cn.sixtyfourth:a<i/8?l=Cn.thirtysecond:a<i/4?l=Cn.sixteenth:a<i/2?l=Cn.eighth:a<i?l=Cn.quarter:a<2*i?l=Cn.half:a<4*i?l=Cn.whole:a<8*i?l=Cn.quadruple:a<16*i&&(l=Cn.long),n+=f(t.chord,l),n+=d.tempoMarks?Mn(pn(i,a),l):" "}return n},function(){r("comment",""==i||"<br>"==i?{action:"remove",index:+o}:{index:+o,action:"update",comment:i})},a,s,u,function(t){C.call(this,e,t)},function(t){C.call(this,e,t)},function(){i=this.textContent,n(0,i)},e=>{switch(e.button){case 0:if(i)return;e.ctrlKey?r("comment",{action:"add",index:+o}):r("transpose",{index:+o,by:1});break;case 1:r("auto",{index:+o,sheet:l,keepGoing:e.ctrlKey}),e.preventDefault();break;case 2:e.ctrlKey&&i?r("comment",{action:"remove",index:+o}):r("transpose",{index:+o,by:-1})}}]}class Vn extends ne{constructor(e){super(),te(this,e,Un,Pn,i,{index:1,comment:0,line:8,passedNext:9,sameTranspositionAsPrevious:10,settings:2})}}const{document:Rn}=Y;function On(e,t,n){const r=e.slice();return r[34]=t[n][0],r[35]=t[n][1],r}function Fn(e,t,n){const r=e.slice();return r[38]=t[n],r[39]=t,r[40]=n,r}function Ln(e){let t,n,r,o,i,d,h,m=e[5],E=[];for(let t=0;t<m.length;t+=1)E[t]=Bn(Fn(e,m,t));const y=e=>K(E[e],1,1,(()=>{E[e]=null}));return{c(){t=u("section"),n=u("div");for(let e=0;e<E.length;e+=1)E[e].c();r=f(),o=u("button"),o.textContent="Import selected tracks",g(n,"id","tracks"),g(t,"id","track-chooser")},m(l,c){s(l,t,c),a(t,n);for(let e=0;e<E.length;e+=1)E[e].m(n,null);a(t,r),a(t,o),i=!0,d||(h=p(o,"click",e[24]),d=!0)},p(e,t){if(96&t[0]){let r;for(m=e[5],r=0;r<m.length;r+=1){const o=Fn(e,m,r);E[r]?(E[r].p(o,t),W(E[r],1)):(E[r]=Bn(o),E[r].c(),W(E[r],1),E[r].m(n,null))}for(G(),r=m.length;r<E.length;r+=1)y(r);j()}},i(e){if(!i){for(let e=0;e<m.length;e+=1)W(E[e]);i=!0}},o(e){E=E.filter(Boolean);for(let e=0;e<E.length;e+=1)K(E[e]);i=!1},d(e){e&&l(t),c(E,e),d=!1,h()}}}function Bn(e){let t,n,r;function o(t){e[23](t,e[40])}let i={track:e[38],idx:e[40]+1};return void 0!==e[6][e[40]]&&(i.selected=e[6][e[40]]),t=new In({props:i}),$.push((()=>Q(t,"selected",o))),{c(){X(t.$$.fragment)},m(e,n){J(t,e,n),r=!0},p(r,o){e=r;const i={};32&o[0]&&(i.track=e[38]),!n&&64&o[0]&&(n=!0,i.selected=e[6][e[40]],O((()=>n=!1))),t.$set(i)},i(e){r||(W(t.$$.fragment,e),r=!0)},o(e){K(t.$$.fragment,e),r=!1},d(e){Z(t,e)}}}function Hn(e){let t,n,r,o,i=Object.entries(e[1]),d=[];for(let t=0;t<i.length;t+=1)d[t]=qn(On(e,i,t));const f=e=>K(d[e],1,1,(()=>{d[e]=null}));return{c(){t=u("div"),n=u("div");for(let e=0;e<d.length;e+=1)d[e].c();w(n,"width","max-content"),R((()=>e[25].call(n))),w(t,"background","#2D2A32")},m(i,c){s(i,t,c),a(t,n);for(let e=0;e<d.length;e+=1)d[e].m(n,null);r=function(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");const n=u("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const r=k();let o;return r?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",o=p(window,"message",(e=>{e.source===n.contentWindow&&t()}))):(n.src="about:blank",n.onload=()=>{o=p(n.contentWindow,"resize",t)}),a(e,n),()=>{(r||o&&n.contentWindow)&&o(),l(n)}}(n,e[25].bind(n)),e[26](t),o=!0},p(e,t){if(221187&t[0]){let r;for(i=Object.entries(e[1]),r=0;r<i.length;r+=1){const o=On(e,i,r);d[r]?(d[r].p(o,t),W(d[r],1)):(d[r]=qn(o),d[r].c(),W(d[r],1),d[r].m(n,null))}for(G(),r=i.length;r<d.length;r+=1)f(r);j()}},i(e){if(!o){for(let e=0;e<i.length;e+=1)W(d[e]);o=!0}},o(e){d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)K(d[e]);o=!1},d(n){n&&l(t),c(d,n),r(),e[26](null)}}}function qn(e){let t,n;return t=new Vn({props:{line:e[35],index:e[34],settings:e[0],comment:e[35].comment,passedNext:e[35].continuation,sameTranspositionAsPrevious:e[17](e[34])}}),t.$on("transpose",e[13]),t.$on("auto",e[14]),t.$on("comment",e[16]),{c(){X(t.$$.fragment)},m(e,r){J(t,e,r),n=!0},p(e,n){const r={};2&n[0]&&(r.line=e[35]),2&n[0]&&(r.index=e[34]),1&n[0]&&(r.settings=e[0]),2&n[0]&&(r.comment=e[35].comment),2&n[0]&&(r.passedNext=e[35].continuation),2&n[0]&&(r.sameTranspositionAsPrevious=e[17](e[34])),t.$set(r)},i(e){n||(W(t.$$.fragment,e),n=!0)},o(e){K(t.$$.fragment,e),n=!1},d(e){Z(t,e)}}}function zn(e){let t,n,r,o,i,c,d,p,m,E,y,T;function b(t){e[20](t)}let v={show:e[4]};void 0!==e[0]&&(v.settings=e[0]),d=new xn({props:v}),$.push((()=>Q(d,"settings",b))),d.$on("auto",e[11]),d.$on("lineBasedAuto",e[21]),d.$on("captureSheetAsImage",e[15]),d.$on("copyText",e[22]);let _=e[3]&&Ln(e),N=e[4]&&Hn(e);return{c(){t=f(),n=u("div"),r=u("label"),r.innerHTML='Please import a MIDI file:\n        <a href="https://github.com/ArijanJ/midi-converter/wiki/Usage">How do I use this?</a>',o=f(),i=u("input"),c=f(),X(d.$$.fragment),m=f(),_&&_.c(),E=f(),N&&N.c(),y=h(),Rn.title="MIDI Converter",g(r,"for","file"),g(i,"type","file"),g(i,"accept",".mid,.midi"),w(n,"display","inline-block")},m(l,u){s(l,t,u),s(l,n,u),a(n,r),a(n,o),a(n,i),e[19](i),s(l,c,u),J(d,l,u),s(l,m,u),_&&_.m(l,u),s(l,E,u),N&&N.m(l,u),s(l,y,u),T=!0},p(e,t){const n={};16&t[0]&&(n.show=e[4]),!p&&1&t[0]&&(p=!0,n.settings=e[0],O((()=>p=!1))),d.$set(n),e[3]?_?(_.p(e,t),8&t[0]&&W(_,1)):(_=Ln(e),_.c(),W(_,1),_.m(E.parentNode,E)):_&&(G(),K(_,1,1,(()=>{_=null})),j()),e[4]?N?(N.p(e,t),16&t[0]&&W(N,1)):(N=Hn(e),N.c(),W(N,1),N.m(y.parentNode,y)):N&&(G(),K(N,1,1,(()=>{N=null})),j())},i(e){T||(W(d.$$.fragment,e),W(_),W(N),T=!0)},o(e){K(d.$$.fragment,e),K(_),K(N),T=!1},d(r){r&&l(t),r&&l(n),e[19](null),r&&l(c),Z(d,r),r&&l(m),_&&_.d(r),r&&l(E),N&&N.d(r),r&&l(y)}}}let Gn=.5;function jn(e,t,n){let r,o,i,a,s,l,c,u=!1,d=!1,f=0;var h;function p(e){if(!e)return!1;let t=e.tempo/1e3*g.beats,n=e.playTime-f;return n+Gn>=t?(f+=n,!0):void 0}h=()=>{r.addEventListener("change",(async()=>{await r.files[0].arrayBuffer().then((e=>{o=new an(e),function(e){return e.header.getTimeDivision()===an.Header.TICKS_PER_BEAT?{ticksPerBeat:e.header.getTicksPerBeat()}:{SMPTEFrames:e.header.getSMPTEFrames(),ticksPerFrame:e.header.getTicksPerFrame()}}(o).ticksPerBeat||console.error("No ticksPerBeat in this midi file"),n(5,i=o.tracks),n(6,s=i.map((()=>!0))),n(3,u=!0),n(4,d=!1),f=0}))}),!1)},A().$$.on_mount.push(h);let m,g,E=()=>{let e=function(e,t){let n=[];return e.getEvents().forEach((e=>{e.subtype==Xt.EVENT_META_SET_TEMPO&&n.push(e),e.subtype==Xt.EVENT_MIDI_NOTE_ON&&(e.track||!0!==t[0]?!0===t[e.track]&&n.push(e):n.push(e))})),n}(o,s);a=function(e,t){let n=t.quantize,r=t.pShifts,o=t.pOors,i=t.classicChordOrder,a=t.sequentialQuantize,s=t.bpm,l=[],c=[],u=0,d=!1,f=s,h=4166.66*s;e.forEach((e=>{if(81==e.subtype&&(t=e).tempo&&t.tempoBPM&&0!==t.tempo&&0!==t.tempoBPM)return d=!0,h=e.tempo,void(f=e.tempoBPM);var t;const s=e.param1,p=e.playTime,m=e.delta;if(null==u&&(u=p),Math.abs(p-u)<n)c.push(new ln(s,p,h,f,m,r,o)),u=p;else{if(0==c.length)return void(u=p);l.push(new cn(c,i,a)),c=[],c.push(new ln(s,p,h,f,m,r,o)),u=p}})),l.push(new cn(c,i));let p=new un(l);return d||console.log(`No tempo found in sheet, set to ${f}/${h}`),p.missingTempo=!d,p}(e,g),n(0,g.missingTempo=a.missingTempo,g)},y=()=>{if(n(4,d=!1),!a)return;const e=a.chords;f=0,n(1,w=[]);let t=[];for(let n=0;n<=e.length;n++){const r={chord:e[n]};r.note=r.chord?.notes[0];const o={chord:e[n+1]};o.note=o.chord?.notes[0],r.note&&r.chord&&(p(r.note)&&t.length>0&&(w.push({chords:t,transposition:g.transposition,continuation:r.note}),t=[]),t.push(r.chord))}w.push({chords:t,transposition:0,continuation:void 0}),n(4,d=!0),n(3,u=!1),n(1,w),n(18,m),n(0,g),n(10,y),n(9,E)},T=(e=0)=>{let t=hn(w[e].originalSheet,11,0,!0);for(let n=e;n<=w.length;n++){const e=w[n];if(!e)continue;const r=hn(e.originalSheet,8,t,!1,g.lbauto_atleast,t);b(n,r),t=r}n(1,w),n(18,m),n(0,g),n(10,y),n(9,E)},w=[];function b(e,t){let r=+e;n(1,w[r].transposition=t,w),w[r-1]&&n(1,w[r].difference=w[r].transposition-w[r-1].transposition,w),w[r+1]&&n(1,w[r+1].difference=w[r+1].transposition-w[r].transposition,w)}function v(e){n(0,g.capturingImage=!0,g),setTimeout((()=>function(e,t){return pe(this,null,(function*(){const n=yield mt(e,t),{log:r,type:o,quality:i,dpi:a}=n,s=yield Gt(n);r.time("canvas to blob");const l=yield it(s,o,i);if(["image/png","image/jpeg"].includes(o)&&a){const e=yield lt(l.slice(0,33));let t=new Uint8Array(e);return"image/png"===o?t=be(t,a):"image/jpeg"===o&&(t=function(e,t){return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e}(t,a)),r.timeEnd("canvas to blob"),new Blob([t,l.slice(33)],{type:o})}return r.timeEnd("canvas to blob"),l}))}(l,{width:c,scale:2}).then((t=>{"copy"===e?function(e){try{navigator.clipboard.write([new ClipboardItem({"image/png":e})])}catch(e){console.error(e)}}(t):function(e){const t=URL.createObjectURL(e);let n=r.files[0].name.split(".");n.pop(),n=n.join(".")+".png";let o=document.createElement("a");o.href=t,o.download=n,document.body.appendChild(o),o.click(),URL.revokeObjectURL(t),document.body.removeChild(o)}(t),n(0,g.capturingImage=!1,g)}))),250)}return e.$$.update=()=>{if(262147&e.$$.dirty[0])if(m){if(m.transposition!=g.transposition){for(let e of w)e.transposition=g.transposition;n(1,w),n(18,m),n(0,g),n(10,y),n(9,E)}else m.beats!=g.beats?y():m.quantize!=g.quantize||m.sequentialQuantize!=g.sequentialQuantize||m.classicChordOrder!=g.classicChordOrder?(E(),y(),n(1,w),n(18,m),n(0,g),n(10,y),n(9,E)):m.bpm!=g.bpm&&(E(),y());n(18,m={...g})}else n(18,m={...g})},[g,w,r,u,d,i,s,l,c,E,y,()=>{n(0,g.transposition=hn(a,11),g);for(let e=0;e<w.length;e++)b(e,g.transposition)},T,e=>{const t=e.detail.index,n=e.detail.by;setTimeout((()=>{b(t,w[t].transposition+n)}),0)},e=>{const t=e.detail.keepGoing,n=e.detail.index;b(n,hn(e.detail.sheet,11,w[n-1]?.transposition??0,0,0)),t&&T(n)},function(e){v(e.detail.mode)},function(e){const t=e.detail.index,r=e.detail.action,o=e.detail.comment;switch(r){case"add":setTimeout((()=>{w[t-1]?.comment||(w.splice(t,0,{comment:"Add a comment..."}),n(1,w),n(18,m),n(0,g),n(10,y),n(9,E))}),0);break;case"remove":w.splice(t,1),n(1,w),n(18,m),n(0,g),n(10,y),n(9,E);break;case"update":n(1,w[t].comment=o,w)}},function(e){const t=w[e];for(let n=e-1;n>=0;n--){const e=w[n];if(!e.comment)return e.transposition==t.transposition}},m,function(e){$[e?"unshift":"push"]((()=>{r=e,n(2,r)}))},function(e){g=e,n(0,g)},()=>{T()},()=>{n(0,g.tempoMarks=!0,g),setTimeout((()=>{let e="",t=l.querySelector("div.viewer").parentElement;for(let n of t.children)n?.innerText&&(e+=n.children[0]?.innerText+"\n");navigator.clipboard.writeText(e)}),0)},function(t,r){e.$$.not_equal(s[r],t)&&(s[r]=t,n(6,s))},()=>{E(),y()},function(){c=this.clientWidth,n(8,c)},function(e){$[e?"unshift":"push"]((()=>{l=e,n(7,l)}))}]}return new class extends ne{constructor(e){super(),te(this,e,jn,zn,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
