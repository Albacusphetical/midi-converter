var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t){e.appendChild(t)}function s(e,t,n){e.insertBefore(t,n||null)}function l(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function u(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function f(){return d(" ")}function h(){return d("")}function p(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function g(e){return function(t){return t.preventDefault(),e.call(this,t)}}function E(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function m(e){return""===e?null:+e}function y(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function w(e,t){e.value=null==t?"":t}function T(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function b(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}e.selectedIndex=-1}function v(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}let _,N;function A(){if(void 0===_){_=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(e){_=!0}}return _}function S(e){N=e}function k(){if(!N)throw new Error("Function called outside component initialization");return N}function I(){const e=k();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=function(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,r,t),o}(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}function x(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const M=[],C=[],$=[],D=[],U=Promise.resolve();let V=!1;function P(e){$.push(e)}function R(e){D.push(e)}const O=new Set;let F=0;function L(){if(0!==F)return;const e=N;do{try{for(;F<M.length;){const e=M[F];F++,S(e),B(e.$$)}}catch(e){throw M.length=0,F=0,e}for(S(null),M.length=0,F=0;C.length;)C.pop()();for(let e=0;e<$.length;e+=1){const t=$[e];O.has(t)||(O.add(t),t())}$.length=0}while(M.length);for(;D.length;)D.pop()();V=!1,O.clear(),S(e)}function B(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(P)}}const H=new Set;let q;function z(){q={r:0,c:[],p:q}}function G(){q.r||r(q.c),q=q.p}function j(e,t){e&&e.i&&(H.delete(e),e.i(t))}function W(e,t,n,r){if(e&&e.o){if(H.has(e))return;H.add(e),q.c.push((()=>{H.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const Y="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function K(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function Q(e){e&&e.c()}function X(e,n,i,a){const{fragment:s,after_update:l}=e.$$;s&&s.m(n,i),a||P((()=>{const n=e.$$.on_mount.map(t).filter(o);e.$$.on_destroy?e.$$.on_destroy.push(...n):r(n),e.$$.on_mount=[]})),l.forEach(P)}function J(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Z(e,t){-1===e.$$.dirty[0]&&(M.push(e),V||(V=!0,U.then(L)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ee(t,o,i,a,s,c,u,d=[-1]){const f=N;S(t);const h=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(f?f.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:o.target||f.$$.root};u&&u(h.root);let p=!1;if(h.ctx=i?i(t,o.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return h.ctx&&s(h.ctx[e],h.ctx[e]=o)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](o),p&&Z(t,e)),n})):[],h.update(),p=!0,r(h.before_update),h.fragment=!!a&&a(h.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);h.fragment&&h.fragment.l(e),e.forEach(l)}else h.fragment&&h.fragment.c();o.intro&&j(t.$$.fragment),X(t,o.target,o.anchor,o.customElement),L()}S(f)}class te{$destroy(){J(this,1),this.$destroy=e}$on(t,n){if(!o(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var ne=Object.defineProperty,re=Object.defineProperties,oe=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable,le=Math.pow,ce=(e,t,n)=>t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ue=(e,t)=>{for(var n in t||(t={}))ae.call(t,n)&&ce(e,n,t[n]);if(ie)for(var n of ie(t))se.call(t,n)&&ce(e,n,t[n]);return e},de=(e,t)=>re(e,oe(t)),fe=(e,t)=>{var n={};for(var r in e)ae.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&ie)for(var r of ie(e))t.indexOf(r)<0&&se.call(e,r)&&(n[r]=e[r]);return n},he=(e,t,n)=>new Promise(((r,o)=>{var i=e=>{try{s(n.next(e))}catch(e){o(e)}},a=e=>{try{s(n.throw(e))}catch(e){o(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);s((n=n.apply(e,t)).next())}));const pe="p".charCodeAt(0),ge="H".charCodeAt(0),Ee="Y".charCodeAt(0),me="s".charCodeAt(0);let ye;function we(e){let t=-1;ye||(ye=function(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}());for(let n=0;n<e.length;n++)t=ye[255&(t^e[n])]^t>>>8;return-1^t}function Te(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=pe,r[1]=ge,r[2]=Ee,r[3]=me,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=255&t,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const o=we(r),i=new Uint8Array(4);if(i[0]=o>>>24,i[1]=o>>>16,i[2]=o>>>8,i[3]=255&o,n){const t=function(e){for(let t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===pe&&e[t-2]===ge&&e[t-1]===Ee&&e[t]===me)return t-3;return 0}(e);return e.set(r,t),e.set(i,t+13),e}{const t=new Uint8Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=9;const n=new Uint8Array(54);return n.set(e,0),n.set(t,33),n.set(r,37),n.set(i,50),n}}const be="[modern-screenshot]",ve="undefined"!=typeof window,_e=ve&&"Worker"in window,Ne=ve&&"atob"in window;var Ae;const Se=ve?null==(Ae=window.navigator)?void 0:Ae.userAgent:"",ke=Se.includes("Chrome"),Ie=Se.includes("AppleWebKit")&&!ke,xe=Se.includes("Firefox"),Me=e=>e&&"__CONTEXT__"in e,Ce=e=>"CSSFontFaceRule"===e.constructor.name,$e=e=>"CSSImportRule"===e.constructor.name,De=e=>1===e.nodeType,Ue=e=>"object"==typeof e.className,Ve=e=>"image"===e.tagName,Pe=e=>"use"===e.tagName,Re=e=>De(e)&&void 0!==e.style&&!Ue(e),Oe=e=>8===e.nodeType,Fe=e=>3===e.nodeType,Le=e=>"IMG"===e.tagName,Be=e=>"VIDEO"===e.tagName,He=e=>"CANVAS"===e.tagName,qe=e=>"TEXTAREA"===e.tagName,ze=e=>"INPUT"===e.tagName,Ge=e=>"STYLE"===e.tagName,je=e=>"SCRIPT"===e.tagName,We=e=>"SELECT"===e.tagName,Ye=e=>"SLOT"===e.tagName,Ke=e=>"IFRAME"===e.tagName,Qe=(...e)=>console.warn(be,...e),Xe=e=>console.time(`${be} ${e}`),Je=e=>console.timeEnd(`${be} ${e}`),Ze=e=>{var t;const n=null==(t=null==e?void 0:e.createElement)?void 0:t.call(e,"canvas");return n&&(n.height=n.width=1),n&&"toDataURL"in n&&Boolean(n.toDataURL("image/webp").includes("image/webp"))},et=e=>e.startsWith("data:");function tt(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(ve&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!ve)return e;const n=nt().implementation.createHTMLDocument(),r=n.createElement("base"),o=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(o),t&&(r.href=t),o.href=e,o.href}function nt(e){var t;return null!=(t=e&&De(e)?null==e?void 0:e.ownerDocument:e)?t:window.document}const rt="http://www.w3.org/2000/svg";function ot(e,t="image/png",n=1){return he(this,null,(function*(){try{return yield new Promise(((r,o)=>{e.toBlob((e=>{e?r(e):o(new Error("Blob is null"))}),t,n)}))}catch(r){if(Ne)return Qe("Failed canvas to blob",{type:t,quality:n},r),function(e){var t,n;const[r,o]=e.split(","),i=null!=(n=null==(t=r.match(/data:(.+);/))?void 0:t[1])?n:void 0,a=window.atob(o),s=a.length,l=new Uint8Array(s);for(let e=0;e<s;e+=1)l[e]=a.charCodeAt(e);return new Blob([l],{type:i})}(e.toDataURL(t,n));throw r}}))}function it(e,t){return new Promise(((n,r)=>{const o=new FileReader;o.onload=()=>n(o.result),o.onerror=()=>r(o.error),o.onabort=()=>r(new Error(`Failed read blob to ${t}`)),"dataUrl"===t?o.readAsDataURL(e):"arrayBuffer"===t&&o.readAsArrayBuffer(e)}))}const at=e=>it(e,"dataUrl"),st=e=>it(e,"arrayBuffer");function lt(e,t){const n=nt(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function ct(e,t){return new Promise((n=>{const{timeout:r,ownerDocument:o,onError:i}=null!=t?t:{},a="string"==typeof e?lt(e,nt(o)):e;let s=null,l=null;function c(){n(a),s&&clearTimeout(s),null==l||l()}if(r&&(s=setTimeout(c,r)),Be(a)){const e=a.currentSrc||a.src;if(!e)return a.poster?ct(a.poster,t).then(n):c();if(a.readyState>=2)return c();const r=c,o=t=>{Qe("Failed video load",e,t),null==i||i(t),c()};l=()=>{a.removeEventListener("loadeddata",r),a.removeEventListener("error",o)},a.addEventListener("loadeddata",r,{once:!0}),a.addEventListener("error",o,{once:!0})}else{const e=Ve(a)?a.href.baseVal:a.currentSrc||a.src;if(!e)return c();const t=()=>he(this,null,(function*(){if(Le(a)&&"decode"in a)try{yield a.decode()}catch(t){Qe("Failed to decode image, trying to render anyway",a.dataset.originalSrc||e,t)}c()})),n=t=>{Qe("Failed image load",a.dataset.originalSrc||e,t),c()};if(Le(a)&&a.complete)return t();l=()=>{a.removeEventListener("load",t),a.removeEventListener("error",n)},a.addEventListener("load",t,{once:!0}),a.addEventListener("error",n,{once:!0})}}))}const ut=function(){let e=0;return()=>(e+=1,`u${`0000${(Math.random()*le(36,4)<<0).toString(36)}`.slice(-4)}${e}`)}();function dt(e){return null==e?void 0:e.split(",").map((e=>e.trim().replace(/"|'/g,"").toLowerCase())).filter(Boolean)}function ft(e){return{time:t=>e&&Xe(t),timeEnd:t=>e&&Je(t),warn:(...t)=>e&&Qe(...t)}}function ht(e){return{cache:e?"no-cache":"force-cache"}}function pt(e,t){return he(this,null,(function*(){return Me(e)?e:function(e,t){return he(this,null,(function*(){var n,r,o,i,a;const{scale:s=1,workerUrl:l,workerNumber:c=1}=t||{},u=Boolean(null==t?void 0:t.debug),d=null==(n=null==t?void 0:t.features)||n,f=null!=(r=e.ownerDocument)?r:ve?window.document:void 0,h=null!=(i=null==(o=e.ownerDocument)?void 0:o.defaultView)?i:ve?window:void 0,p=new Map,g=de(ue({width:0,height:0,quality:1,type:"image/png",scale:s,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:u,fetch:ue({requestInit:ht(null==(a=null==t?void 0:t.fetch)?void 0:a.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},null==t?void 0:t.fetch),fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:c,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:ft(u),node:e,ownerDocument:f,ownerWindow:h,dpi:1===s?null:96*s,svgStyleElement:gt(f),svgDefsElement:null==f?void 0:f.createElementNS(rt,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...new Array(_e&&l&&c?c:0)].map((()=>{try{const e=new Worker(l);return e.onmessage=e=>he(this,null,(function*(){var t,n,r,o;const{url:i,result:a}=e.data;a?null==(n=null==(t=p.get(i))?void 0:t.resolve)||n.call(t,a):null==(o=null==(r=p.get(i))?void 0:r.reject)||o.call(r,new Error(`Error receiving message from worker: ${i}`))})),e.onmessageerror=e=>{var t,n;const{url:r}=e.data;null==(n=null==(t=p.get(r))?void 0:t.reject)||n.call(t,new Error(`Error receiving message from worker: ${r}`))},e}catch(e){return Qe("Failed to new Worker",e),null}})).filter(Boolean),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[Ze(f)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:p,drawImageCount:0,tasks:[],features:d,isEnable:e=>{var t;return"boolean"==typeof d?d:null==(t=d[e])||t}});g.log.time("wait until load"),yield function(e,t){return he(this,null,(function*(){Re(e)&&(Le(e)||Be(e)?yield ct(e,{timeout:t}):yield Promise.all(["img","video"].flatMap((n=>Array.from(e.querySelectorAll(n)).map((e=>ct(e,{timeout:t})))))))}))}(e,g.timeout),g.log.timeEnd("wait until load");const{width:E,height:m}=function(e,t){let{width:n,height:r}=t;if(De(e)&&(!n||!r)){const t=e.getBoundingClientRect();n=n||t.width||Number(e.getAttribute("width"))||0,r=r||t.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}(e,g);return g.width=E,g.height=m,g}))}(e,de(ue({},t),{autoDestruct:!0}))}))}function gt(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode("\n.______background-clip--text {\n  background-clip: text;\n  -webkit-background-clip: text;\n}\n");return t.appendChild(n),t}function Et(e,t){return he(this,null,(function*(){const{log:n,timeout:r,drawImageCount:o,drawImageInterval:i}=t;n.time("image to canvas");const a=yield ct(e,{timeout:r}),{canvas:s,context2d:l}=function(e,t){const{width:n,height:r,scale:o,backgroundColor:i,maximumCanvasSize:a}=t,s=e.createElement("canvas");s.width=Math.floor(n*o),s.height=Math.floor(r*o),s.style.width=`${n}px`,s.style.height=`${r}px`,a&&(s.width>a||s.height>a)&&(s.width>a&&s.height>a?s.width>s.height?(s.height*=a/s.width,s.width=a):(s.width*=a/s.height,s.height=a):s.width>a?(s.height*=a/s.width,s.width=a):(s.width*=a/s.height,s.height=a));const l=s.getContext("2d");return l&&i&&(l.fillStyle=i,l.fillRect(0,0,s.width,s.height)),{canvas:s,context2d:l}}(e.ownerDocument,t),c=()=>{try{null==l||l.drawImage(a,0,0,s.width,s.height)}catch(e){Qe("Failed to drawImage",e)}};if(c(),t.isEnable("fixSvgXmlDecode"))for(let e=0;e<o;e++)yield new Promise((t=>{setTimeout((()=>{c(),t()}),e+i)}));return t.drawImageCount=0,n.timeEnd("image to canvas"),s}))}const mt=["width","height","-webkit-text-fill-color"],yt=["stroke","fill"];function wt(e,t,n){var r;const{defaultComputedStyles:o,ownerDocument:i}=n,a=e.nodeName.toLowerCase(),s=Ue(e)&&"svg"!==a,l=s?yt.map((t=>[t,e.getAttribute(t)])).filter((([,e])=>null!==e)):[],c=[s&&"svg",a,l.map(((e,t)=>`${e}=${t}`)).join(","),t].filter(Boolean).join(":");if(o.has(c))return o.get(c);let u=n.sandbox;if(!u)try{i&&(u=i.createElement("iframe"),u.id=`__SANDBOX__-${ut()}`,u.width="0",u.height="0",u.style.visibility="hidden",u.style.position="fixed",i.body.appendChild(u),null==(r=u.contentWindow)||r.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),n.sandbox=u)}catch(e){Qe("Failed to create iframe sandbox",e)}if(!u)return new Map;const d=u.contentWindow;if(!d)return new Map;const f=d.document;let h,p;s?(h=f.createElementNS(rt,"svg"),p=h.ownerDocument.createElementNS(h.namespaceURI,a),l.forEach((([e,t])=>{p.setAttributeNS(null,e,t)})),h.appendChild(p)):h=p=f.createElement(a),p.textContent=" ",f.body.appendChild(h);const g=d.getComputedStyle(p,t),E=new Map;for(let e=g.length,t=0;t<e;t++){const e=g.item(t);mt.includes(e)||E.set(e,g.getPropertyValue(e))}return f.body.removeChild(h),o.set(c,E),E}function Tt(e,t,n){var r;const o=new Map,i=[],a=new Map;if(n)for(const e of n)s(e);else for(let t=e.length,n=0;n<t;n++){s(e.item(n))}for(let e=i.length,t=0;t<e;t++)null==(r=a.get(i[t]))||r.forEach(((e,t)=>o.set(t,e)));function s(n){const r=e.getPropertyValue(n),s=e.getPropertyPriority(n),l=n.lastIndexOf("-"),c=l>-1?n.substring(0,l):void 0;if(c){let e=a.get(c);e||(e=new Map,a.set(c,e)),e.set(n,[r,s])}t.get(n)===r&&!s||(c?i.push(c):o.set(n,[r,s]))}return o}const bt=[":before",":after"],vt=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function _t(e){if(e.ownerDocument)try{const t=e.toDataURL();if("data:,"!==t)return lt(t,e.ownerDocument)}catch(e){}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(e){Qe("Failed to clone canvas",e)}return t}function Nt(e,t){return He(e)?_t(e):Ke(e)?function(e,t){var n;try{if(null!=(n=null==e?void 0:e.contentDocument)&&n.body)return xt(e.contentDocument.body,t)}catch(e){Qe("Failed to clone iframe",e)}return e.cloneNode(!1)}(e,t):Le(e)?function(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager"),t}(e):Be(e)?function(e){return he(this,null,(function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return lt(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield ct(t,{onError:()=>r=!1}),!r)return e.poster?lt(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise((e=>{t.addEventListener("seeked",e,{once:!0})}));const o=n.createElement("canvas");o.width=e.offsetWidth,o.height=e.offsetHeight;try{const e=o.getContext("2d");e&&e.drawImage(t,0,0,o.width,o.height)}catch(n){return Qe("Failed to clone video",n),e.poster?lt(e.poster,e.ownerDocument):t}return _t(o)}return t}))}(e):e.cloneNode(!1)}const At=new Set(["symbol"]);function St(e,t,n){return he(this,null,(function*(){De(t)&&(Ge(t)||je(t))||n.filter&&!n.filter(t)||(At.has(e.nodeName)||At.has(t.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle,e.appendChild(yield xt(t,n)))}))}function kt(e,t,n){return he(this,null,(function*(){var r,o;for(let i=null!=(o=De(e)?null==(r=e.shadowRoot)?void 0:r.firstChild:void 0)?o:e.firstChild;i;i=i.nextSibling)if(!Oe(i))if(De(i)&&Ye(i)&&"function"==typeof i.assignedNodes){const e=i.assignedNodes();for(let r=0;r<e.length;r++)yield St(t,e[r],n)}else yield St(t,i,n)}))}const It=/^[\w-:]+$/;function xt(e,t,n=!1){return he(this,null,(function*(){var r,o,i,a;const{ownerDocument:s,ownerWindow:l,fontFamilies:c}=t;if(s&&Fe(e))return s.createTextNode(e.data);if(s&&l&&De(e)&&(Re(e)||Ue(e))){const s=yield Nt(e,t);if(t.isEnable("removeAbnormalAttributes")){const e=s.getAttributeNames();for(let t=e.length,n=0;n<t;n++){const t=e[n];It.test(t)||s.removeAttribute(t)}}const l=t.currentNodeStyle=function(e,t,n,r){var o,i,a,s;const{ownerWindow:l,includeStyleProperties:c,currentParentNodeStyle:u}=r,d=t.style,f=l.getComputedStyle(e),h=wt(e,null,r);null==u||u.forEach(((e,t)=>{h.delete(t)}));const p=Tt(f,h,c);return p.delete("transition-property"),p.delete("all"),p.delete("d"),p.delete("content"),n&&(p.delete("margin-top"),p.delete("margin-right"),p.delete("margin-bottom"),p.delete("margin-left"),p.delete("margin-block-start"),p.delete("margin-block-end"),p.delete("margin-inline-start"),p.delete("margin-inline-end"),p.set("box-sizing",["border-box",""])),"text"===(null==(o=p.get("background-clip"))?void 0:o[0])&&t.classList.add("______background-clip--text"),ke&&(p.has("font-kerning")||p.set("font-kerning",["normal",""]),("hidden"===(null==(i=p.get("overflow-x"))?void 0:i[0])||"hidden"===(null==(a=p.get("overflow-y"))?void 0:a[0]))&&"ellipsis"===(null==(s=p.get("text-overflow"))?void 0:s[0])&&e.scrollWidth===e.clientWidth&&p.set("text-overflow",["clip",""])),p.forEach((([e,t],n)=>{d.setProperty(n,e,t)})),p}(e,s,n,t);n&&function(e,t){const{backgroundColor:n,width:r,height:o,style:i}=t,a=e.style;if(n&&a.setProperty("background-color",n,"important"),r&&a.setProperty("width",`${r}px`,"important"),o&&a.setProperty("height",`${o}px`,"important"),i)for(const e in i)a[e]=i[e]}(s,t);let u=!1;if(t.isEnable("copyScrollbar")){const t=[null==(r=l.get("overflow-x"))?void 0:r[0],null==(o=l.get("overflow-y"))?void 0:o[1]];u=t.includes("scroll")||(t.includes("auto")||t.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}return function(e,t,n,r){const{ownerWindow:o,svgStyleElement:i,svgStyles:a,currentNodeStyle:s}=r;function l(n){var i;const l=o.getComputedStyle(e,n);let c=l.getPropertyValue("content");if(!c||"none"===c)return;c=c.replace(/(')|(")|(counter\(.+\))/g,"");const u=[ut()],d=wt(e,n,r);null==s||s.forEach(((e,t)=>{d.delete(t)}));const f=Tt(l,d,r.includeStyleProperties);f.delete("content"),f.delete("-webkit-locale"),"text"===(null==(i=f.get("background-clip"))?void 0:i[0])&&t.classList.add("______background-clip--text");const h=[`content: '${c}';`];if(f.forEach((([e,t],n)=>{h.push(`${n}: ${e}${t?" !important":""};`)})),1===h.length)return;try{t.className=[t.className,...u].join(" ")}catch(e){return}const p=h.join("\n  ");let g=a.get(p);g||(g=[],a.set(p,g)),g.push(`.${u[0]}:${n}`)}i&&o&&(bt.forEach(l),n&&vt.forEach(l))}(e,s,u,t),function(e,t){qe(e)&&(t.innerHTML=e.value),(qe(e)||ze(e)||We(e))&&t.setAttribute("value",e.value)}(e,s),null==(a=dt(null==(i=l.get("font-family"))?void 0:i[0]))||a.forEach((e=>c.add(e))),Be(e)||(yield kt(e,s,t)),s}const u=e.cloneNode(!1);return yield kt(e,u,t),u}))}function Mt(e,t){const{url:n,requestType:r="text",responseType:o="text",imageDom:i}=t;let a=n;const{timeout:s,acceptOfImage:l,requests:c,fetchFn:u,fetch:{requestInit:d,bypassingCache:f,placeholderImage:h},workers:p}=e;"image"===r&&(Ie||xe)&&e.drawImageCount++;let g=c.get(n);if(!g){f&&f instanceof RegExp&&f.test(a)&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());const e=ue({url:a,timeout:s,responseType:o,headers:"image"===r?{accept:l}:void 0},d);g={type:r,resolve:void 0,reject:void 0,response:null},g.response=(()=>he(this,null,(function*(){if(u&&"image"===r){const e=yield u(n);if(e)return e}return!Ie&&n.startsWith("http")&&p.length?new Promise(((t,r)=>{p[c.size&p.length-1].postMessage(ue({rawUrl:n},e)),g.resolve=t,g.reject=r})):function(e){const t=e,{url:n,timeout:r,responseType:o}=t,i=fe(t,["url","timeout","responseType"]),a=new AbortController,s=r?setTimeout((()=>a.abort()),r):void 0;return fetch(n,ue({signal:a.signal},i)).then((e=>{if(!e.ok)throw new Error("Failed fetch, not 2xx response",{cause:e});return"dataUrl"===o?e.blob().then(at):e.text()})).finally((()=>clearTimeout(s)))}(e)})))().catch((e=>{if(c.delete(n),"image"===r&&h)return Qe("Failed to fetch image base64, trying to use placeholder image",a),"string"==typeof h?h:h(i);throw e})),c.set(n,g)}return g.response}function Ct(e,t,n,r){return he(this,null,(function*(){if(!$t(e))return e;for(const[o,i]of function(e,t){const n=[];return e.replace(Dt,((e,r,o)=>(n.push([o,tt(o,t)]),e))),n.filter((([e])=>!et(e)))}(e,t))try{const t=yield Mt(n,{url:i,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace(Ut(o),`$1${t}$3`)}catch(e){Qe("Failed to fetch css data url",o,e)}return e}))}function $t(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Dt=/url\((['"]?)([^'"]+?)\1\)/g;function Ut(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Vt(e,t){return he(this,null,(function*(){const{ownerDocument:e,svgStyleElement:n,fontFamilies:r,fontCssTexts:o,tasks:i,font:a}=t;if(e&&n&&r.size)if(a&&a.cssText){const r=Lt(a.cssText,t);n.appendChild(e.createTextNode(`${r}\n`))}else{const a=Array.from(e.styleSheets).filter((e=>{try{return"cssRules"in e&&Boolean(e.cssRules.length)}catch(t){return Qe(`Error while reading CSS rules from ${e.href}`,t),!1}}));yield Promise.all(a.flatMap((e=>Array.from(e.cssRules).map(((n,r)=>he(this,null,(function*(){if($e(n)){let o=r+1;const i=n.href;let a="";try{a=yield Mt(t,{url:i,requestType:"text",responseType:"text"})}catch(e){Qe(`Error fetch remote css import from ${i}`,e)}const s=a.replace(Dt,((e,t,n)=>e.replace(n,tt(n,i))));for(const t of function(e){if(null==e)return[];const t=[];let n=e.replace(Pt,"");for(;;){const e=Rt.exec(n);if(!e)break;t.push(e[0])}n=n.replace(Rt,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=r.exec(n);if(e)o.lastIndex=r.lastIndex;else{if(e=o.exec(n),!e)break;r.lastIndex=o.lastIndex}t.push(e[0])}return t}(s))try{e.insertRule(t,t.startsWith("@import")?o+=1:e.cssRules.length)}catch(e){Qe("Error inserting rule from remote css import",{rule:t,error:e})}}}))))))),a.flatMap((e=>Array.from(e.cssRules))).filter((e=>{var t;return Ce(e)&&$t(e.style.getPropertyValue("src"))&&(null==(t=dt(e.style.getPropertyValue("font-family")))?void 0:t.some((e=>r.has(e))))})).forEach((r=>{const a=r,s=o.get(a.cssText);s?n.appendChild(e.createTextNode(`${s}\n`)):i.push(Ct(a.cssText,a.parentStyleSheet?a.parentStyleSheet.href:null,t).then((r=>{r=Lt(r,t),o.set(a.cssText,r),n.appendChild(e.createTextNode(`${r}\n`))})))}))}}))}const Pt=/(\/\*[\s\S]*?\*\/)/gi,Rt=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;const Ot=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Ft=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Lt(e,t){const{font:n}=t,r=n?null==n?void 0:n.preferredFormat:void 0;return r?e.replace(Ft,(e=>{for(;;){const[t,,n]=Ot.exec(e)||[];if(!n)return"";if(n===r)return`src: ${t};`}})):e}const Bt=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Ht(e,t){const{tasks:n}=t;De(e)&&((Le(e)||Ve(e))&&n.push(...function(e,t){if(Le(e)){const n=e.currentSrc||e.src;if(!et(n))return[Mt(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then((t=>{t&&(e.srcset="",e.dataset.originalSrc=n,e.src=t||"")}))];(Ie||xe)&&t.drawImageCount++}else if(Ue(e)&&!et(e.href.baseVal)){const n=e.href.baseVal;return[Mt(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then((t=>{t&&(e.dataset.originalSrc=n,e.href.baseVal=t||"")}))]}return[]}(e,t)),Pe(e)&&n.push(...function(e,t){var n;const{ownerDocument:r,svgDefsElement:o}=t,i=null!=(n=e.getAttribute("href"))?n:e.getAttribute("xlink:href");if(!i)return[];const[a,s]=i.split("#");if(s){const n=`#${s}`,i=null==r?void 0:r.querySelector(`svg ${n}`);if(a&&e.setAttribute("href",n),null!=o&&o.querySelector(n))return[];if(i)return[xt(i,t).then((e=>{null!=o&&o.querySelector(n)||null==o||o.appendChild(e)}))];if(a)return[Mt(t,{url:a,responseType:"text"}).then((e=>{null==o||o.insertAdjacentHTML("beforeend",e)}))]}return[]}(e,t))),Re(e)&&n.push(...function(e,t){return Bt.map((n=>{const r=e.getPropertyValue(n);return r&&"none"!==r?((Ie||xe)&&t.drawImageCount++,Ct(r,null,t,!0).then((t=>{!t||r===t||e.setProperty(n,t,e.getPropertyPriority(n))}))):null})).filter(Boolean)}(e.style,t)),e.childNodes.forEach((e=>{Ht(e,t)}))}function qt(e,t){return he(this,null,(function*(){const n=yield pt(e,t);if(De(n.node)&&Ue(n.node))return n.node;const{ownerDocument:r,log:o,tasks:i,svgStyleElement:a,svgDefsElement:s,svgStyles:l,font:c,progress:u,autoDestruct:d,onCloneNode:f,onEmbedNode:h,onCreateForeignObjectSvg:p}=n;o.time("clone node");const g=yield xt(n.node,n,!0);if(a&&r){let e="";l.forEach(((t,n)=>{e+=`${t.join(",\n")} {\n  ${n}\n}\n`})),a.appendChild(r.createTextNode(e))}o.timeEnd("clone node"),null==f||f(g),!1!==c&&De(g)&&(o.time("embed web font"),yield Vt(0,n),o.timeEnd("embed web font")),o.time("embed node"),Ht(g,n);const E=i.length;let m=0;null==u||u(m,E),yield Promise.all([...Array(4)].map((()=>he(this,null,(function*(){for(;;){const e=i.pop();if(!e)break;try{yield e}catch(e){Qe("Failed to run task",e)}null==u||u(++m,E)}}))))),o.timeEnd("embed node"),null==h||h(g);const y=function(e,t){const{width:n,height:r}=t,o=function(e,t,n){const r=nt(n).createElementNS(rt,"svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}(n,r,e.ownerDocument),i=o.ownerDocument.createElementNS(o.namespaceURI,"foreignObject");return i.setAttributeNS(null,"x","0%"),i.setAttributeNS(null,"y","0%"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),i.append(e),o.appendChild(i),o}(g,n);return s&&y.insertBefore(s,y.children[0]),a&&y.insertBefore(a,y.children[0]),d&&function(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(e){}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}(n),null==p||p(y),y}))}function zt(e,t){return he(this,null,(function*(){var n;const r=yield pt(e,t),o=yield qt(r),i=function(e,t){let n=(new XMLSerializer).serializeToString(e);return t&&(n=n.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`}(o,r.isEnable("removeControlCharacter"));r.autoDestruct||(r.svgStyleElement=gt(r.ownerDocument),r.svgDefsElement=null==(n=r.ownerDocument)?void 0:n.createElementNS(rt,"defs"),r.svgStyles.clear());const a=lt(i,o.ownerDocument);return yield Et(a,r)}))}function Gt(e){let t;if(e){if(!(e instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(this.datas=new DataView(e,0,Gt.HEADER_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"h"!==String.fromCharCode(this.datas.getUint8(2))||"d"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileHeader : MThd prefix not found");if(6!==this.datas.getUint32(4))throw new Error("Invalid MIDIFileHeader : Chunk length must be 6")}else t=new Uint8Array(Gt.HEADER_LENGTH),t[0]=77,t[1]=84,t[2]=104,t[3]=100,t[4]=0,t[5]=0,t[6]=0,t[7]=6,t[8]=0,t[9]=1,t[10]=0,t[11]=1,t[12]=0,t[13]=192,this.datas=new DataView(t.buffer,0,Gt.HEADER_LENGTH)}Gt.HEADER_LENGTH=14,Gt.FRAMES_PER_SECONDS=1,Gt.TICKS_PER_BEAT=2,Gt.prototype.getFormat=function(){const e=this.datas.getUint16(8);if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI file : MIDI format ("+e+"), format can be 0, 1 or 2 only.");return e},Gt.prototype.setFormat=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI format given ("+e+"), format can be 0, 1 or 2 only.");this.datas.setUint16(8,e)},Gt.prototype.getTracksCount=function(){return this.datas.getUint16(10)},Gt.prototype.setTracksCount=function(e){return this.datas.setUint16(10,e)},Gt.prototype.getTickResolution=function(e){return 32768&this.datas.getUint16(12)?1e6/(this.getSMPTEFrames()*this.getTicksPerFrame()):(e=e||5e5)/this.getTicksPerBeat()},Gt.prototype.getTimeDivision=function(){return 32768&this.datas.getUint16(12)?Gt.FRAMES_PER_SECONDS:Gt.TICKS_PER_BEAT},Gt.prototype.getTicksPerBeat=function(){var e=this.datas.getUint16(12);if(32768&e)throw new Error("Time division is not expressed as ticks per beat.");return e},Gt.prototype.setTicksPerBeat=function(e){this.datas.setUint16(12,32767&e)},Gt.prototype.getSMPTEFrames=function(){const e=this.datas.getUint16(12);let t;if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");if(t=32512&e,-1===[24,25,29,30].indexOf(t))throw new Error("Invalid SMPTE frames value ("+t+").");return 29===t?29.97:t},Gt.prototype.getTicksPerFrame=function(){const e=this.datas.getUint16(12);if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");return 255&e},Gt.prototype.setSMTPEDivision=function(e,t){if(29.97===e&&(e=29),-1===[24,25,29,30].indexOf(e))throw new Error("Invalid SMPTE frames value given ("+e+").");if(0>t||255<t)throw new Error("Invalid ticks per frame value given ("+e+").");this.datas.setUint8(12,128|e),this.datas.setUint8(13,t)};var jt=Gt;function Wt(e,t){let n,r;if(e){if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer received.");if(12>e.byteLength-t)throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : Buffer length must size at least 12bytes");if(this.datas=new DataView(e,t,Wt.HDR_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"r"!==String.fromCharCode(this.datas.getUint8(2))||"k"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : MTrk prefix not found");if(r=this.getTrackLength(),e.byteLength-t<r)throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : The track size exceed the buffer length.");if(this.datas=new DataView(e,t,Wt.HDR_LENGTH+r),255!==this.datas.getUint8(Wt.HDR_LENGTH+(r-3))||47!==this.datas.getUint8(Wt.HDR_LENGTH+(r-2))||0!==this.datas.getUint8(Wt.HDR_LENGTH+(r-1)))throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : No track end event found at the expected index ("+(Wt.HDR_LENGTH+(r-1)).toString(16)+").")}else n=new Uint8Array(12),n[0]=77,n[1]=84,n[2]=114,n[3]=107,n[4]=0,n[5]=0,n[6]=0,n[7]=4,n[8]=0,n[9]=255,n[10]=47,n[11]=0,this.datas=new DataView(n.buffer,0,Wt.HDR_LENGTH+4)}Wt.HDR_LENGTH=8,Wt.prototype.getTrackLength=function(){return this.datas.getUint32(4)},Wt.prototype.setTrackLength=function(e){return this.datas.setUint32(4,e)},Wt.prototype.getTrackContent=function(){return new DataView(this.datas.buffer,this.datas.byteOffset+Wt.HDR_LENGTH,this.datas.byteLength-Wt.HDR_LENGTH)},Wt.prototype.setTrackContent=function(e){let t,n,r,o;const i=e.byteLength-e.byteOffset;if(4>i)throw new Error("Invalid track length, must size at least 4bytes");for(this.datas=new DataView(new Uint8Array(Wt.HDR_LENGTH+i).buffer),this.datas.setUint8(0,77),this.datas.setUint8(1,84),this.datas.setUint8(2,114),this.datas.setUint8(3,107),this.datas.setUint32(4,i),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=new Uint8Array(this.datas.buffer,Wt.HDR_LENGTH,i),r=0,o=t.length;r<o;r++)n[r]=t[r]};var Yt=Wt;function Kt(){throw new Error("MIDIEvents function not intended to be run.")}Kt.EVENT_META=255,Kt.EVENT_SYSEX=240,Kt.EVENT_DIVSYSEX=247,Kt.EVENT_MIDI=8,Kt.EVENT_META_SEQUENCE_NUMBER=0,Kt.EVENT_META_TEXT=1,Kt.EVENT_META_COPYRIGHT_NOTICE=2,Kt.EVENT_META_TRACK_NAME=3,Kt.EVENT_META_INSTRUMENT_NAME=4,Kt.EVENT_META_LYRICS=5,Kt.EVENT_META_MARKER=6,Kt.EVENT_META_CUE_POINT=7,Kt.EVENT_META_MIDI_CHANNEL_PREFIX=32,Kt.EVENT_META_END_OF_TRACK=47,Kt.EVENT_META_SET_TEMPO=81,Kt.EVENT_META_SMTPE_OFFSET=84,Kt.EVENT_META_TIME_SIGNATURE=88,Kt.EVENT_META_KEY_SIGNATURE=89,Kt.EVENT_META_SEQUENCER_SPECIFIC=127,Kt.EVENT_MIDI_NOTE_OFF=8,Kt.EVENT_MIDI_NOTE_ON=9,Kt.EVENT_MIDI_NOTE_AFTERTOUCH=10,Kt.EVENT_MIDI_CONTROLLER=11,Kt.EVENT_MIDI_PROGRAM_CHANGE=12,Kt.EVENT_MIDI_CHANNEL_AFTERTOUCH=13,Kt.EVENT_MIDI_PITCH_BEND=14,Kt.MIDI_1PARAM_EVENTS=[Kt.EVENT_MIDI_PROGRAM_CHANGE,Kt.EVENT_MIDI_CHANNEL_AFTERTOUCH],Kt.MIDI_2PARAMS_EVENTS=[Kt.EVENT_MIDI_NOTE_OFF,Kt.EVENT_MIDI_NOTE_ON,Kt.EVENT_MIDI_NOTE_AFTERTOUCH,Kt.EVENT_MIDI_CONTROLLER,Kt.EVENT_MIDI_PITCH_BEND],Kt.createParser=function(e,t,n){var r,o,i,a,s;if(e instanceof DataView&&(e={position:t||0,buffer:e,readUint8:function(){return this.buffer.getUint8(this.position++)},readUint16:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readUint32:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readVarInt:function(){for(var e,t=0,n=0;4>n++;){if(!(128&(e=this.readUint8())))return t+e;t+=127&e,t<<=7}throw new Error("0x"+this.position.toString(16)+": Variable integer length cannot exceed 4 bytes")},readBytes:function(e){for(var t=[];0<e;e--)t.push(this.readUint8());return t},pos:function(){return"0x"+(this.buffer.byteOffset+this.position).toString(16)},end:function(){return this.position===this.buffer.byteLength}},t=0),0<t)for(;t--;)e.readUint8();return{next:function(){if(e.end())return null;if(o={index:e.pos(),delta:e.readVarInt()},240==(240&(r=e.readUint8()))){if(r!==Kt.EVENT_META){if(r===Kt.EVENT_SYSEX||r===Kt.EVENT_DIVSYSEX)return o.type=r,o.length=e.readVarInt(),o.data=e.readBytes(o.length),o;if(n)throw new Error(e.pos()+" Unknown event type "+r.toString(16)+", Delta: "+o.delta+".");return o.type=r,o.badsubtype=e.readVarInt(),o.length=e.readUint8(),o.data=e.readBytes(o.length),o}switch(o.type=Kt.EVENT_META,o.subtype=e.readUint8(),o.length=e.readVarInt(),o.subtype){case Kt.EVENT_META_SEQUENCE_NUMBER:if(n&&2!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.msb=e.readUint8(),o.lsb=e.readUint8(),o;case Kt.EVENT_META_TEXT:case Kt.EVENT_META_COPYRIGHT_NOTICE:case Kt.EVENT_META_TRACK_NAME:case Kt.EVENT_META_INSTRUMENT_NAME:case Kt.EVENT_META_LYRICS:case Kt.EVENT_META_MARKER:case Kt.EVENT_META_CUE_POINT:return o.data=e.readBytes(o.length),o;case Kt.EVENT_META_MIDI_CHANNEL_PREFIX:if(n&&1!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.prefix=e.readUint8(),o;case Kt.EVENT_META_END_OF_TRACK:if(n&&0!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o;case Kt.EVENT_META_SET_TEMPO:if(n&&3!==o.length)throw new Error(e.pos()+" Tempo meta event length must be 3.");return o.tempo=(e.readUint8()<<16)+(e.readUint8()<<8)+e.readUint8(),o.tempoBPM=6e7/o.tempo,o;case Kt.EVENT_META_SMTPE_OFFSET:if(n&&5!==o.length)throw new Error(e.pos()+" Bad metaevent length.");if(o.hour=e.readUint8(),n&&23<o.hour)throw new Error(e.pos()+" SMTPE offset hour value must be part of 0-23.");if(o.minutes=e.readUint8(),n&&59<o.minutes)throw new Error(e.pos()+" SMTPE offset minutes value must be part of 0-59.");if(o.seconds=e.readUint8(),n&&59<o.seconds)throw new Error(e.pos()+" SMTPE offset seconds value must be part of 0-59.");if(o.frames=e.readUint8(),n&&30<o.frames)throw new Error(e.pos()+" SMTPE offset frames value must be part of 0-30.");if(o.subframes=e.readUint8(),n&&99<o.subframes)throw new Error(e.pos()+" SMTPE offset subframes value must be part of 0-99.");return o;case Kt.EVENT_META_KEY_SIGNATURE:if(n&&2!==o.length)throw new Error(e.pos()+" Bad metaevent length.");if(o.key=e.readUint8(),n&&(-7>o.key||7<o.key))throw new Error(e.pos()+" Bad metaevent length.");if(o.scale=e.readUint8(),n&&0!==o.scale&&1!==o.scale)throw new Error(e.pos()+" Key signature scale value must be 0 or 1.");return o;case Kt.EVENT_META_TIME_SIGNATURE:if(n&&4!==o.length)throw new Error(e.pos()+" Bad metaevent length.");return o.data=e.readBytes(o.length),o.param1=o.data[0],o.param2=o.data[1],o.param3=o.data[2],o.param4=o.data[3],o;case Kt.EVENT_META_SEQUENCER_SPECIFIC:return o.data=e.readBytes(o.length),o;default:if(n)throw new Error(e.pos()+" Unknown meta event type ("+o.subtype.toString(16)+").");return o.data=e.readBytes(o.length),o}}else{if(0==(128&r)){if(!i)throw new Error(e.pos()+" Running status without previous event");s=r}else i=r>>4,a=15&r,s=e.readUint8();switch(o.type=Kt.EVENT_MIDI,o.subtype=i,o.channel=a,o.param1=s,i){case Kt.EVENT_MIDI_NOTE_OFF:return o.param2=e.readUint8(),o;case Kt.EVENT_MIDI_NOTE_ON:return o.param2=e.readUint8(),o.param2||(o.subtype=Kt.EVENT_MIDI_NOTE_OFF,o.param2=127),o;case Kt.EVENT_MIDI_NOTE_AFTERTOUCH:case Kt.EVENT_MIDI_CONTROLLER:return o.param2=e.readUint8(),o;case Kt.EVENT_MIDI_PROGRAM_CHANGE:case Kt.EVENT_MIDI_CHANNEL_AFTERTOUCH:return o;case Kt.EVENT_MIDI_PITCH_BEND:return o.param2=e.readUint8(),o;default:if(n)throw new Error(e.pos()+" Unknown MIDI event type ("+i.toString(16)+").");return o}}}}},Kt.writeToTrack=function(e,t,n){var r,o,i,a,s=0;for(r=0,o=e.length;r<o;r++){if(e[r].delta>>>28)throw Error("Event #"+r+": Maximum delta time value reached ("+e[r].delta+"/134217728 max)");if(e[r].delta>>>21&&(t[s++]=e[r].delta>>>21&127|128),e[r].delta>>>14&&(t[s++]=e[r].delta>>>14&127|128),e[r].delta>>>7&&(t[s++]=e[r].delta>>>7&127|128),t[s++]=127&e[r].delta,e[r].type===Kt.EVENT_MIDI)t[s++]=(e[r].subtype<<4)+e[r].channel,t[s++]=e[r].param1,-1!==Kt.MIDI_2PARAMS_EVENTS.indexOf(e[r].subtype)&&(t[s++]=e[r].param2);else{if(t[s++]=e[r].type,e[r].type===Kt.EVENT_META&&(t[s++]=e[r].subtype),e[r].length>>>28)throw Error("Event #"+r+": Maximum length reached ("+e[r].length+"/134217728 max)");if(e[r].length>>>21&&(t[s++]=e[r].length>>>21&127|128),e[r].length>>>14&&(t[s++]=e[r].length>>>14&127|128),e[r].length>>>7&&(t[s++]=e[r].length>>>7&127|128),t[s++]=127&e[r].length,e[r].type===Kt.EVENT_META)switch(e[r].subtype){case Kt.EVENT_META_SEQUENCE_NUMBER:t[s++]=e[r].msb,t[s++]=e[r].lsb;break;case Kt.EVENT_META_TEXT:case Kt.EVENT_META_COPYRIGHT_NOTICE:case Kt.EVENT_META_TRACK_NAME:case Kt.EVENT_META_INSTRUMENT_NAME:case Kt.EVENT_META_LYRICS:case Kt.EVENT_META_MARKER:case Kt.EVENT_META_CUE_POINT:for(i=0,a=e[r].length;i<a;i++)t[s++]=e[r].data[i];break;case Kt.EVENT_META_MIDI_CHANNEL_PREFIX:t[s++]=e[r].prefix;break;case Kt.EVENT_META_END_OF_TRACK:break;case Kt.EVENT_META_SET_TEMPO:t[s++]=e[r].tempo>>16,t[s++]=e[r].tempo>>8&255,t[s++]=255&e[r].tempo;break;case Kt.EVENT_META_SMTPE_OFFSET:if(n&&23<e[r].hour)throw new Error("Event #"+r+": SMTPE offset hour value must be part of 0-23.");if(t[s++]=e[r].hour,n&&59<e[r].minutes)throw new Error("Event #"+r+": SMTPE offset minutes value must be part of 0-59.");if(t[s++]=e[r].minutes,n&&59<e[r].seconds)throw new Error("Event #"+r+": SMTPE offset seconds value must be part of 0-59.");if(t[s++]=e[r].seconds,n&&30<e[r].frames)throw new Error("Event #"+r+": SMTPE offset frames amount must be part of 0-30.");if(t[s++]=e[r].frames,n&&99<e[r].subframes)throw new Error("Event #"+r+": SMTPE offset subframes amount must be part of 0-99.");t[s++]=e[r].subframes;break;case Kt.EVENT_META_KEY_SIGNATURE:if("number"!=typeof e[r].key||-7>e[r].key||7<e[r].scale)throw new Error("Event #"+r+":The key signature key must be between -7 and 7");if("number"!=typeof e[r].scale||0>e[r].scale||1<e[r].scale)throw new Error("Event #"+r+":The key signature scale must be 0 or 1");t[s++]=e[r].key,t[s++]=e[r].scale;break;case Kt.EVENT_META_TIME_SIGNATURE:case Kt.EVENT_META_SEQUENCER_SPECIFIC:default:for(i=0,a=e[r].length;i<a;i++)t[s++]=e[r].data[i]}else for(i=0,a=e[r].length;i<a;i++)t[s++]=e[r].data[i]}}},Kt.getRequiredBufferLength=function(e){var t,n=0,r=0;for(r=0,t=e.length;r<t;r++)n+=e[r].delta>>>21?4:e[r].delta>>>14?3:e[r].delta>>>7?2:1,e[r].type===Kt.EVENT_MIDI?(n++,n++,-1!==Kt.MIDI_2PARAMS_EVENTS.indexOf(e[r].subtype)&&n++):(n++,e[r].type===Kt.EVENT_META&&n++,n+=e[r].length>>>21?4:e[r].length>>>14?3:e[r].length>>>7?2:1,n+=e[r].length);return n};var Qt=Kt,Xt={isNotUTF8:function(e,t,n){try{en(e,t,n,!0)}catch(e){return!0}return!1},getCharLength:Jt,getCharCode:Zt,getStringFromBytes:en,getBytesForCharCode:tn,setBytesFromCharCode:nn,setBytesFromString:function(e,t,n,r,o){e=e||"",t=t||[],n|=0,r="number"==typeof r?r:t.byteLength||1/0;for(var i=0,a=e.length;i<a;i++){var s=tn(e[i].codePointAt(0));if(o&&n+s>r)throw new Error('Not enought bytes to encode the char "'+e[i]+'" at the offset "'+n+'".');nn(e[i].codePointAt(0),t,n,s),n+=s}return t}};function Jt(e){return 240==(240&e)?4:224==(224&e)?3:192==(192&e)?2:e==(127&e)?1:0}function Zt(e,t,n){var r=0,o="";if(t=t||0,e.length-t<=0)throw new Error("No more characters remaining in array.");if(0==(n=n||Jt(e[t])))throw new Error(e[t].toString(2)+" is not a significative byte (offset:"+t+").");if(1===n)return e[t];if(e.length-t<n)throw new Error("Expected at least "+n+" bytes remaining in array.");if(o="00000000".slice(0,n)+1+"00000000".slice(n+1),e[t]&parseInt(o,2))throw Error("Index "+t+": A "+n+" bytes encoded char cannot encode the "+(n+1)+"th rank bit to 1.");for(o="0000".slice(0,n+1)+"11111111".slice(n+1),r+=(e[t]&parseInt(o,2))<<6*--n;n;){if(128!=(128&e[t+1])||64==(64&e[t+1]))throw Error("Index "+(t+1)+': Next bytes of encoded char must begin with a "10" bit sequence.');r+=(63&e[++t])<<6*--n}return r}function en(e,t,n,r){var o,i=[];for(t|=0,n="number"==typeof n?n:e.byteLength||e.length;t<n;t++){if(t+(o=Jt(e[t]))>n){if(r)throw Error("Index "+t+": Found a "+o+" bytes encoded char declaration but only "+(n-t)+" bytes are available.")}else i.push(String.fromCodePoint(Zt(e,t,o)));t+=o-1}return i.join("")}function tn(e){if(e<128)return 1;if(e<2048)return 2;if(e<65536)return 3;if(e<2097152)return 4;throw new Error("CharCode "+e+" cannot be encoded with UTF8.")}function nn(e,t,n,r){if(e|=0,t=t||[],n|=0,1==(r=r||tn(e)))t[n]=e;else for(t[n++]=(parseInt("1111".slice(0,r),2)<<8-r)+(e>>>6*--r);r>0;)t[n++]=e>>>6*--r&63|128;return t}function rn(e,t){var n,r,o,i;if(e){if(25>(e=function(e){if(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array)return new Uint8Array(e).buffer}throw new Error("Unsupported buffer type, need ArrayBuffer or Uint8Array")}(e)).byteLength)throw new Error("A buffer of a valid MIDI file must have, at least, a size of 25bytes.");for(this.header=new jt(e),this.tracks=[],r=jt.HEADER_LENGTH,o=0,i=this.header.getTracksCount();o<i;o++){if(t&&r>=e.byteLength-1)throw new Error("Couldn't find datas corresponding to the track #"+o+".");n=new Yt(e,r),this.tracks.push(n),r+=n.getTrackLength()+8}if(t&&r!==e.byteLength)throw new Error("It seems that the buffer contains too much datas.")}else this.header=new jt,this.tracks=[new Yt]}rn.prototype.getEvents=function(e,t){var n,r,o,i,a,s,l=0,c=[],u=this.header.getFormat(),d=this.header.getTickResolution();if(1!==u||1===this.tracks.length)for(o=0,i=this.tracks.length;o<i;o++)for(l=2===u&&l?l:0,r=(n=Qt.createParser(this.tracks[o].getTrackContent(),0,!1)).next();r;)l+=r.delta?r.delta*d/1e3:0,r.type===Qt.EVENT_META&&r.subtype===Qt.EVENT_META_SET_TEMPO&&(d=this.header.getTickResolution(r.tempo)),e&&r.type!==e||t&&(!r.subtype||r.subtype!==t)||(r.playTime=l,c.push(r)),r=n.next();else{for(a=[],s=-1,o=0,i=this.tracks.length;o<i;o++)a[o]={},a[o].parser=Qt.createParser(this.tracks[o].getTrackContent(),0,!1),a[o].curEvent=a[o].parser.next();do{for(s=-1,o=0,i=a.length;o<i;o++)a[o].curEvent&&(-1===s||a[o].curEvent.delta<a[s].curEvent.delta)&&(s=o);if(-1!==s){for(o=0,i=a.length;o<i;o++)o!==s&&a[o].curEvent&&(a[o].curEvent.delta-=a[s].curEvent.delta);l+=(r=a[s].curEvent).delta?r.delta*d/1e3:0,r.type===Qt.EVENT_META&&r.subtype===Qt.EVENT_META_SET_TEMPO&&(d=this.header.getTickResolution(r.tempo)),e&&r.type!==e||t&&(!r.subtype||r.subtype!==t)||(r.playTime=l,r.track=s,c.push(r)),a[s].curEvent=a[s].parser.next()}}while(-1!==s)}return c},rn.prototype.getMidiEvents=function(){return this.getEvents(Qt.EVENT_MIDI)},rn.prototype.getLyrics=function(){var e,t,n,r=this.getEvents(Qt.EVENT_META),o=[],i=[];for(t=0,n=r.length;t<n;t++)(e=r[t]).subtype===Qt.EVENT_META_LYRICS?i.push(e):e.subtype===Qt.EVENT_META_TEXT&&("@"===String.fromCharCode(e.data[0])?"T"===String.fromCharCode(e.data[1])||"I"===String.fromCharCode(e.data[1])||String.fromCharCode(e.data[1]):0===String.fromCharCode.apply(String,e.data).indexOf("words")?o.length=0:0!==e.playTime&&o.push(e));2<i.length?o=i:o.length||(o=[]);try{o.forEach((function(e){e.text=Xt.getStringFromBytes(e.data,0,e.length,!0)}))}catch(e){o.forEach((function(e){e.text=e.data.map((function(e){return String.fromCharCode(e)})).join("")}))}return o},rn.prototype.getTrackEvents=function(e){var t,n,r=[];if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");t=(n=Qt.createParser(this.tracks[e].getTrackContent(),0,!1)).next();do{r.push(t),t=n.next()}while(t);return r},rn.prototype.setTrackEvents=function(e,t){var n,r;if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");if(!t||!t.length)throw Error("A track must contain at least one event, none given.");n=Qt.getRequiredBufferLength(t),r=new Uint8Array(n),Qt.writeToTrack(t,r),this.tracks[e].setTrackContent(r)},rn.prototype.deleteTrack=function(e){if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");this.tracks.splice(e,1),this.header.setTracksCount(this.tracks.length)},rn.prototype.addTrack=function(e){var t;if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");t=new Yt,e===this.tracks.length?this.tracks.push(t):this.tracks.splice(e,0,t),this.header.setTracksCount(this.tracks.length)},rn.prototype.getContent=function(){var e,t,n,r,o,i,a,s,l;for(e=jt.HEADER_LENGTH,r=0,o=this.tracks.length;r<o;r++)e+=this.tracks[r].getTrackLength()+8;for(t=new Uint8Array(e),n=new Uint8Array(this.header.datas.buffer,this.header.datas.byteOffset,jt.HEADER_LENGTH),r=0,o=jt.HEADER_LENGTH;r<o;r++)t[r]=n[r];for(i=0,a=this.tracks.length;i<a;i++)for(n=new Uint8Array(this.tracks[i].datas.buffer,this.tracks[i].datas.byteOffset,this.tracks[i].datas.byteLength),s=0,l=this.tracks[i].datas.byteLength;s<l;s++)t[r++]=n[s];return t.buffer},rn.Header=jt,rn.Track=Yt;var on=rn;class an{constructor(e,t,n,r,o,i="keep",a="keep"){this.value=e,this.playTime=t,this.delta=o,this.char=cn[e-21],this.tempo=n,this.BPM=r,this.valid=e>=21&&e<=108,this.outOfRange=e<=35||e>=97,"!@#$%^&*()QWERTYUIOPASDFGHJKLZXCBVNM".includes(this.char)?"Start"===i?this.displayValue=e-108:"End"==i&&(this.displayValue=e+108):this.outOfRange?"Start"===a?this.displayValue=e-1024:"End"==a&&(this.displayValue=e+1024):this.displayValue=e}}class sn{constructor(e,t=!0){let n=!1,r=e[0];for(let t of e){if(t.playTime!=r.playTime){n=!0;break}r=t}if(this.is_quantized=n,n)this.notes=t?e:e.sort(((e,t)=>e.displayValue-t.displayValue));else{let t=[],n=[];e.forEach((e=>{t.includes(e.value)||(t.push(e.value),n.push(e))})),this.notes=n.sort(((e,t)=>e.displayValue-t.displayValue))}}}class ln{constructor(e){this.chords=e}transpose(e,t="Start",n="Start",r=!0){let o=[];return this.chords.forEach((i=>{let a=[];i.notes.forEach((r=>{a.push(new an(r.value+e,r.playTime,r.tempo,r.BPM,r.delta,t,n))})),o.push(new sn(a,r))})),new ln(o)}}const cn="1234567890qwert1!2@34$5%6^78*9(0qQwWeErtTyYuiIoOpPasSdDfgGhHjJklLzZxcCvVbBnmyuiopasdfghj",un="1234567890qwertyuiopasdfghklzxcvbnm";function dn(e,t){function n(e){let t=[];for(let n of e.chords)for(let e of n.notes)t.push({char:e.char,oor:e.outOfRange,valid:e.valid});return t.filter((e=>un.includes(e.char)&&!1===e.oor&&!0===e.valid)).length}let r=0,o=0;for(let i=-t;i<=t;i++){let a=n(e.transpose(i))+Math.abs(t)/10;a>r&&(r=a,o=i)}return o}function fn(e,t){return t<e/4?"-":t<e/2?" ":t<e?" - ":t<2*e?", ":t<2.5*e?". ":t<3*e?".. ":t<4*e?"... ":"\n"}function hn(e){let t,n,o,i,c,h,g,v,_,N,A,S,k,I,x,M,C,$,D,U,V,R,O,F,L,B,H,q,z,G,j,W,Y,K,Q,X,J,Z,ee,te,ne,re,oe,ie,ae,se,le,ce,ue,de,fe,he,pe,ge,Ee,me,ye,we,Te,be=1==e[0].beats?"1 beat":`${e[0].beats} beats`,ve=e[0].quantize+"";function _e(e,t){return e[0].capturingImage?gn:pn}let Ne=_e(e),Ae=Ne(e),Se="undefined"!=typeof ClipboardItem&&function(e){let t,n,r,o;function i(e,t){return e[0].capturingImage?mn:En}let a=i(e),c=a(e);return{c(){t=u("button"),c.c(),t.disabled=n=e[0].capturingImage},m(n,i){s(n,t,i),c.m(t,null),r||(o=p(t,"click",e[13]),r=!0)},p(e,r){a!==(a=i(e))&&(c.d(1),c=a(e),c&&(c.c(),c.m(t,null))),1&r&&n!==(n=e[0].capturingImage)&&(t.disabled=n)},d(e){e&&l(t),c.d(),r=!1,o()}}}(e);return{c(){t=u("div"),n=u("label"),n.textContent="Transpose (sheet) by:",o=f(),i=u("input"),c=f(),h=u("button"),h.textContent="Auto-transpose",g=f(),v=u("div"),_=u("div"),N=u("label"),N.textContent="Place shifted notes at:",A=f(),S=u("select"),k=u("option"),k.textContent="Start",I=u("option"),I.textContent="End",x=f(),M=u("div"),C=u("label"),C.textContent="Place out of range notes at:",$=f(),D=u("select"),U=u("option"),U.textContent="Start",V=u("option"),V.textContent="End",R=f(),O=u("div"),F=u("label"),F.textContent="Break lines:",L=f(),B=u("input"),H=f(),q=u("span"),z=d("Every "),G=d(be),j=f(),W=u("div"),Y=u("label"),Y.textContent="Quantize:",K=f(),Q=u("input"),X=f(),J=u("span"),Z=d(ve),ee=d(" miliseconds"),te=f(),ne=u("label"),re=u("input"),oe=d("\n        Sequential quantizes"),ie=f(),ae=u("label"),se=u("input"),le=d("\n        Include out of range (ctrl) notes"),ce=f(),ue=u("label"),de=u("input"),fe=d("\n        Show tempo marks"),he=f(),pe=u("button"),Ae.c(),Ee=f(),Se&&Se.c(),me=f(),ye=u("style"),ye.textContent='label {\n        max-width: fit-content;\n        text-align: center;\n    }\n\n    .select-div {\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        text-align: center;\n    }\n\n    select {\n        height: auto;\n        margin-left: 0.4em;\n        margin-top: 0.2em;\n        margin-bottom: 0;\n    }\n\n    input[type="checkbox"] {\n        display: inline-block;\n        vertical-align: middle;\n    }\n\n    input[type="range"] {\n        margin-left: 0.4em;\n        margin-right: 0.4em;\n        margin-bottom: 0;\n    }\n\n    input[type="file"] {\n        margin-bottom: 0;\n    }\n    \n    .beats, .quantize, .select-label {\n        display: flex;\n        flex-direction: row;\n    }',E(n,"for","number"),E(i,"type","number"),E(i,"min","-24"),E(i,"max","24"),T(t,"display","inline-block"),E(N,"for","shifts-position"),k.__value="Start",k.value=k.__value,I.__value="End",I.value=I.__value,E(S,"name","shifts-position"),E(S,"id","shifts-position"),void 0===e[0].pShifts&&P((()=>e[5].call(S))),E(_,"class","select-div"),E(C,"for","oors-position"),U.__value="Start",U.value=U.__value,V.__value="End",V.value=V.__value,E(D,"name","oors-position"),E(D,"id","oors-position"),void 0===e[0].pOors&&P((()=>e[6].call(D))),E(M,"class","select-div"),E(F,"class","slider-label"),E(F,"for","beats-for-newline"),E(B,"type","range"),E(B,"id","beats-for-newline"),E(B,"min","1"),E(B,"max","32"),E(O,"class","beats"),E(Y,"class","slider-label"),E(Y,"for","quantize-prompt"),E(Q,"type","range"),E(Q,"id","quantize-prompt"),E(Q,"min","1"),E(Q,"max","100"),E(W,"class","quantize"),E(re,"type","checkbox"),E(re,"id","order-quantizes"),E(ne,"for","order-quantizes"),E(se,"type","checkbox"),E(se,"id","out-of-range"),E(ae,"for","out-of-range"),E(de,"type","checkbox"),E(de,"id","tempo-checkbox"),E(ue,"for","tempo-checkbox"),pe.disabled=ge=e[0].capturingImage},m(r,l){s(r,t,l),a(t,n),a(t,o),a(t,i),w(i,e[0].transposition),a(t,c),a(t,h),s(r,g,l),s(r,v,l),a(v,_),a(_,N),a(_,A),a(_,S),a(S,k),a(S,I),b(S,e[0].pShifts),a(v,x),a(v,M),a(M,C),a(M,$),a(M,D),a(D,U),a(D,V),b(D,e[0].pOors),a(v,R),a(v,O),a(O,F),a(O,L),a(O,B),w(B,e[0].beats),a(O,H),a(O,q),a(q,z),a(q,G),a(v,j),a(v,W),a(W,Y),a(W,K),a(W,Q),w(Q,e[0].quantize),a(W,X),a(W,J),a(J,Z),a(J,ee),a(v,te),a(v,ne),a(ne,re),re.checked=e[0].sequentialQuantize,a(ne,oe),a(v,ie),a(v,ae),a(ae,se),se.checked=e[0].oors,a(ae,le),a(v,ce),a(v,ue),a(ue,de),de.checked=e[0].tempoMarks,a(ue,fe),a(v,he),a(v,pe),Ae.m(pe,null),a(v,Ee),Se&&Se.m(v,null),s(r,me,l),s(r,ye,l),we||(Te=[p(i,"input",e[3]),p(h,"click",e[4]),p(S,"change",e[5]),p(D,"change",e[6]),p(B,"change",e[7]),p(B,"input",e[7]),p(Q,"change",e[8]),p(Q,"input",e[8]),p(re,"change",e[9]),p(se,"change",e[10]),p(de,"change",e[11]),p(pe,"click",e[12])],we=!0)},p(e,t){1&t&&m(i.value)!==e[0].transposition&&w(i,e[0].transposition),1&t&&b(S,e[0].pShifts),1&t&&b(D,e[0].pOors),1&t&&w(B,e[0].beats),1&t&&be!==(be=1==e[0].beats?"1 beat":`${e[0].beats} beats`)&&y(G,be),1&t&&w(Q,e[0].quantize),1&t&&ve!==(ve=e[0].quantize+"")&&y(Z,ve),1&t&&(re.checked=e[0].sequentialQuantize),1&t&&(se.checked=e[0].oors),1&t&&(de.checked=e[0].tempoMarks),Ne!==(Ne=_e(e))&&(Ae.d(1),Ae=Ne(e),Ae&&(Ae.c(),Ae.m(pe,null))),1&t&&ge!==(ge=e[0].capturingImage)&&(pe.disabled=ge),"undefined"!=typeof ClipboardItem&&Se.p(e,t)},d(e){e&&l(t),e&&l(g),e&&l(v),Ae.d(),Se&&Se.d(),e&&l(me),e&&l(ye),we=!1,r(Te)}}}function pn(e){let t;return{c(){t=d("Download Image")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function gn(e){let t;return{c(){t=d("Please Wait...")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function En(e){let t;return{c(){t=d("Copy Image")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function mn(e){let t;return{c(){t=d("Please Wait...")},m(e,n){s(e,t,n)},d(e){e&&l(t)}}}function yn(t){let n,r=t[1]&&hn(t);return{c(){r&&r.c(),n=h()},m(e,t){r&&r.m(e,t),s(e,n,t)},p(e,[t]){e[1]?r?r.p(e,t):(r=hn(e),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:e,o:e,d(e){r&&r.d(e),e&&l(n)}}}function wn(e,t,n){let r=I(),{show:o}=t,{settings:i={beats:4,quantize:35,sequentialQuantize:!1,pShifts:"Start",pOors:"Start",oors:!0,tempoMarks:!1,transposition:0,capturingImage:!1}}=t;return e.$$set=e=>{"show"in e&&n(1,o=e.show),"settings"in e&&n(0,i=e.settings)},[i,o,r,function(){i.transposition=m(this.value),n(0,i)},()=>{r("auto")},function(){i.pShifts=v(this),n(0,i)},function(){i.pOors=v(this),n(0,i)},function(){i.beats=m(this.value),n(0,i)},function(){i.quantize=m(this.value),n(0,i)},function(){i.sequentialQuantize=this.checked,n(0,i)},function(){i.oors=this.checked,n(0,i)},function(){i.tempoMarks=this.checked,n(0,i)},()=>r("captureSheetAsImage",{mode:"download"}),()=>r("captureSheetAsImage",{mode:"copy"})]}class Tn extends te{constructor(e){super(),ee(this,e,wn,yn,i,{show:1,settings:0})}}function bn(t){let n,r,o,i,c,f,h,g,m,w=t[1].getTrackLength()+"";return{c(){n=u("div"),r=u("input"),o=d("\n    Track "),i=d(t[2]),c=d(" - "),f=d(w),h=d(" events"),E(r,"type","checkbox"),E(n,"id","track")},m(e,l){s(e,n,l),a(n,r),r.checked=t[0],a(n,o),a(n,i),a(n,c),a(n,f),a(n,h),g||(m=p(r,"change",t[3]),g=!0)},p(e,[t]){1&t&&(r.checked=e[0]),4&t&&y(i,e[2]),2&t&&w!==(w=e[1].getTrackLength()+"")&&y(f,w)},i:e,o:e,d(e){e&&l(n),g=!1,m()}}}function vn(e,t,n){let{track:r,idx:o}=t,{selected:i=!1}=t;return e.$$set=e=>{"track"in e&&n(1,r=e.track),"idx"in e&&n(2,o=e.idx),"selected"in e&&n(0,i=e.selected)},[i,r,o,function(){i=this.checked,n(0,i)}]}class _n extends te{constructor(e){super(),ee(this,e,vn,bn,i,{track:1,idx:2,selected:0})}}const Nn={long:"white",quadruple:"#a3f0a3",whole:"#74da74",half:"#9ada5a",quarter:"#c0c05a",eighth:"#da7e5a",sixteenth:"#daa6a6",thirtysecond:"#ff1900",sixtyfourth:"#9c0f00"};function An(e,t){return`<span style="color:${t}">${e}</span>`}function Sn(t){let n,o,i,c,d=t[4](t[2])+"";return{c(){n=u("div"),o=u("div"),E(o,"class","line svelte-1sxf1v3"),E(n,"class","viewer svelte-1sxf1v3")},m(e,r){s(e,n,r),a(n,o),o.innerHTML=d,i||(c=[p(o,"mousedown",g(t[10])),p(o,"contextmenu",g(t[9]))],i=!0)},p(e,[t]){4&t&&d!==(d=e[4](e[2])+"")&&(o.innerHTML=d)},i:e,o:e,d(e){e&&l(n),i=!1,r(c)}}}function kn(e,t,n){let r=I(),{index:o}=t,{line:i}=t,{passedNext:a}=t,s=new ln(i.chords),l=s,{sameTranspositionAsPrevious:c=!1}=t,{settings:u}=t;function d(e,t){let n=`<span style="color:${t}">`,r=e.notes.length>1&&e.notes.find((e=>!0===e.valid));!1===u.oors&&e.notes.filter((e=>!1===e.outOfRange)).length<=1&&(r=!1),r&&(n+="[");for(const r of e.notes)r.valid?!0===r.outOfRange?!0===u.oors&&(n+=`<span style="display:inline-block; border-bottom: 2px solid ${t}">${r.char}</span>`):n+=r.char:n+="_";return r&&(n+="]"),n+"</span>"}return e.$$set=e=>{"index"in e&&n(0,o=e.index),"line"in e&&n(5,i=e.line),"passedNext"in e&&n(6,a=e.passedNext),"sameTranspositionAsPrevious"in e&&n(7,c=e.sameTranspositionAsPrevious),"settings"in e&&n(8,u=e.settings)},e.$$.update=()=>{290&e.$$.dirty&&(n(1,s=new ln(i.chords)),n(2,l=s.transpose(i.transposition,u.pShifts,u.pOors,u.sequentialQuantize)))},[o,s,l,r,function(e){const t=-i.transposition;let n="";c||(n+=An(`Transpose by: ${t>0?"+":""}${t}`,"white"),i.difference&&(n+=An(` (${-i.difference>0?"+":""}${-i.difference})`,"white")),n+="\n");let r=e.chords;for(let e=0;e<r.length;e++){if(!r){n+="[bad-midi-file!]<br>";continue}const t={chord:r[e]};t.note=t.chord?.notes[0];const o={chord:r[e+1]};if(o.note=o.chord?.notes[0],!t.note)continue;if(!o.note){if(!a){n+=d(t.chord,"white");continue}o.note=a}let i=t.note.tempo/1e3,s=o.note.playTime-t.note.playTime;t.chord.is_quantized&&(s=o.note.playTime-t.chord.notes.slice(-1)[0].playTime),s-=.5;let l=Nn.long;s<i/16?l=Nn.sixtyfourth:s<i/8?l=Nn.thirtysecond:s<i/4?l=Nn.sixteenth:s<i/2?l=Nn.eighth:s<i?l=Nn.quarter:s<2*i?l=Nn.half:s<2*i?l=Nn.whole:s<4*i?l=Nn.quadruple:s<8*i&&(l=Nn.long),n+=d(t.chord,l),n+=u.tempoMarks?An(fn(i,s),l):" "}return n},i,a,c,u,function(t){x.call(this,e,t)},e=>{switch(e.button){case 0:r("transpose",{index:+o,by:1});break;case 1:r("auto",{index:+o,sheet:s});break;case 2:r("transpose",{index:+o,by:-1})}}]}class In extends te{constructor(e){super(),ee(this,e,kn,Sn,i,{index:0,line:5,passedNext:6,sameTranspositionAsPrevious:7,settings:8})}}const{document:xn}=Y;function Mn(e,t,n){const r=e.slice();r[29]=t[n][0],r[30]=t[n][1];const o=r[1][r[29]-1];r[31]=o;const i=r[30].continuation;r[32]=i;const a=r[31]?.transposition==r[30].transposition;return r[33]=a,r}function Cn(e,t,n){const r=e.slice();return r[36]=t[n],r[37]=t,r[38]=n,r}function $n(e){let t,n,r,o,i,d,h,g=e[5],m=[];for(let t=0;t<g.length;t+=1)m[t]=Dn(Cn(e,g,t));const y=e=>W(m[e],1,1,(()=>{m[e]=null}));return{c(){t=u("section"),n=u("div");for(let e=0;e<m.length;e+=1)m[e].c();r=f(),o=u("button"),o.textContent="Import selected tracks",E(n,"id","tracks"),E(t,"id","track-chooser")},m(l,c){s(l,t,c),a(t,n);for(let e=0;e<m.length;e+=1)m[e].m(n,null);a(t,r),a(t,o),i=!0,d||(h=p(o,"click",e[19]),d=!0)},p(e,t){if(96&t[0]){let r;for(g=e[5],r=0;r<g.length;r+=1){const o=Cn(e,g,r);m[r]?(m[r].p(o,t),j(m[r],1)):(m[r]=Dn(o),m[r].c(),j(m[r],1),m[r].m(n,null))}for(z(),r=g.length;r<m.length;r+=1)y(r);G()}},i(e){if(!i){for(let e=0;e<g.length;e+=1)j(m[e]);i=!0}},o(e){m=m.filter(Boolean);for(let e=0;e<m.length;e+=1)W(m[e]);i=!1},d(e){e&&l(t),c(m,e),d=!1,h()}}}function Dn(e){let t,n,r;function o(t){e[18](t,e[38])}let i={track:e[36],idx:e[38]+1};return void 0!==e[6][e[38]]&&(i.selected=e[6][e[38]]),t=new _n({props:i}),C.push((()=>K(t,"selected",o))),{c(){Q(t.$$.fragment)},m(e,n){X(t,e,n),r=!0},p(r,o){e=r;const i={};32&o[0]&&(i.track=e[36]),!n&&64&o[0]&&(n=!0,i.selected=e[6][e[38]],R((()=>n=!1))),t.$set(i)},i(e){r||(j(t.$$.fragment,e),r=!0)},o(e){W(t.$$.fragment,e),r=!1},d(e){J(t,e)}}}function Un(e){let t,n,r,o,i=Object.entries(e[1]),d=[];for(let t=0;t<i.length;t+=1)d[t]=Vn(Mn(e,i,t));const f=e=>W(d[e],1,1,(()=>{d[e]=null}));return{c(){t=u("div"),n=u("div");for(let e=0;e<d.length;e+=1)d[e].c();T(n,"width","max-content"),P((()=>e[20].call(n))),T(t,"background","#2D2A32")},m(i,c){s(i,t,c),a(t,n);for(let e=0;e<d.length;e+=1)d[e].m(n,null);r=function(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");const n=u("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const r=A();let o;return r?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",o=p(window,"message",(e=>{e.source===n.contentWindow&&t()}))):(n.src="about:blank",n.onload=()=>{o=p(n.contentWindow,"resize",t)}),a(e,n),()=>{(r||o&&n.contentWindow)&&o(),l(n)}}(n,e[20].bind(n)),e[21](t),o=!0},p(e,t){if(12291&t[0]){let r;for(i=Object.entries(e[1]),r=0;r<i.length;r+=1){const o=Mn(e,i,r);d[r]?(d[r].p(o,t),j(d[r],1)):(d[r]=Vn(o),d[r].c(),j(d[r],1),d[r].m(n,null))}for(z(),r=i.length;r<d.length;r+=1)f(r);G()}},i(e){if(!o){for(let e=0;e<i.length;e+=1)j(d[e]);o=!0}},o(e){d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)W(d[e]);o=!1},d(n){n&&l(t),c(d,n),r(),e[21](null)}}}function Vn(e){let t,n;return t=new In({props:{line:e[30],sameTranspositionAsPrevious:e[33],index:e[29],settings:e[0],passedNext:e[32]}}),t.$on("transpose",e[12]),t.$on("auto",e[13]),{c(){Q(t.$$.fragment)},m(e,r){X(t,e,r),n=!0},p(e,n){const r={};2&n[0]&&(r.line=e[30]),2&n[0]&&(r.sameTranspositionAsPrevious=e[33]),2&n[0]&&(r.index=e[29]),1&n[0]&&(r.settings=e[0]),2&n[0]&&(r.passedNext=e[32]),t.$set(r)},i(e){n||(j(t.$$.fragment,e),n=!0)},o(e){W(t.$$.fragment,e),n=!1},d(e){J(t,e)}}}function Pn(e){let t,n,r,o,i,c,d,p,g,m,y,w;function b(t){e[17](t)}let v={show:e[4]};void 0!==e[0]&&(v.settings=e[0]),d=new Tn({props:v}),C.push((()=>K(d,"settings",b))),d.$on("auto",e[11]),d.$on("captureSheetAsImage",e[14]);let _=e[3]&&$n(e),N=e[4]&&Un(e);return{c(){t=f(),n=u("div"),r=u("label"),r.textContent="Please import a MIDI file:",o=f(),i=u("input"),c=f(),Q(d.$$.fragment),g=f(),_&&_.c(),m=f(),N&&N.c(),y=h(),xn.title="MIDI Converter",E(r,"for","file"),E(i,"type","file"),E(i,"accept",".mid,.midi"),T(n,"display","inline-block")},m(l,u){s(l,t,u),s(l,n,u),a(n,r),a(n,o),a(n,i),e[16](i),s(l,c,u),X(d,l,u),s(l,g,u),_&&_.m(l,u),s(l,m,u),N&&N.m(l,u),s(l,y,u),w=!0},p(e,t){const n={};16&t[0]&&(n.show=e[4]),!p&&1&t[0]&&(p=!0,n.settings=e[0],R((()=>p=!1))),d.$set(n),e[3]?_?(_.p(e,t),8&t[0]&&j(_,1)):(_=$n(e),_.c(),j(_,1),_.m(m.parentNode,m)):_&&(z(),W(_,1,1,(()=>{_=null})),G()),e[4]?N?(N.p(e,t),16&t[0]&&j(N,1)):(N=Un(e),N.c(),j(N,1),N.m(y.parentNode,y)):N&&(z(),W(N,1,1,(()=>{N=null})),G())},i(e){w||(j(d.$$.fragment,e),j(_),j(N),w=!0)},o(e){W(d.$$.fragment,e),W(_),W(N),w=!1},d(r){r&&l(t),r&&l(n),e[16](null),r&&l(c),J(d,r),r&&l(g),_&&_.d(r),r&&l(m),N&&N.d(r),r&&l(y)}}}let Rn=.5;function On(e,t,n){let r,o,i,a,s,l,c,u=!1,d=!1,f=0;var h;function p(e){if(!e)return!1;let t=e.tempo/1e3*E.beats,n=e.playTime-f;return n+Rn>=t?(f+=n,!0):void 0}h=()=>{r.addEventListener("change",(async()=>{await r.files[0].arrayBuffer().then((e=>{o=new on(e),function(e){return e.header.getTimeDivision()===on.Header.TICKS_PER_BEAT?{ticksPerBeat:e.header.getTicksPerBeat()}:{SMPTEFrames:e.header.getSMPTEFrames(),ticksPerFrame:e.header.getTicksPerFrame()}}(o).ticksPerBeat||console.error("No ticksPerBeat in this midi file"),n(5,i=o.tracks),n(6,s=i.map((()=>!0))),n(3,u=!0),n(4,d=!1),f=0}))}),!1)},k().$$.on_mount.push(h);let g,E,m=()=>{a=function(e,t=100,n="Start",r="Start",o=!0){let i=[],a=[],s=e[0].playTime??0,l=0,c=0;return e.forEach((e=>{if(81==e.subtype)return c=e.tempo,void(l=e.tempoBPM);const u=e.param1,d=e.playTime,f=e.delta;Math.abs(d-s)<t?(a.push(new an(u,d,c,l,f,n,r)),s=d):(i.push(new sn(a,o)),a=[],a.push(new an(u,d,c,l,f,n,r)),s=d)})),i.push(new sn(a)),new ln(i)}(function(e,t){let n=[];return e.getEvents().forEach((e=>{e.subtype==Qt.EVENT_META_SET_TEMPO&&n.push(e),e.subtype==Qt.EVENT_MIDI_NOTE_ON&&(e.track||!0!==t[0]?!0===t[e.track]&&n.push(e):n.push(e))})),n}(o,s),E.quantize,E.pShifts,E.pOors,E.sequentialQuantize)},y=()=>{if(n(4,d=!1),!a)return;const e=a.chords;f=0,n(1,w=[]);let t=[];for(let n=0;n<=e.length;n++){const r={chord:e[n]};r.note=r.chord?.notes[0];const o={chord:e[n+1]};o.note=o.chord?.notes[0],r.note&&(p(r.note)&&(w.push({chords:t,transposition:E.transposition,continuation:r.note}),t=[]),t.push(r.chord))}w.push({chords:t,transposition:0,continuation:void 0}),n(4,d=!0),n(3,u=!1),n(1,w),n(15,g),n(0,E),n(10,y),n(9,m)},w=[];function T(e,t){let r=+e;n(1,w[r].transposition=t,w),n(1,w[r].difference=w[r].transposition-w[r-1].transposition,w),n(1,w[r+1].difference=w[r+1].transposition-w[r].transposition,w)}function b(e){n(0,E.capturingImage=!0,E),setTimeout((()=>function(e,t){return he(this,null,(function*(){const n=yield pt(e,t),{log:r,type:o,quality:i,dpi:a}=n,s=yield zt(n);r.time("canvas to blob");const l=yield ot(s,o,i);if(["image/png","image/jpeg"].includes(o)&&a){const e=yield st(l.slice(0,33));let t=new Uint8Array(e);return"image/png"===o?t=Te(t,a):"image/jpeg"===o&&(t=function(e,t){return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e}(t,a)),r.timeEnd("canvas to blob"),new Blob([t,l.slice(33)],{type:o})}return r.timeEnd("canvas to blob"),l}))}(l,{width:c,scale:2}).then((t=>{"copy"===e?function(e){try{navigator.clipboard.write([new ClipboardItem({"image/png":e})])}catch(e){console.error(e)}}(t):function(e){const t=URL.createObjectURL(e);let n=r.files[0].name.split(".");n.pop(),n=n.join(".")+".png";let o=document.createElement("a");o.href=t,o.download=n,document.body.appendChild(o),o.click(),URL.revokeObjectURL(t),document.body.removeChild(o)}(t),n(0,E.capturingImage=!1,E)}))),250)}return e.$$.update=()=>{if(32771&e.$$.dirty[0])if(g){if(g.transposition!=E.transposition){for(let e of w)e.transposition=E.transposition;n(1,w),n(15,g),n(0,E),n(10,y),n(9,m)}else g.beats!=E.beats?y():g.quantize==E.quantize&&g.sequentialQuantize==E.sequentialQuantize||(m(),y(),n(1,w),n(15,g),n(0,E),n(10,y),n(9,m));n(15,g={...E})}else n(15,g={...E})},[E,w,r,u,d,i,s,l,c,m,y,()=>{n(0,E.transposition=dn(a,11),E)},e=>{const t=e.detail.index;let n=e.detail.by;T(t,w[t].transposition+n)},e=>{T(e.detail.index,dn(e.detail.sheet,11))},function(e){b(e.detail.mode)},g,function(e){C[e?"unshift":"push"]((()=>{r=e,n(2,r)}))},function(e){E=e,n(0,E)},function(t,r){e.$$.not_equal(s[r],t)&&(s[r]=t,n(6,s))},()=>{m(),y()},function(){c=this.clientWidth,n(8,c)},function(e){C[e?"unshift":"push"]((()=>{l=e,n(7,l)}))}]}return new class extends te{constructor(e){super(),ee(this,e,On,Pn,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
